!function(){var t={};window.page=t,t.translateajaxs=[];var n="",i="";setTimeout((function(){$("#logo").hide(),$("#index").show()}),1e3);var s=0;$("#video")[0].crossOrigin="anonymous",$("#finger").animate({left:"+=150px"},2e3,(function(){$("#finger").animate({left:"-=300px"},2e3,(()=>{$("#finger").fadeOut(500)}))})),$("#gear").animate({left:"+=150px"},2e3,(function(){$("#gear").animate({left:"-=300px"},2e3)})),document.addEventListener("WeixinJSBridgeReady",(function(){$("#video")[0].play()}),!1);var a,o,r=null,c=[],l=window.location.search.substring(1).split("&")[0].split("=")[1],u=null;l&&$.ajax({url:"/mumu/video?",type:"get",ajaxCache:!0,data:"videoNo="+l,async:!1,success:function(t){u=t.data.video}});var d=[],h=-1;$.ajax({url:"/mumu/explore-videos?",type:"get",data:"shortvideo=1&kw="+n+"&pageSize=10&tag="+i,async:!1,success:function(t){d.push(...t.data.videos),localStorage.setItem("videos",JSON.stringify(d)),u&&d.unshift(u)}});var p=localStorage.getItem("currentTime-"+o),m=parseInt(localStorage.getItem("currentIndex-"+o)),f=JSON.parse(localStorage.getItem("currentCaption-"+o)),g=f,v=0,b=0,x={subtitles:"",monitor:"",subtitlesList:[],current:f,currentIndex:m};t.en=x;var w=[];_=_;var k=$("#video")[0];function T(){E(),z(),d[h+1]||$.ajax({url:"/mumu/explore-videos?",type:"get",data:"shortvideo=1&kw="+n+"&pageSize=10&tag="+i,async:!1,success:function(t){t.data.videos.length>0?(d.push(...t.data.videos),localStorage.setItem("videos",JSON.stringify(d))):alert("暂无视频, 请重新搜索")}}),d[h+1]&&(h++,o=d[h].no,a=d[h],localStorage.setItem("videosIndex",h),Y(a))}function y(){E(),z(),d[h-1]?(h--,o=d[h].no,a=d[h],localStorage.setItem("videosIndex",h),Y(a)):location.replace("./index.html")}function Y(e){a=e,o=e.no,K=location.origin+"/mumu?videoNo="+o,wx.updateAppMessageShareData({title:a.name,desc:"幕幕 - 练英语",link:K,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),wx.updateTimelineShareData({title:a.name+"\n幕幕 - 练英语",link:K,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),$("#titleinback").text(a.name),$("#titleinbackpad").show(),function(){if(localStorage.getItem("translateed"))$("#video").css("top","0"),$("#video").attr("autoplay",!0),$("#video").attr("src",a.url);else{$("#hintssec").text(3),E(),$("#video").css("top","-1000px"),$("#hints").css("height",$("#video").css("height")).show(),setTimeout((function(){$("#hints").fadeOut(1e3,(function(){$("#video").css("top","0"),$("#video").attr("src",a.url)}))}),3e3);var t=setInterval((function(){var e=$("#hintssec").text()-1;e<1?clearInterval(t):$("#hintssec").text(e)}),1e3)}}(),$.ajax({url:a.captionUrl,type:"get",async:!1,success:function(t){!function(t){x.subtitlesList=[];let e=[];e=t.split(/[(\r\n)\r\n]+/),e.forEach(((t,n)=>{if(t||e.splice(n,1),new RegExp(/^(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d/).test(t)){var i=e[n+2],s=e[n+1];if(i.indexOf("{\\pos")>=0||s.indexOf("{\\pos")>=0)return;x.subtitlesList.push({startTime:P(t.split(" --\x3e ")[0].replace(",",".")),endTime:P(t.split(" --\x3e ")[1].replace(",",".")),chValue:s,enValue:i})}}));for(let t=0;t<x.subtitlesList.length;t++){t;const e=x.subtitlesList[t],n=x.subtitlesList[t+1];t<x.subtitlesList.length-2&&n.startTime-e.endTime>1e3&&x.subtitlesList.splice(t+1,0,{startTime:parseInt(e.endTime)+1e3,endTime:n.startTime,chValue:"",enValue:""})}var n=x.subtitlesList[0];n&&n.startTime>0&&x.subtitlesList.splice(0,0,{startTime:0,endTime:n.startTime,chValue:"",enValue:""});var i=x.subtitlesList[x.subtitlesList.length-1];i&&x.subtitlesList.push({startTime:parseInt(i.endTime)+1e3,endTime:1e3*a.duration,chValue:"",enValue:""});x.currentIndex>=0?(x.current=x.subtitlesList[x.currentIndex],_(x.current)):_(x.subtitlesList[0])}(t)}}),clearTimeout(t.addHistoryTimeout),t.addHistoryTimeout=setTimeout((function(){var t=JSON.parse(localStorage.getItem("historyvideos"));t||(t=[]);for(var e=0;e<t.length;e++)t[e].no==a.no&&t.splice(e,1);t.unshift(a),localStorage.setItem("historyvideos",JSON.stringify(t))}),5e3)}function X(){v||p&&($("#video")[0].currentTime=p,$("#video")[0].currentTime>=p&&(v=1))}function I(){!function(){if(!b){if(0==p)return void(b=1);p&&($("#video")[0].currentTime=p,$("#video")[0].currentTime>=p&&(b=1))}}(),k.paused&&S(1e3*k.currentTime)}function S(t){if($("#loading").hide(),localStorage.setItem("durationsec-"+o,$("#video")[0].duration),localStorage.setItem("currentTime-"+o,$("#video")[0].currentTime),g){if(!(g.startTime<t))return;g=null}if(!(x.current&&x.current.startTime<=t&&t<x.current.endTime)){var e=x.subtitlesList[x.currentIndex+1];if(e&&e.startTime<=t&&t<e.endTime)return s?(log.debug("loopLine "+t+" - next start time "+e.startTime+" - "+x.current.enValue.substr(0,10)),void L()):(x.current=e,x.currentIndex++,void _(e));e&&t<e.startTime&&(!x.current||t>x.current.endTime)||$(x.subtitlesList).each((function(e,n){if(n.startTime<=t&&t<n.endTime){debugger;return x.current=n,x.currentIndex=e,void _(n)}}))}}function _(t){if(!t)return;localStorage.setItem("currentCaption-"+o,JSON.stringify(t)),localStorage.setItem("currentIndex-"+o,x.currentIndex);let e=t.enValue.split(" ");$("#zh_subtitles").html(""),x.currentwords=e;for(let t=0;t<e.length;t++)if("\\n"!=e[t]){var n=e[t].split("\\n");if(n[0]){var i=$('<span style="border-bottom:2px solid #ffffff;;user-select: none;display: inline-block;cursor: pointer;font-weight: 900;font-size: 18px;padding-left:3px;padding-right:3px;" index="'+t+'" class="font span'+t+'">'+n[0]+"</span>");i.bind("click",(function(){E(),W(t+1)})).bind("mouseout",(function(){$(this).css("border-bottom","2px solid #ffffff")})).bind("mouseover",(function(){$(this).css("border-bottom","2px solid black")})),$("#zh_subtitles").append(i)}n[1]&&e.splice(t+1,0,"\\n",n[1]),n[2]&&e.splice(t+3,0,"\\n",n[2]),n[3]&&e.splice(t+5,0,"\\n",n[3])}else $("#zh_subtitles").append("<br/>");$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),q=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),$("#summtrans").hide(),$("#wordsframe").hide(),$("#word-in").val(""),$("#video").css("top","0px")}function N(){if(x.currentIndex>0){var t=x.currentIndex,e=x.subtitlesList[--t];e&&(e.enValue||(e=x.subtitlesList[--t]),e&&(x.currentIndex=t,x.current=e,g=e,p=e.startTime/1e3,$("#video")[0].currentTime=e.startTime/1e3,log.debug("set st: "+e.startTime/1e3+" ct: "+$("#video")[0].currentTime+" - "+x.current.enValue.substr(0,10)),_(e),q=0,$(".chDialog").hide(),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}}function D(){s?(s=0,$("#loopLine").css("background-color","#ffffff")):(s=1,$("#loopLine").css("background-color","#ffcc79"))}function z(){s=0,$("#loopLine").css("background-color","#ffffff")}function L(){var t=x.currentIndex,e=x.current;e&&(e.enValue||(e=x.subtitlesList[--t]),e&&(x.currentIndex=t,x.current=e,$("#video")[0].currentTime=e.startTime/1e3,g=e,p=e.startTime/1e3,_(e),q=0,$(".chDialog").hide(),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}function O(){var t=x.currentIndex,e=x.subtitlesList[++t];e&&(e.enValue||(e=x.subtitlesList[++t]),e&&(x.currentIndex=t,x.current=e,g=e,p=e.startTime/1e3,$("#video")[0].currentTime=e.startTime/1e3,_(e),q=0,$(".chDialog").hide(),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}function U(e){$("#summrest").hide(),t.dovideoshadow=1,E(),C(),e=e.replace(/^(,|\.|\?|!|\[|\]\(|\))+/,"").replace(/(,|\.|\?|!|\[|\]\(|\))+$/,""),$("#summtrans").show(),$("#summtrans-word").text(e),$("#word-in").val(e),clearTimeout(window.timeoutdo1),window.timeoutdo1=setTimeout((function(){if($("#favor").attr("word",e),window.aaa=setTimeout((function(){$("#summtrans-phonetic").hide(),$("#summtrans-speak").hide(),$("#summtrans-value").hide()}),500),null==e||null==e||!e.toString().trim())return $("#summtrans-phonetic").hide(),$("#summtrans-speak").hide(),void $("#summtrans-value").hide();for(const e of t.translateajaxs)e.abort();t.translateajaxs.push($.ajax({url:"/mumu/translate?from="+a.language+"&to=2&q="+e,type:"get",ajaxCache:{timeout:2592e3},async:!0,success:function(t){clearTimeout(window.aaa),t.data.phonetic?$("#summtrans-phonetic").text("/"+t.data.phonetic+"/").show():$("#summtrans-phonetic").hide(),t.data.speakUrl?$("#summtrans-speak").attr("play-url",t.data.speakUrl).show():$("#summtrans-speak").hide(),$("#summtrans-vv").html("").scrollTop(0),t.data.translations&&$(t.data.translations).each((function(t,e){$("#summtrans-vv").append(`<div>${Q(e)}</div>`)})),t.data.webTranslations&&($("#summtrans-vv").append('<div style="margin-top:10px;">网络释义: </div>'),$(t.data.webTranslations).each((function(t,e){$("#summtrans-vv").append(`<div>${Q(e)}</div>`)}))),$(".lightkeytrans").bind("click",(function(){U(this.innerText)})),$("#wordsframe").hide(),$("#summrest").show(),$("#summtrans-vv").show(),$("#summtrans-value").show(),$("#summtrans").show(),$("#video").css("top","-1000px");var e=localStorage.getItem("totaltranslatesno");e=e||0,e++,localStorage.setItem("totaltranslatesno",e),$("#summtrans-speak").click();var n=localStorage.getItem("translateed");(n=parseInt(n?++n:1))>=4&&(Z.send(JSON.stringify({action:3,words:3})),n=1),localStorage.setItem("translateed",n)}}))}),200)}function E(){$("#video")[0].pause()}function V(){$("#video")[0].play(),clearTimeout(window.timeoutdo1)}function j(){clearInterval(x.monitor),$(".stopFn").css({display:"none"}),$(".startFn").css({display:"inline"}),$("#video")[0].currentTime==$("#video")[0].duration&&setTimeout((function(){T()}),1e3),C()}function C(){if(t.dovideoshadow&&$("#videoshasow").is(":hidden")){var e=videocapture($("#video")[0]);$("#videoshasowimg").attr("src",e.src),e.src||$("#videoshasowimg").css("background-color","#000000"),$("#videoshasow").show(),$("#video").css("top","-1000px")}}function F(){if(!x.current||!x.current.chValue)return;r=$("#video")[0].paused;$("#video")[0].currentTime;$(".chDialog").css("display","block"),$(".chDialog div").html(x.current.chValue.replace(/\\n/g,"<br/>")),E()}function J(){$(".chDialog").css("display","none"),r?E():V()}function P(t){let e=t.split(":"),n=0;return e.forEach(((t,e)=>{switch(e){case 0:n+=60*parseFloat(t)*60*1e3;break;case 1:n+=60*parseFloat(t)*1e3;break;case 2:n+=1e3*parseFloat(t);break}})),n}function M(e){t.dovideoshadow=1,E();let n=$("#zh_subtitles").width()+$("#zh_subtitles").offset().left-5,i=$("#zh_subtitles").height()+$("#zh_subtitles").offset().top-5;if(w=[],$("#zh_subtitles span").css({background:"transparent",color:"black"}),ele=document.elementFromPoint(e.pageX,e.pageY),!$(ele).hasClass("font"))return;let s=e.clientX||e.pageX,a=e.clientY||e.pageY;n-5>s&&s>$("#zh_subtitles").offset().left+5&&$("#zh_subtitles").offset().top+5<a&&a<i-5&&ele.className.lastIndexOf("font span ")<0&&" "!=ele.innerHTML&&(w.push({class:ele.className,value:ele.innerHTML}),$("."+ele.className.split(" ")[1]).css({background:"#d2cbcb",color:"black"}))}function H(t){if(ele=document.elementFromPoint(t.pageX,t.pageY),!$(ele).hasClass("font"))return;let e=t.clientX||t.pageX,n=t.clientY||t.pageY,i=$("#zh_subtitles").width()+$("#zh_subtitles").offset().left,s=$("#zh_subtitles").height()+$("#zh_subtitles").offset().top;if(i-5>e&&e>$("#zh_subtitles").offset().left+5&&$("#zh_subtitles").offset().top+5<n&&n<s-5&&ele.className.lastIndexOf("font span ")<0){let t=!0;if(w.findIndex((function(e,n){e.class==ele.className&&(t=!1)})),t&&" "!=ele.innerHTML)if(w.length){let t=parseInt(w[w.length-1].class.replace("font span","")),e=parseInt(ele.className.replace("font span",""));if(e==t+1)w.push({class:ele.className,value:ele.innerHTML}),$("."+ele.className.split(" ")[1]).css({background:"#d2cbcb",color:"black"});else if(e>t+1)for(let n=t;n<e;n++)$(".span"+n),w.push({class:$(".span"+n).attr("class"),value:$(".span"+n).html()}),$(".span"+n).css({background:"#d2cbcb",color:"black"});else for(let n=e;n<t;n++)$(".span"+n),w.push({class:$(".span"+n).attr("class"),value:$(".span"+n).html()}),$(".span"+n).css({background:"#d2cbcb",color:"black"})}else w.push({class:ele.className,value:ele.innerHTML}),$("."+ele.className.split(" ")[1]).css({background:"#d2cbcb",color:"black"})}}function A(t){ele=document.elementFromPoint(t.pageX,t.pageY);for(let t=0;t<w.length-1;t++)for(let e=0;e<w.length-t-1;e++)if(parseInt(w[e].class.replace("font span",""))>parseInt(w[e+1].class.replace("font span",""))){let t=w[e];w[e]=w[e+1],w[e+1]=t}let e="";$(w).each((function(t,n){t>0?e+=" "+n.value.replace(/^(,|\.|\?|!)+/,"").replace(/(,|\.|\?|!)+$/,""):e=n.value.replace(/^(,|\.|\?|!)+/,"").replace(/(,|\.|\?|!)+$/,"")})),e?(e,U(e)):"",$(".searchClass").blur()}f&&_(f),$("#historyword_template").bind("click",(function(e){log.info("$(#historyword_template).click "+$(this).attr("data")),t.dovideoshadow=1,E(),U(this.innerText)})),T(),function(){var t=localStorage.getItem("historywords");t&&(c=JSON.parse(t));for(let t=0;t<c.length;t++){var e=c[t];e=e.replace(/^(,|\.|\?|!|\[|\]\(|\))+/,"").replace(/(,|\.|\?|!|\[|\]\(|\))+$/,"");var n=$("#historyword_template").clone(!0);n.attr("id","historyword-"+e.replace(/[^\w]/g,"")),n.attr("data",e),n.text(e),n.css("display","inline-block"),n.show(),$("#historywordspad").append(n)}}(),$(".yibiao").on("click","span svg",(function(){log.info("$(.yibiao).click"),new Audio($(this).attr("playsrc")).play()})),$("#loopLine").click(D),$("#favor").click((function(){log.info("#favor.click");var t=$(this).attr("word");/.*[\u4e00-\u9fa5]+.*$/.test(t)||$(this).attr("word").split(" ").length>3||(function(t){var e=c.indexOf(t);e>-1&&c.splice(e,1);$("#historyword-"+t.replace(/[^\w]/g,"")).remove()}(t),function(t){t=t.replace(/^(,|\.|\?|!|\[|\]\(|\))+/,"").replace(/(,|\.|\?|!|\[|\]\(|\))+$/,"");var e=(c=c||[]).indexOf(t);e>-1&&c.splice(e,1);c.unshift(t);var n=$("#historyword_template").clone(!0);n.attr("id","historyword-"+t.replace(/[^\w]/g,"")),n.attr("data",t),n.text(t),n.css("display","inline-block"),$("#historywordspad").prepend(n),localStorage.setItem("historywords",JSON.stringify(c))}(t))})),t.dovideoshadow=0,$("#zh_subtitles").mousedown((t=>{log.info("#zh_subtitles.mousedown"),$(t.target).hasClass("font")&&(moveStata=!0,_coordinates={clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY},M(_coordinates),$("#zh_subtitles").mousemove((t=>{$(t.target).hasClass("font")&&moveStata&&(_coordinates={clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY},H(_coordinates))})).mouseup((function(t){log.info("#zh_subtitles.mouseup"),$(t.target).hasClass("font")&&(moveStata=!1,_coordinates={clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY},A(_coordinates),$("#zh_subtitles").unbind("mousemove").unbind("mouseup"))})))}));var B,q=0,R=[];function W(e){(q=e,$(".font").css({background:"transparent"}),$(".font.span"+(q-1)).css({background:"#d2cbcb"}),t.dovideoshadow=1,E(),$("#summtrans-word").show(),q>0)&&($("#wordsframe").hide(),U(x.currentwords[q-1]))}function G(){document.activeElement==$("#word-in")[0]?($("#wordsframe").hide(),U($("#word-in").val()),$("#word-in").val()||($("#summtrans").hide(),$("#wordsframe").hide(),$("#video").css("top",0))):($("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").focus(),$("#word-in").trigger("input"),t.dovideoshadow=1,E())}document.onkeydown=function(t){var e=t||window.e,n=e.keyCode||e.which,i=(R=[]).pop();switch(null!=i&&null!=i&&R.push(i),n!=i&&R.push(n),R.join()){case"27":$("#summtrans").hide(),$("#summtrans-word").text(""),$("#summtrans-phonetic").text("").hide(),$("#summtrans-speak").attr("play-url","").hide(),$("#summtrans-value").hide(),$("#summtrans-vv").text(""),$("#wordsframe").hide(),$("#word-in").val(""),$("#words .word").remove(),$("#video").css("top",0);break;case"32":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;$("#video")[0].paused?(J(),V()):E();break;case"13":"INPUT"!=document.activeElement.tagName&&G();break;case"97":case"65":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;N();break;case"115":case"83":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;D();break;case"119":case"87":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;$(".chDialog").is(":hidden")?F():J();break;case"100":case"68":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;O();break;case"113":case"81":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;q<=1?q=x.currentwords.length:q--,W(q);break;case"101":case"69":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;++q>x.currentwords.length&&(q=1),W(q);break}},document.onkeyup=function(t){R.pop()},document.onfocus=function(){R=[]},window.onbeforeunload=function(){navigator.sendBeacon("/mumu/page-out"),log.flush()},document.addEventListener("touchend",(function(t){var e=(new Date).getTime();e-B<=300&&t.preventDefault(),B=e}),!1),$(document.body).bind("resize",(function(){})),$.get("/mumu/wxjsapiticket",(t=>{$.get("/mumu/wxsign",{ticket:t.data.ticket,url:location.href},(t=>{wx.config({debug:!1,appId:t.data.appid,timestamp:t.data.timestamp,nonceStr:t.data.nonceStr,signature:t.data.signature,jsApiList:["updateAppMessageShareData","updateTimelineShareData"]})}))}));var K=location.origin+"/mumu/index.html?videoNo="+o;function Q(t){if(!t)return t;var e=t.match(/(\w*)\s*?(的过去|的现在|的复数|的第三|的ing)/);return e?t=t.replace(e[1],`<span class="lightkeytrans" style="text-decoration: underline;cursor:pointer;margin:0 5px;color: bisque;">${e[1]}</span>`):t}wx.ready((function(){wx.updateAppMessageShareData({title:a.name,desc:"幕幕 - 练英语",link:K,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),wx.updateTimelineShareData({title:a.name+"\n幕幕 - 练英语",link:K,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}})})),$("#video").bind("play",(function(){!function(){t.ajaxtranslate&&t.ajaxtranslate.abort();for(const e of t.translateajaxs)e.abort();t.dovideoshadow=0,$(".dialog").hide(),$("#summtrans").hide(),$("#summtrans-word").text(""),$("#wordsframe").hide(),$("#word-in").val(""),$("#summtrans-value").hide(),$("#summtrans-vv").text(""),$("#summtrans-phonetic").text("").hide(""),$("#summtrans-speak").attr("play-src","").hide(""),$("#video").css("top","0px"),clearInterval(x.monitor),x.monitor=setInterval((function(){S(1e3*k.currentTime)}),10),q=0,"",$("#zh_subtitles span").css({background:"transparent",color:"black"}),$(".startFn").css({display:"none"}),$(".stopFn").css({display:"inline"}),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),$(".searchClass").val(""),$(".yibiao").html(""),$(".fanyi").html(""),$("#videoshasow").hide()}()})).bind("pause",(function(){j()})).bind("mouseover",(function(){$("#video").attr("controls",!0)})).bind("mouseout",(function(){$("#video").attr("controls",!1)})).bind("canplay",(function(){X()})).bind("durationchange",(function(){})).bind("loadeddata",(function(){})).bind("loadstart",(function(){})).bind("playing",(function(){})).bind("progress",(function(){})).bind("readystatechange",(function(){})).bind("suspend",(function(){})).bind("timeupdate",(function(){I()})).bind("waiting",(function(){})).bind("click",(function(){$("#video").attr("controls",!0)})).bind("loadedmetadata",(function(){})).bind("touchend",(function(){$("#video").attr("controls",!0)})).bind("focus",(function(){$("#video").attr("controls",!0)})).bind("blur",(function(){$("#video").attr("controls",!1)})),$("#summtrans-word").bind("click",(function(){log.info("#summtrans-word.click"),$("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").val(this.innerText).focus(),$("#word-in").trigger("input")})),$("#summtrans-speak").bind("click",(function(){log.info("#summtrans-speak.click"),this.audio||(this.audio=new Audio),this.audio.src=$(this).attr("play-url"),this.audio.play()})),$("#wordtempl").bind("click",(function(){log.info("#wordtempl.click"),$("#wordsframe").hide(),$("#word-in").val(""),$("#words .word").remove(),U(this.item.q)})),$("#word-in").bind("input",(function(){log.info("#word-in.input");var t=this,e=this.value;""==this.value?$("#wordsframe_cancel").show():$("#wordsframe_cancel").hide(),e?$.ajax({url:"/mumu/words",method:"get",data:{kw:e,start:1,pageSize:10,from:a.language,to:2},success:function(n){if(t.value==e){$("#words .word").remove();var i=n.data.words;$(i).each(((t,e)=>{var n=$("#wordtempl").clone(!0);n[0].item=e,n.attr("id","word"+(t+1)),n.addClass("word"),n.html(e.q+"&nbsp;&nbsp;"+(e.phonetic?"/"+e.phonetic+"/":"")+"&nbsp;&nbsp;"+(e.explain1||"")+(e.explain2?" | ":"")+(e.explain2||"")+(e.explain3?" | ":"")+(e.explain3||"")+(e.explain4?" | ":"")+(e.explain4||"")+(e.explain5?" | ":"")+(e.explain5||"")),$("#words").append(n),n.show()}))}}}):$("#words .word").remove()})),$("#zh_subtitles").bind("touchstart",(function(t){var e;(log.info("#zh_subtitles.touchstart"),$(t.target).hasClass("font"))&&(e=t,_coordinates={clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY,pageX:e.changedTouches[0].pageX,pageY:e.changedTouches[0].pageY},M(_coordinates),t.preventDefault())})).bind("touchmove",(function(t){var e;$(t.target).hasClass("font")&&(e=t,_coordinates={clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY,pageX:e.changedTouches[0].pageX,pageY:e.changedTouches[0].pageY},H(_coordinates),t.preventDefault())})).bind("touchend",(function(t){var e;(log.info("#zh_subtitles.touchend"),$(t.target).hasClass("font"))&&(e=t,_coordinates={clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY,pageX:e.changedTouches[0].pageX,pageY:e.changedTouches[0].pageY},A(_coordinates),t.preventDefault())})),$("#startFn,#startFn1").bind("click",(function(){log.info("#startFn.click"),V(),$("#video").attr("controls",!1)})),$("#stopFn,#stopFn1").bind("click",(function(){log.info("#stopFn.click"),E(),$("#video").attr("controls",!1)})),$("#prevline").bind("click",(function(){log.info("#prevline.click"),N()})),$("#currline").bind("click",(function(){log.info("#nextline.click"),L()})),$("#nextline").bind("click",(function(){log.info("#nextline.click"),O()})),$("#gear").bind("touchstart",(function(t){log.info("#gear.touchstart");var e=t.targetTouches[0];this.startX=e.pageX,this.startY=e.pageY})).bind("touchmove",(function(e){if(this.startX&&this.startY){var n=e.targetTouches[0];this.endX=n.pageX,this.endY=n.pageY;var i=this.endX-this.startX;this.endY,this.startY;null!=this.lastDist&&null!=this.lastDist||(this.lastDist=i);var s=i-this.lastDist;this.lastDist=i;var a=parseInt(this.style.left.replace("px"))+s;a<=0&&a>=-4900&&(this.style.left=a+"px"),this.xx||(this.xx=0),this.xx=this.xx+s;var o=null;this.xx>30?(o=q,o++):this.xx<-30&&(o=q,o--),x.current&&x.current.enValue&&null!=o&&(o<1&&(o=x.currentwords.length),o>x.currentwords.length&&(o=1),t.dovideoshadow=1,E(),W(o),this.xx=0),e.preventDefault()}})).bind("touchend",(function(t){log.info("#gear.touchend"),this.startX=null,this.startY=null,this.endX=null,this.endY=null,this.lastDist=null,this.xx=0})),$("#gear").bind("mousedown",(function(t){log.info("#gear.mousedown"),this.startX=t.pageX,this.startY=t.pageY})).bind("mousemove",(function(e){if(this.startX&&this.startY){this.endX=e.pageX,this.endY=e.pageY;var n=this.endX-this.startX;this.endY,this.startY;null!=this.lastDist&&null!=this.lastDist||(this.lastDist=n);var i=n-this.lastDist;this.lastDist=n;var s=parseInt(this.style.left.replace("px"))+i;s<=0&&s>=-4900&&(this.style.left=s+"px"),this.xx||(this.xx=0),this.xx=this.xx+i;var a=null;this.xx>30?(a=q,a++):this.xx<-30&&(a=q,a--),x.current&&x.current.enValue&&null!=a&&(a<1&&(a=x.currentwords.length),a>x.currentwords.length&&(a=1),t.dovideoshadow=1,E(),W(a),this.xx=0)}})).bind("mouseup",(function(t){log.info("#gear.mouseup"),this.startX=null,this.startY=null,this.endX=null,this.endY=null,this.lastDist=null,this.xx=0})),$("#replay").bind("click",(function(t){log.info("#replay.click"),$("#video")[0].load()})),$("#hideBtn").bind("click",(function(t){log.info("#hideBtn.click"),$("#zh_subtitles").css("opacity"),1==$("#zh_subtitles").css("opacity")?($("#zh_subtitles").css("opacity",0),$("#hideBtn").text("显示")):($("#zh_subtitles").css("opacity",1),$("#hideBtn").text("隐藏"))})),$("#wholebtn").bind("click",(function(t){log.info("#wholebtn.click"),F()})),$("#searchbtn").bind("click",(function(t){log.info("#searchbtn.click"),G()})),$("#chDialog").bind("click",(function(t){log.info("#chDialog.click"),J()})),document.body.addEventListener("click",(function(){})),$("#goPrevVideo").click((function(){log.info("#goPrevVideo.click"),y()})),$("#goNextVideo").click((function(){log.info("#goNextVideo.click"),T()})),$("#word-in").bind("blur",(function(){""==this.value&&($("#wordsframe").hide(),$("#video").css("top",0),V())})),$("#word-in").bind("focus",(function(){this.select(),""==this.value?$("#wordsframe_cancel").show():$("#wordsframe_cancel").hide()})),$("#searchclear").click((function(){n="",i="",$("#searchtext").text("搜索").css("color","#bfbbbb"),$("#searchpad").slideUp(100),$.ajax({url:"/mumu/explore-videos?",type:"get",data:"shortvideo=1&kw="+n+"&pageSize=10&tag="+i,async:!0,success:function(t){h=-1,(d=[]).push(...t.data.videos),localStorage.setItem("videos",JSON.stringify(d)),T()}})})),$(".searchtag").click((function(){i=this.innerText,$("#searchtext").text("#"+this.innerText+"#").css("color","#6f6f6f"),$("#searchpad").slideUp(100),$.ajax({url:"/mumu/explore-videos?",type:"get",data:"shortvideo=1&kw="+n+"&pageSize=10&tag="+i,async:!0,success:function(t){h=-1,(d=[]).push(...t.data.videos),localStorage.setItem("videos",JSON.stringify(d)),T()}})})),$("#searchpadbtn").click((function(){$("#searchpad").css("height",$(window).height()-($("#video").height()+64+10)+"px"),$("#searchpad").slideDown(100)})),$("#searchpad").bind("touchstart",(function(t){var e=t.targetTouches[0];this.touchstart=e.pageY})).bind("touchmove",(function(t){var e=t.targetTouches[0];this.touchend=e.pageY,0==$(this).scrollTop()&&this.touchstart<this.touchend&&t.preventDefault()})).bind("touchend",(function(t){this.touchend-this.touchstart>50&&$("#searchpad").slideUp(100),this.touchstart=null,this.touchend=null})),$("#searchpad").bind("mousedown",(function(t){this.touchstart=t.pageY})).bind("mousemove",(function(t){this.touchend=t.pageY,0==$(this).scrollTop()&&this.touchstart<this.touchend&&t.preventDefault()})).bind("mouseup",(function(t){this.touchend-this.touchstart>50&&$("#searchpad").slideUp(100),this.touchstart=null,this.touchend=null})),$("#chatminpad").click((function(){$("#chatpad").css("height",$(window).height()-($("#video").height()+64+$("#controlpad").height()+20)+"px"),$("#gearframe1").hide(),$("#prevnextpad").hide(),$("#chatpad").slideDown(100,(function(){$("#video").attr("loop","loop")}))})),$("#chatroombtn").click((function(){$("#chatroompad").show(),$("#chatprivatepad").hide(),$(this).css("background-color","#d7d7d7"),$("#chatprivatebtn").css("background-color","#737373")})),$("#chatprivatebtn").click((function(){$("#chatroompad").hide(),$("#chatprivatepad").show(),$(this).css("background-color","#d7d7d7"),$("#chatroombtn").css("background-color","#737373")})),$("#index").bind("click",(function(t){$(t.target).hasClass("translatable")&&U(t.target.innerHTML)})),$("#index").bind("touchstart",(function(t){if(!($(t.target).parents(".scrollable").length>0||$(t.target).parents("#gearframe1,#zh_subtitles,#prevnextpad,#chatpad").length>0)){var e=t.targetTouches[0];this.indextouchstartX=e.pageX,this.indextouchstartY=e.pageY}})).bind("touchmove",(function(t){if(!($(t.target).parents(".scrollable").length>0||$(t.target).parents("#gearframe1,#zh_subtitles,#prevnextpad,#chatpad").length>0)){var e=t.targetTouches[0];this.indextouchendX=e.pageX,this.indextouchendY=e.pageY,0==$(t.target).scrollTop()&&this.indextouchstartY<this.indextouchendY&&t.preventDefault()}})).bind("touchend",(function(t){$(t.target).parents(".scrollable").length>0||$(t.target).parents("#gearframe1,#zh_subtitles,#prevnextpad,#chatpad").length>0||(this.indextouchstartX&&this.indextouchstartY&&this.indextouchendX&&this.indextouchendY&&(this.indextouchstartX-this.indextouchendX>100?T():this.indextouchstartX-this.indextouchendX<-100&&y()),this.indextouchstartX=null,this.indextouchstartY=null,this.indextouchendX=null,this.indextouchendY=null)})),$("#index").bind("mousedown",(function(t){$(t.target).parents(".scrollable").length>0||$(t.target).parents("#gearframe1,#zh_subtitles,#prevnextpad,#chatpad").length>0||(this.indextouchstartX=t.pageX,this.indextouchstartY=t.pageY)})).bind("mousemove",(function(t){$(t.target).parents(".scrollable").length>0||$(t.target).parents("#gearframe1,#zh_subtitles,#prevnextpad,#chatpad").length>0||(this.indextouchendX=t.pageX,this.indextouchendY=t.pageY,0==$(t.target).scrollTop()&&this.indextouchstartY<this.indextouchendY&&t.preventDefault())})).bind("mouseup",(function(t){$(t.target).parents(".scrollable").length>0||$(t.target).parents("#gearframe1,#zh_subtitles,#prevnextpad,#chatpad").length>0||(this.indextouchstartX&&this.indextouchstartY&&this.indextouchendX&&this.indextouchendY&&(this.indextouchstartX-this.indextouchendX>100?T():this.indextouchstartX-this.indextouchendX<-100&&y()),this.indextouchstartX=null,this.indextouchstartY=null,this.indextouchendX=null,this.indextouchendY=null)})),$("#chatprivatebtn,#chatroombtn,#chatprivatepad,#chatinput").bind("touchstart",(function(t){var e=t.targetTouches[0];this.touchstart=e.pageY})).bind("touchmove",(function(t){var e=t.targetTouches[0];this.touchend=e.pageY,0==$(this).scrollTop()&&this.touchstart<this.touchend&&t.preventDefault()})).bind("touchend",(function(t){this.touchend-this.touchstart>50&&($("#gearframe1").show(),$("#prevnextpad").show(),$("#chatpad").slideUp(100,(function(){$("#video").attr("loop",!1)}))),this.touchstart=null,this.touchend=null})),$("#chatprivatebtn,#chatroombtn,#chatprivatepad,#chatinput").bind("mousedown",(function(t){this.mousedown=t.pageY})).bind("mousemove",(function(t){this.mouseup=t.pageY,0==$(this).scrollTop()&&this.mousedown<this.mouseup&&t.preventDefault()})).bind("mouseup",(function(t){this.mouseup=t.pageY,this.mouseup-this.mousedown>50&&($("#gearframe1").show(),$("#prevnextpad").show(),$("#chatpad").slideUp(100,(function(){$("#video").attr("loop",!1)}))),this.mousedown=null,this.mouseup=null})),$("#chatmsgspad").bind("touchstart",(function(t){var e=t.targetTouches[0];this.touchstart=e.pageY})).bind("touchmove",(function(t){var e=t.targetTouches[0];this.touchend=e.pageY,0==$("#chatmsgspad").scrollTop()&&this.touchstart<this.touchend&&t.preventDefault()})).bind("touchend",(function(t){this.touchend-this.touchstart>50&&0==$("#chatmsgspad").scrollTop()&&($("#gearframe1").show(),$("#prevnextpad").show(),$("#chatpad").slideUp(100,(function(){$("#video").attr("loop",!1)}))),this.touchstart=null,this.touchend=null})),$("#chatmsgspad").bind("mousedown",(function(t){this.mousedown=t.pageY})).bind("mousemove",(function(t){this.mouseup=t.pageY,0==$("#chatmsgspad").scrollTop()&&this.mousedown<this.mouseup&&t.preventDefault()})).bind("mouseup",(function(t){this.mouseup=t.pageY,this.mouseup-this.mousedown>50&&0==$("#chatmsgspad").scrollTop()&&($("#gearframe1").show(),$("#prevnextpad").show(),$("#chatpad").slideUp(100,(function(){$("#video").attr("loop",!1)}))),this.mousedown=null,this.mouseup=null})),$("#word-in").keydown((function(){13==(window.event||e).keyCode&&G()})),$("#chatinput").keydown((function(){if(13==(window.event||e).keyCode){if(""==this.value)return;var t={text:this.value,action:1,looking:a.name};Z.send(JSON.stringify(t)),this.value=""}}));var Z=null;function tt(){(Z=new WebSocket(`wss://${location.host}/mumu/websocket/${pagePre.login.userNo}`)).onopen=function(){t.ws=Z},Z.onmessage=function(t){var e=JSON.parse(t.data);if(1==e.action){null!=e.nickname&&(e.nickname=e.nickname.substr(0,1)+"..."+e.nickname.substr(3));var n=$("#chatmsgtemple").clone(!0);n.attr("id","chatmsg"+e.msgNo),e.userNo==$.cookie("token")&&n.css("color","green"),n.find(".name").text(e.nickname||"网友"),n.find(".msg").text(e.text),n.find(".looking").text(e.looking),n.show(),$("#chatmsgspad").prepend(n),$("#lastmsg").text((e.nickname||"网友").substr(0,6)+" : "+e.text)}},Z.onclose=function(t){},Z.onerror=function(t){}}tt(),setInterval((()=>{if(Z&&3==Z.readyState&&tt(),!$("#video")[0].paused){var t=localStorage.getItem("totalsecondsno");t=parseInt(t||0),t+=5,localStorage.setItem("totalsecondsno",t),Z.send(JSON.stringify({action:2,videoNo:o,seconds:5}))}}),5e3),setInterval((function(){Z&&1==Z.readyState&&Z.send("0")}),3e4),statisticsexps(),$.ajax({url:"/mumu/chatroom-msgs?",type:"get",data:"rcount=300",async:!0,success:function(t){$(t.data.rows).each(((t,e)=>{null!=e.nickname&&(e.nickname=e.nickname.substr(0,1)+"..."+e.nickname.substr(3)),0==t&&($("#lastmsg").text((e.nickname||"网友").substr(0,6)+" : "+e.text),$("#chatminpad").show());var n=$("#chatmsgtemple").clone(!0);n.attr("id","chatmsg"+e.msgNo),e.userNo==$.cookie("token")&&n.css("color","green"),n.find(".name").text(e.nickname||"网友"),n.find(".msg").text(e.text),n.find(".looking").text(e.looking),n.show(),$("#chatmsgspad").append(n)})),0==t.data.rows.length&&($("#lastmsg").text("聊天室"),$("#chatminpad").show())}})}();