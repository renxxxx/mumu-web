!function(){var o={manual:1};window.page=o,o.translateajaxs=[],o.wordbookWordsAjaxs=[];var t=getUrlParam("olh"),s=(getUrlParam("userNo"),getUrlParam("history"));o.rawsubtitles=null,o.seed=Math.ceil(100*Math.random()),o.rstart=1,o.currVideos=[];var r="",a="";o.shortWordText=null,o.favoredWords={rows:[],rstart:1,rcount:50,currRows:[]},o.historyWords={rows:[],rstart:1,rcount:50,currRows:[]},o.wordbooks={rows:[],rstart:1,rcount:50,currRows:[],selected:null,map:{}},o.wordbooksOnAdd={rows:[],rcount:50,currRows:[],selected:null},o.currWord=null,o.removeWordsControl={favor:null,history:null},o.loopVideoCountCache=null,o.loopVideoCount=null,o.onlyLookUserNo=null,o.onlyLookHimVideos={rows:[],rcount:10,currRows:[],inx:0},o.trueVideos={rows:[],rcount:10,currRows:[],map:{},noes:[],inx:0},o.loopVideos={on:null,count:1,rows:[],inx:0},o.seriesVideos={seriesNo:null,rcount:100,rows:[],inx:0,map:{}},o.closeView=0;var n,d,i=0,c=getUrlParam("videoNo"),l=null,u=parseInt(localStorage.getItem(config.project+"-rollInx"));(o.rollInx=u||0,o.words1ajaxs=[],o.exploreVideos={rows:[],currRows:[],inx:0,map:{},rstart:0},setTimeout((function(){$("#logo").hide(),$("#index").show()}),1e3),$("#video")[0].crossOrigin="anonymous",document.addEventListener("WeixinJSBridgeReady",(function(){$("#video")[0].play()}),!1),c)&&((l=JSON.parse(localStorage.getItem(config.project+"-video-"+c)))||$.ajax({url:"/mumu/video?",ajaxCache:!0,data:"videoNo="+c,async:!1,success:function(o){0==o.code?l=o.data.video:20==o.code&&login()}}));localStorage.getItem(config.project+"-currentTime-"+d);var h=parseInt(localStorage.getItem(config.project+"-currentIndex-"+d)),m=JSON.parse(localStorage.getItem(config.project+"-currentCaption-"+d)),w=m,p=0,f=0,v={subtitles:"",monitor:"",subtitlesList:[],current:m,currentIndex:h};o.en=v;I=I;var b=$("#video")[0];function g(e){var t={shortvideo:1,longvideo:1};if(t.kw=r,t.pageSize=10,t.userNo=o.onlyLookUserNo,t.rstart=1,t.sort="orderNoInUser,orderNoInSeries",t.order="desc,asc",o.onlyLookHimVideos.rows.length>0){t.init=0;var s=o.onlyLookHimVideos.rows[o.onlyLookHimVideos.rows.length-1];t.lastNo=s.no,t.lastCreateTime=s.createTime,t.lastOrderNoInSeries=s.orderNoInSeries,t.lastOrderNoInUser=s.orderNoInUser}else t.init=1,t.lastNo=null,t.lastCreateTime=null,t.lastOrderNoInSeries=null,t.lastOrderNoInUser=null;$.ajax({url:"/mumu/explore-user-videos",data:t,async:e,success:function(s){0==s.code?(s.data.videos.length>0?(o.onlyLookHimVideos.rows.push(...s.data.videos),o.onlyLookHimVideos.currRows=s.data.videos,o.trueVideos.rows.push(...s.data.videos),o.trueVideos.currRows=s.data.videos):0==t.init&&(o.onlyLookHimVideos.rows=[],o.onlyLookHimVideos.currRows=[],g(e)),$("#video1").attr("src","./img/black.png")):20==s.code&&login()}})}function k(e){if(s)x(e);else{$.ajax({url:"/mumu/explore-videos?",data:"shortvideo=1&kw="+a+"&pageSize=10&seed="+o.seed+"&rstart="+(o.exploreVideos.rows.length+1)+"&userNo="+(o.onlyLookUserNo||" ")+"&mo="+ttb(getUrlParam("mo")),async:e,success:function(t){0==t.code?(t.data.videos.length>0?(o.exploreVideos.rows.push(...t.data.videos),o.exploreVideos.currRows=t.data.videos,o.exploreVideos.rstart=o.exploreVideos.rows.length+1,o.trueVideos.rows.push(...t.data.videos),o.trueVideos.currRows=t.data.videos):(o.seed=Math.ceil(100*Math.random()),$.ajax({url:"/mumu/explore-videos?",data:"shortvideo=1&kw="+r+"&pageSize=10&seed="+o.seed+"&rstart=1&userNo="+(o.onlyLookUserNo||" ")+(o.onlyLookUserNo||" ")+"&mo="+ttb(getUrlParam("mo")),async:e,success:function(e){e.data.videos.length>0&&(o.exploreVideos.rows.push(...e.data.videos),o.exploreVideos.currRows=e.data.videos,o.trueVideos.rows.push(...e.data.videos),o.trueVideos.currRows=e.data.videos,o.exploreVideos.rstart=1)}})),$("#video1").attr("src","./img/black.png")):20==t.code&&login()}})}}function x(e){var t={rcount:10,rstart:1};if(o.exploreVideos.rows.length>0){t.init=0;var s=o.exploreVideos.rows[o.exploreVideos.rows.length-1];t.lastNo=s.no,t.lastHistoryCreateTime=s.historyCreateTime,t.lastOrderNoInSeries=s.orderNoInSeries,t.lastOrderNoInUser=s.orderNoInUser}else t.init=1,t.lastNo=null,t.lastHistoryCreateTime=null,t.lastOrderNoInSeries=null,t.lastOrderNoInUser=null;$.ajax({url:"/mumu/watch-history-videos?",data:t,async:e,ajaxCache:{timeout:5},success:function(t){0==t.code?(t.data.videos.length>0?(o.exploreVideos.rows.push(...t.data.videos),o.exploreVideos.currRows=t.data.videos,o.exploreVideos.rstart=o.exploreVideos.rows.length+1,o.trueVideos.rows.push(...t.data.videos),o.trueVideos.currRows=t.data.videos):(o.exploreVideos.rows=[],o.exploreVideos.currRows=[],x(e)),$("#video1").attr("src","./img/black.png")):20==t.code&&login()}})}function P(e){if((e=e||{}).local,Z&&n){var t=$("#video")[0].currentTime;t-0>1&&(n.history={videoNo:n.no,duration:$("#video")[0].duration,watchStartTime:0,watchEndTime:t,width:$("#video")[0].videoWidth,height:$("#video")[0].videoHeight,difficulty:o.difficulty,seriesNo:n.seriesNo,orderNoInSeries:n.orderNoInSeries},e.local||Z.send(JSON.stringify({action:12,notrecord:ttb(s),...n.history})))}}function y(){f=0,p=0,P(),O(),R(),l&&(o.trueVideos.rows.unshift(l),o.trueVideos.currRows.unshift(l),o.exploreVideos.rows.unshift(l),o.exploreVideos.currRows.unshift(l),l=null),log.info(o.trueVideos.rows.length+" "+o.trueVideos.inx),0!=o.trueVideos.rows.length&&o.trueVideos.rows.length!=o.trueVideos.inx||(log.info("sync"),o.onlyLookUserNo?g(!1):k(!1),o.trueVideos.currRows.forEach((function(e,t){o.trueVideos.map["no"+e.no],o.trueVideos.noes.push(e.no)}))),o.trueVideos.rows[o.trueVideos.inx+4-1]||(log.info("async"),o.onlyLookUserNo?g(!0):k(!0),o.trueVideos.currRows.forEach((function(e,t){o.trueVideos.map["no"+e.no],o.trueVideos.noes.push(e.no)}))),o.trueVideos.rows[o.trueVideos.inx+1-1]&&(o.loopVideos.on?(o.loopVideos.inx<o.loopVideos.count?(o.trueVideos.inx++,o.loopVideos.inx++):(o.trueVideos.inx=o.trueVideos.inx-o.loopVideos.count+1,o.loopVideos.inx=1),o.loopVideos.count>1&&$("#loopVideoBtn").text("循环\n"+o.loopVideos.inx+"/"+o.loopVideos.count)):o.trueVideos.inx++,d=o.trueVideos.rows[o.trueVideos.inx-1].no,n=o.trueVideos.rows[o.trueVideos.inx-1],log.info(d),V(n))}function T(){f=0,p=0,P(),O(),R(),o.trueVideos.rows[o.trueVideos.inx-1-1]?(o.trueVideos.inx--,o.onlyLookUserNo?o.onlyLookHimVideos.inx--:o.exploreVideos.inx--,d=o.trueVideos.rows[o.trueVideos.inx-1].no,n=o.trueVideos.rows[o.trueVideos.inx-1],o.trueVideos.rows[o.trueVideos.inx+1-1]?$("#video1").attr("src",o.trueVideos.rows[o.trueVideos.inx+1-1].cover):$("#video1").attr("src",""),o.trueVideos.rows[o.trueVideos.inx-1-1]?$("#video2").attr("src",o.trueVideos.rows[o.trueVideos.inx-1-1].cover):$("#video2").attr("src","./img/black.png"),V(n)):location.replace("./index.html")}function V(e){n=e,d=e.no,o.videoNo=d,clearTimeout(o.timeout999),J=location.origin+"/mumu?videoNo="+d,wx.updateAppMessageShareData({title:ttb(n.chname),desc:ttb(n.nickname),link:J,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),wx.updateTimelineShareData({title:ttb(n.chname)+"\n"+ttb(n.nickname),link:J,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),$("#zh_subtitles").html("");var t=ttb(n.chreference)||ttb(n.seriesChname),s=t?"#"+t+" ":t;t!=ttb(n.chname)&&(s+=ttb(n.chname)),n.seriesNo?($("#inSeriesPad").css("display","inline-block"),$("#inSeriesPad .no").text(n.orderNoInSeries),$("#title").css("width","calc(100% - 169px)")):($("#inSeriesPad").hide(),$("#inSeriesPad .no").text(""),$("#title").css("width","calc(100% - 134px)")),$("#title").text(s),n.userNo?($("#headimg").attr("src",n.headimg),$("#headimg").css("display","inline-block"),$("#onlyLookHim").css("display","inline-block"),$("#chatminpad").css("width","calc(100% - 105px)"),$("#videoNickname").text(n.nickname)):($("#headimg").hide(),$("#onlyLookHim").hide(),$("#chatminpad").css("width","100%")),w=null,v.currentIndex=0,$.ajax({url:n.captionUrl,type:"get",async:!1,success:function(e){!function(e){o.rawsubtitles=e,v.subtitlesList=[];let t=[];t=e.split(/[(\r\n)\r\n]+/),t.forEach(((o,e)=>{if(o||t.splice(e,1),new RegExp(/^(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d/).test(o)){var s=t[e+2],r=t[e+1];if(s.indexOf("{\\pos")>=0||r.indexOf("{\\pos")>=0)return;v.subtitlesList.push({startTime:_(o.split(" --\x3e ")[0].replace(",",".")),endTime:_(o.split(" --\x3e ")[1].replace(",",".")),chValue:r,enValue:s})}}));for(let o=0;o<v.subtitlesList.length;o++){o;const e=v.subtitlesList[o],t=v.subtitlesList[o+1];o<v.subtitlesList.length-2&&t.startTime-e.endTime>1e3&&v.subtitlesList.splice(o+1,0,{startTime:parseInt(e.endTime)+1e3,endTime:t.startTime,chValue:"",enValue:""})}var s=v.subtitlesList[0];s&&s.startTime>0&&v.subtitlesList.splice(0,0,{startTime:0,endTime:s.startTime,chValue:"",enValue:""});var r=v.subtitlesList[v.subtitlesList.length-1];r&&v.subtitlesList.push({startTime:parseInt(r.endTime)+1e3,endTime:1e3*n.duration,chValue:"",enValue:""});v.currentIndex>=0?(v.current=v.subtitlesList[v.currentIndex],I(v.current)):I(v.subtitlesList[0])}(e)}}),n.chatCount||(n.chatCount=parseInt(randomnum(2))),$("#chatCount").text(n.chatCount),f=0,p=0,o.closeView?($("#video").attr("poster",null),$("#video").css("background-image","url("+n.cover+")"),$("#video").css("background-repeat","no-repeat"),$("#video").css("background-size","contain"),$("#video").css("background-position","center"),$("#video").attr("src",n.audio16k||n.audio||n.url)):($("#video").attr("src",n.url),$("#video").attr("poster",n.cover),$("#video").css("background-image","unset"),$("#video").css("background-repeat","unset"),$("#video").css("background-size","unset"),$("#video").css("background-position","unset")),$("#videobox").css("top","0"),$("#video").attr("autoplay",!0),X()}function S(){!p&&n.history&&n.history.watchEndTime?n.duration-n.history.watchEndTime>1?($("#video")[0].currentTime=n.history.watchEndTime,$("#video")[0].currentTime>=n.history.watchEndTime&&($("#video")[0].currentTime=n.history.watchEndTime-2,p=1)):($("#video")[0].currentTime=0,p=1):p=1}function W(){!f&&n.history&&n.history.watchEndTime?n.duration-n.history.watchEndTime>1&&($("#video")[0].currentTime=n.history.watchEndTime,$("#video")[0].currentTime>=n.history.watchEndTime?($("#video")[0].currentTime=n.history.watchEndTime-2,f=1):($("#video")[0].currentTime=0,f=1)):f=1,b.paused&&N(1e3*b.currentTime)}function N(e){if($("#loading").hide(),$("#progressbar .slider").css("width",b.currentTime/b.duration*100+"%"),$("#video")[0].duration-$("#video")[0].currentTime<3?$("#chooseDifficultyPad").is(":hidden")&&($("#chooseDifficultyPad .e").css("background-color","#ffffff"),$("#chooseDifficultyPad").fadeIn(300)):$("#chooseDifficultyPad").is(":hidden")||($("#chooseDifficultyPad").hide(),$("#chooseDifficultyPad .e").css("background-color","#ffffff")),w){if(!(w.startTime<e))return;w=null}if(!(v.current&&v.current.startTime<=e&&e<v.current.endTime)){var t=v.subtitlesList[v.currentIndex+1];if(t&&t.startTime<=e&&e<t.endTime)return o.diandu&&O(),i?void C():(v.current=t,v.currentIndex++,void I(t));t&&e<t.startTime&&(!v.current||e>v.current.endTime)||$(v.subtitlesList).each((function(o,t){if(t.startTime<=e&&e<t.endTime)return v.current=t,v.currentIndex=o,void I(t)}))}}function I(o){if(!o)return;localStorage.setItem(config.project+"-currentCaption-"+d,JSON.stringify(o)),localStorage.setItem(config.project+"-currentIndex-"+d,v.currentIndex);let e=o.enValue.split(" ");$("#zh_subtitles").html(""),v.currentwords=e;for(let o=0;o<e.length;o++)if("\\n"!=e[o]){var t=e[o].split("\\n");if(t[0]){var s=$('<span style="height: 30px;color:#ffffff;user-select: none;display: inline-block;cursor: pointer;font-weight: 900;font-size: 18px;padding-left:3px;padding-right:3px;box-sizing: border-box;" index="'+o+'" class="font span'+o+'">'+t[0]+"</span>");s.bind("mouseout",(function(){isPc()&&$(this).css("border-bottom","none")})).bind("mouseover",(function(){isPc()&&$(this).css("border-bottom","2px solid #ffffff")})),$("#zh_subtitles").append(s)}t[1]&&e.splice(o+1,0,"\\n",t[1]),t[2]&&e.splice(o+3,0,"\\n",t[2]),t[3]&&e.splice(o+5,0,"\\n",t[3])}else $("#zh_subtitles").append("<br/>");$("#chDialog").html(o.chValue.replace(/\\n/g,"<br/>")),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),A=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),$("#summtrans").hide(),$("#wordsframe").hide(),$("#videoshasow").hide(),$("#word-in").val(""),$("#videobox").css("top","0px")}function L(){if(v.currentIndex>0){var o=v.currentIndex,e=v.subtitlesList[--o];e&&(e.enValue||(e=v.subtitlesList[--o]),e&&(v.currentIndex=o,v.current=e,w=e,e.startTime/1e3,$("#video")[0].currentTime=e.startTime/1e3,log.debug("set st: "+e.startTime/1e3+" ct: "+$("#video")[0].currentTime+" - "+v.current.enValue.substr(0,10)),I(e),A=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}}function F(){i?(i=0,$("#loopLine").css("background-color","unset")):(i=1,$("#loopLine").css("background-color","#5a5a5a"))}function R(){i=0,$("#loopLine").css("background-color","unset")}function C(){var o=v.currentIndex,e=v.current;e&&(e.enValue||(e=v.subtitlesList[--o]),e&&(v.currentIndex=o,v.current=e,$("#video")[0].currentTime=e.startTime/1e3,w=e,e.startTime/1e3,I(e),A=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}function D(){var o=v.currentIndex,e=v.subtitlesList[++o];e&&(e.enValue||(e=v.subtitlesList[++o]),e&&(v.currentIndex=o,v.current=e,w=e,e.startTime/1e3,$("#video")[0].currentTime=e.startTime/1e3,I(e),A=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}function B(o){return o?o.replace(/^(\s|:|-|,|\.|\?|!|\[|\]\(|\))+/,"").replace(/(\s|:|-|,|\.|\?|!|\[|\]\(|\))+$/,"").toLowerCase():""}function Y(e,t,s){e=B(e),s||(o.shortWordText="",o.currWordText=e),$("#favor").text(""),$("#addToWordbookBtn").text(""),o.dovideoshadow=1,O(),j(),$("#wordsframe").hide(),$("#summtrans").show(),$("#summtrans-word").text(e),$("#word-in").val(e),clearTimeout(window.timeoutdo1),window.timeoutdo1=setTimeout((function(){if($("#favor").attr("word",e),window.aaa=setTimeout((function(){$("#summtrans-phonetic").hide(),$("#summtrans-speak").hide(),$("#summtrans-value").hide(),$("#favor").text(""),$("#addToWordbookBtn").text("")}),500),null==e||null==e||!e.toString().trim())return $("#summtrans-phonetic").hide(),$("#summtrans-speak").hide(),$("#summtrans-value").hide(),$("#favor").text(""),void $("#addToWordbookBtn").text("");for(const e of o.translateajaxs)e.abort();for(const e of o.words1ajaxs)e.abort();o.translateajaxs.push($.ajax({url:"/mumu/translate?from="+n.language+"&to=2&q="+e,ajaxCache:!0,async:!0,success:function(e){var s=!1;clearTimeout(window.aaa),o.currWord=e.data,e.data.speakUrl=e.data.ukSpeech?e.data.ukSpeech:e.data.usSpeech?e.data.usSpeech:e.data.speakUrl,e.data.phonetic=e.data.ukPhonetic?e.data.ukPhonetic:e.data.usPhonetic?e.data.usPhonetic:e.data.phonetic,$("#favor").text("收 藏"),$("#addToWordbookBtn").text("加入单词本"),e.data.phonetic?$("#summtrans-phonetic").text("/"+e.data.phonetic+"/").show():$("#summtrans-phonetic").hide(),e.data.speakUrl?$("#summtrans-speak").attr("play-url",e.data.speakUrl).show():$("#summtrans-speak").hide(),$("#summtrans-vv").html(""),$("#summtrans-vv").scrollTop(0),e.data.explains?$(e.data.explains).each((function(o,e){s=!0,$("#summtrans-vv").append(`<div>${q(e)}</div>`)})):e.data.translation&&(s=!0,$("#summtrans-vv").append(`<div>${q(e.data.translation)}</div>`)),e.data.wfs&&$("#summtrans-vv").append(`<div style="margin-top:10px">${q(e.data.wfs)}</div>`),e.data.webs&&($("#summtrans-vv").append('<div style="margin-top:10px;">网络释义: </div>'),$(e.data.webs).each((function(o,e){s=!0,$("#summtrans-vv").append(`<div>${q(e)}</div>`)}))),!s&&e.data.translations&&$(e.data.translations).each((function(o,e){$("#summtrans-vv").append(`<div>${q(e)}</div>`)})),$(".lightkeytrans").bind("click",(function(){Y(this.innerText,1)})),$("#wordsframe").hide(),$("#summrest").show(),$("#summtrans-vv").show(),$("#summtrans-value").show(),$("#summtrans").show(),$("#videobox").css("top","-1000px"),$("#summtrans-vv").scrollTop(0);var r=localStorage.getItem(config.project+"-totaltranslatesno");r=r||0,r++,localStorage.setItem(config.project+"-totaltranslatesno",r),$("#summtrans-speak").click();var a,n,d=localStorage.getItem(config.project+"-translateed");(d=parseInt(d?++d:1))>=4&&(d=1),localStorage.setItem(config.project+"-translateed",d),t&&(a={word:o.currWord.word,translation:o.currWord.translation,phonetic:o.currWord.phonetic,historyWordNo:randomnum(12)},n=lo(a),o.historyWords.rows.splice(0,0,a),$("#historyWordsPad .words").prepend(n),Z.send(JSON.stringify({action:6,word:o.currWord.word})))}}))}),200)}function O(){$("#video")[0].pause()}function X(){$("#video")[0].play(),clearTimeout(window.timeoutdo1)}function U(){clearInterval(v.monitor),$(".stopFn").css({display:"none"}),$(".startFn").css({display:"inline"}),$("#video")[0].currentTime==$("#video")[0].duration&&(o.timeout999=setTimeout(y,1e3))}function j(){if($("#videoshasow").is(":hidden")){var o=videocapture($("#video")[0]);$("#videoshasowimg").attr("src",o.src),o.src||$("#videoshasowimg").css("background-color","#000000"),$("#videoshasow").show(),$("#videobox").css("top","-1000px")}}function _(o){let e=o.split(":"),t=0;return e.forEach(((o,e)=>{switch(e){case 0:t+=60*parseFloat(o)*60*1e3;break;case 1:t+=60*parseFloat(o)*1e3;break;case 2:t+=1e3*parseFloat(o);break}})),t}m&&I(m),$("#historyword_template").bind("click",(function(e){log.info("$(#historyword_template).click "+$(this).attr("data")),o.dovideoshadow=1,O(),eo(this.innerText),Y(this.innerText),$(".historyword").css("background-color","#ffffff"),$(this).css("background-color","#e7e7e7")})),$("#video").click((function(){var o=$("#video").css("object-fit");"cover"==o?o="contain":"contain"!=o&&o||(o="cover"),$("#video").css("object-fit",o)})),setTimeout(P({local:1}),1e3),y(),$("#chooseDifficultyPad .e").click((function(){o.difficulty=$(this).attr("data"),$("#chooseDifficultyPad .e").css("background-color","#ffffff"),$(this).css("background-color","#8a8a8a")})),$(".yibiao").on("click","span svg",(function(){log.info("$(.yibiao).click"),new Audio($(this).attr("playsrc")).play()})),$("#loopLine").click(F),$("#favor").click((function(){var e,t;log.info("#favor.click"),e={word:o.currWord.word,translation:o.currWord.translation,phonetic:o.currWord.phonetic,favorWordNo:randomnum(12)},t=io(e),o.favoredWords.rows.splice(0,0,e),$("#favorsPad .words").prepend(t),Z.send(JSON.stringify({action:4,word:o.currWord.word}))})),o.dovideoshadow=0;var E,A=0,H=[];function z(e){(A=e,$(".font").css({background:"transparent"}),$(".font.span"+(A-1)).css({background:"#d2cbcb"}),o.dovideoshadow=1,O(),$("#summtrans-word").show(),A>0)&&($("#wordsframe").hide(),Y(v.currentwords[A-1],1))}function M(){var o=B($("#word-in").val());document.activeElement==$("#word-in")[0]?($("#wordsframe").hide(),eo(o),Y(o,1),$("#word-in").val()||($("#summtrans").hide(),$("#wordsframe").hide(),$("#videobox").css("top",0))):($("#words .word").remove(),$("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").focus(),$("#word-in").trigger("input"),O(),j())}if(document.onkeydown=function(e){var t=e||window.e,s=t.keyCode||t.which,r=(H=[]).pop();switch(null!=r&&null!=r&&H.push(r),s!=r&&H.push(s),H.join()){case"27":$("#summtrans").hide(),$("#summtrans-word").text(""),$("#summtrans-phonetic").text("").hide(),$("#summtrans-speak").attr("play-url","").hide(),$("#summtrans-value").hide(),$("#summtrans-vv").text(""),$("#wordsframe").hide(),$("#word-in").val(""),$("#words .word").remove(),$("#videobox").css("top",0);break;case"32":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;$("#video")[0].paused?(X(),o.manual=1):(o.manual=2,O());break;case"13":"INPUT"!=document.activeElement.tagName&&M();break;case"97":case"65":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;L();break;case"115":case"83":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;F();break;case"119":case"87":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;K();break;case"100":case"68":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;D();break;case"113":case"81":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;A<=1?A=v.currentwords.length:A--,z(A);break;case"101":case"69":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;++A>v.currentwords.length&&(A=1),z(A);break}},document.onkeyup=function(o){H.pop()},document.onfocus=function(){H=[]},window.onbeforeunload=function(){P(),navigator.sendBeacon("/mumu/page-out"),log.flush()},document.addEventListener("touchend",(function(o){var e=(new Date).getTime();e-E<=300&&o.preventDefault(),E=e}),!1),$(document.body).bind("resize",(function(){})),is_weixn()){$.post("/mumu/wxjsapiticket",(o=>{$.post("/mumu/wxsign",{ticket:o.data.ticket,url:location.href},(o=>{wx.config({debug:!1,appId:o.data.appid,timestamp:o.data.timestamp,nonceStr:o.data.nonceStr,signature:o.data.signature,jsApiList:["updateAppMessageShareData","updateTimelineShareData"]})}))}));var J=location.origin+"/mumu?videoNo="+d;wx.ready((function(){wx.updateAppMessageShareData({title:ttb(n.chname),desc:ttb(n.nickname),link:J,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),wx.updateTimelineShareData({title:ttb(n.chname)+"\n"+ttb(n.nickname),link:J,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}})}))}function q(o){if(!o)return o;var e=o.replace(/(\w+)/g,'<span class="lightkeytrans" style="cursor:pointer;margin:0 3px 0 0;color: bisque;">$1</span>');return e=e.replace(/<span.+?>(vi|adj|vt|pron|n|v|num|adv|art|conj|prep|abbr|int|det)<\/span>/,"$1")}function G(){o.subtitlesStatus||(o.subtitlesStatus=0),o.subtitlesStatus++,o.subtitlesStatus>3&&(o.subtitlesStatus=1),1==o.subtitlesStatus?($("#chDialog").css("visibility","visible"),$("#zh_subtitles").css("visibility","visible")):2==o.subtitlesStatus?($("#chDialog").css("visibility","hidden"),$("#zh_subtitles").css("visibility","visible")):3==o.subtitlesStatus&&($("#chDialog").css("visibility","hidden"),$("#zh_subtitles").css("visibility","hidden"))}function K(){$("#chDialog").is(":hidden")?($("#chDialog").show(),$("#wholebtnlash").hide()):($("#chDialog").hide(),$("#wholebtnlash").show())}function Q(){clearInterval(o.loopVideoChooseInterval),$("#chooseLoopVideosCountPad").hide(),o.loopVideos.on=0,$("#loopVideoBtn").css("background-color","unset"),o.loopVideos.count>1&&($("#loopVideoBtn").css("line-height","33px"),$("#loopVideoBtn").css("white-space","unset"),$("#loopVideoBtn").text("循环"))}$("#video").bind("play",(function(){!function(){o.ajaxtranslate&&o.ajaxtranslate.abort();for(const e of o.translateajaxs)e.abort();$("#video1").css("left","100%"),$("#video2").css("left","-100%"),o.trueVideos.rows[o.trueVideos.inx+1-1]&&$("#video1").attr("src",o.trueVideos.rows[o.trueVideos.inx+1-1].cover),o.trueVideos.rows[o.trueVideos.inx-1-1]&&$("#video2").attr("src",o.trueVideos.rows[o.trueVideos.inx-1-1].cover),$(".historyword").css("background-color","#ffffff"),o.dovideoshadow=0,$(".dialog").hide(),$("#summtrans").hide(),$("#summtrans-word").text(""),$("#wordsframe").hide(),$("#word-in").val(""),$("#summtrans-value").hide(),$("#summtrans-vv").text(""),$("#summtrans-phonetic").text("").hide(""),$("#summtrans-speak").attr("play-src","").hide(""),$("#videobox").css("top","0px"),clearInterval(v.monitor),v.monitor=setInterval((function(){N(1e3*b.currentTime)}),10),A=0,"",$("#zh_subtitles span").css({background:"transparent",color:"#ffffff"}),$(".startFn").css({display:"none"}),$(".stopFn").css({display:"inline"}),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),$(".searchClass").val(""),$(".yibiao").html(""),$(".fanyi").html(""),$("#videoshasow").hide()}()})).bind("pause",(function(){U()})).bind("mouseover",(function(){})).bind("mouseout",(function(){})).bind("canplay",(function(){S()})).bind("durationchange",(function(){})).bind("loadeddata",(function(){})).bind("loadstart",(function(){})).bind("playing",(function(){})).bind("progress",(function(){})).bind("readystatechange",(function(){})).bind("suspend",(function(){})).bind("timeupdate",(function(){W()})).bind("waiting",(function(){})).bind("click",(function(){})).bind("loadedmetadata",(function(){})).bind("touchend",(function(){})).bind("focus",(function(){})).bind("blur",(function(){})),$("#summtrans-word").bind("click",(function(){log.info("#summtrans-word.click"),$("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").val(this.innerText).focus(),$("#word-in").trigger("input")})),$("#summtrans-speak").bind("click",(function(){log.info("#summtrans-speak.click"),this.audio||(this.audio=new Audio),this.audio.src=$(this).attr("play-url"),this.audio.play()})),$("#wordtempl").bind("click",(function(){log.info("#wordtempl.click"),$("#wordsframe").hide(),$("#word-in").val(""),$("#words .word").remove(),eo(this.item.word),Y(this.item.word,1)})),$("#word-in").bind("input",(function(){log.info("#word-in.input");var e=$("#word-in")[0],t=$("#word-in")[0].value;""==t?$("#wordsframe_cancel").show():$("#wordsframe_cancel").hide(),clearTimeout(o.ssssaaa),o.ssssaaa=setTimeout((function(){$("#words .word").remove()}),1e3),t?o.words1ajaxs.push($.ajax({url:"/mumu/words1",data:{kw:t,rstart:1,rcount:100,from:n.language,to:2},ajaxCache:!0,success:function(s){if(e.value==t){clearTimeout(o.ssssaaa),$("#words .word").remove();var r=s.data.words;$(r).each(((o,e)=>{var t=$("#wordtempl").clone(!0);t[0].item=e,t.attr("id","word"+e.id),t.addClass("word"),t.html(e.word+"&nbsp;&nbsp;"+(e.phonetic?"/"+e.phonetic+"/":"")+"&nbsp;&nbsp;"+(e.explain||"")),$("#words").append(t),t.show()}))}}})):$("#words .word").remove()})),$("#startFn,#startFn1").bind("mousedown",(function(){isMobile()||(log.info("#startFn.mousedown"),o.startt=new Date,clearTimeout(o.dddd),o.dddd=setTimeout((function(){o.diandu?(o.diandu=0,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(103, 103, 103)")):(o.diandu=1,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(255 0 0)"))}),1e3))})).bind("mouseup",(function(){isMobile()||(log.info("#startFn.mouseup"),o.manual=1,clearTimeout(o.dddd),o.startt&&(o.endt=new Date,o.endt.getTime()-o.startt.getTime()<1e3&&X()))})).bind("touchstart",(function(){log.info("#startFn.touchstart"),o.startt=new Date,clearTimeout(o.dddd),o.dddd=setTimeout((function(){o.diandu?(o.diandu=0,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(103, 103, 103)")):(o.diandu=1,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(255 0 0)"))}),1e3)})).bind("touchend",(function(){(log.info("#startFn.touchend"),clearTimeout(o.dddd),o.manual=1,o.startt)&&(o.endt=new Date,o.endt.getTime()-o.startt.getTime()<1e3&&X())})),$("#stopFn,#stopFn1").bind("mousedown",(function(){isMobile()||(log.info("#stopFn.mousedown"),o.startt=new Date,clearTimeout(o.dddd),o.dddd=setTimeout((function(){o.diandu?(o.diandu=0,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(103, 103, 103)")):(o.diandu=1,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(255 0 0)"))}),1e3))})).bind("mouseup",(function(){isMobile()||(log.info("#stopFn.mouseup"),o.manual=2,clearTimeout(o.dddd),o.startt&&(o.endt=new Date,o.endt.getTime()-o.startt.getTime()<1e3&&O()))})).bind("touchstart",(function(){log.info("#stopFn.touchstart"),o.startt=new Date,clearTimeout(o.dddd),o.dddd=setTimeout((function(){o.diandu?(o.diandu=0,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(103, 103, 103)")):(o.diandu=1,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(255 0 0)"))}),1e3)})).bind("touchend",(function(){(log.info("#stopFn.touchend"),clearTimeout(o.dddd),o.manual=2,o.startt)&&(o.endt=new Date,o.endt.getTime()-o.startt.getTime()<1e3&&O())})),$("#prevline").bind("click",(function(){log.info("#prevline.click"),L()})),$("#currline").bind("click",(function(){log.info("#nextline.click"),C()})),$("#nextline").bind("click",(function(){log.info("#nextline.click"),D()})),$("#gear").bind("touchstart",(function(o){log.info("#gear.touchstart");var e=o.targetTouches[0];this.startX=e.pageX,this.startY=e.pageY})).bind("touchmove",(function(e){if(this.startX&&this.startY){var t=e.targetTouches[0];this.endX=t.pageX,this.endY=t.pageY;var s=this.endX-this.startX;this.endY,this.startY;null!=this.lastDist&&null!=this.lastDist||(this.lastDist=s);var r=s-this.lastDist;this.lastDist=s;var a=parseInt(this.style.left.replace("px"))+r;a<=0&&a>=-4900&&(this.style.left=a+"px"),this.xx||(this.xx=0),this.xx=this.xx+r;var n=null;this.xx>30?(n=A,n++):this.xx<-30&&(n=A,n--),v.current&&v.current.enValue&&null!=n&&(n<1&&(n=v.currentwords.length),n>v.currentwords.length&&(n=1),o.dovideoshadow=1,O(),z(n),this.xx=0),e.preventDefault()}})).bind("touchend",(function(o){log.info("#gear.touchend"),this.startX=null,this.startY=null,this.endX=null,this.endY=null,this.lastDist=null,this.xx=0})),$("#gear").bind("mousedown",(function(o){log.info("#gear.mousedown"),this.startX=o.pageX,this.startY=o.pageY})).bind("mousemove",(function(e){if(this.startX&&this.startY){this.endX=e.pageX,this.endY=e.pageY;var t=this.endX-this.startX;this.endY,this.startY;null!=this.lastDist&&null!=this.lastDist||(this.lastDist=t);var s=t-this.lastDist;this.lastDist=t;var r=parseInt(this.style.left.replace("px"))+s;r<=0&&r>=-4900&&(this.style.left=r+"px"),this.xx||(this.xx=0),this.xx=this.xx+s;var a=null;this.xx>30?(a=A,a++):this.xx<-30&&(a=A,a--),v.current&&v.current.enValue&&null!=a&&(a<1&&(a=v.currentwords.length),a>v.currentwords.length&&(a=1),o.dovideoshadow=1,O(),z(a),this.xx=0)}})).bind("mouseup",(function(o){log.info("#gear.mouseup"),this.startX=null,this.startY=null,this.endX=null,this.endY=null,this.lastDist=null,this.xx=0})),$("#replay").bind("click",(function(o){log.info("#replay.click"),$("#video")[0].load()})),$("#hideBtn").bind("click",(function(o){log.info("#hideBtn.click"),$("#zh_subtitles").css("opacity"),1==$("#zh_subtitles").css("opacity")?($("#zh_subtitles").css("opacity",0),$("#chDialog").hide(),$("#hideBtn").css("background-color","rgb(230, 230, 230)")):($("#chDialog").show(),$("#zh_subtitles").css("opacity",1),$("#hideBtn").css("background-color","#ffffff"))})),$("#wholebtn").bind("click",(function(o){log.info("#wholebtn.click"),K()})),$("#searchbtn").bind("click",(function(o){log.info("#searchbtn.click"),$("#words .word").remove(),$("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").focus(),$("#word-in").trigger("input"),O(),j()})),G(),$("#subtitlesBtn").click((function(){G()})),document.body.addEventListener("click",(function(){})),$("#goPrevVideo").click((function(){log.info("#goPrevVideo.click"),T()})),$("#goNextVideo").click((function(){log.info("#goNextVideo.click"),y()})),$("#word-in").bind("focus",(function(){this.select();for(const e of o.translateajaxs)e.abort();for(const e of o.words1ajaxs)e.abort();""==this.value?$("#wordsframe_cancel").show():$("#wordsframe_cancel").hide()})),$("#searchclear").click((function(){r="",a="",$("#searchpad").slideUp(100),o.onlyLookUserNo&&$("#onlyLookHim").click(),o.seed=Math.ceil(100*Math.random()),o.exploreVideos.rows=[],o.exploreVideos.currRows=[],o.exploreVideos.inx=0,o.exploreVideos.rstart=0,o.onlyLookHimVideos.rows=[],o.onlyLookHimVideos.currRows=[],o.onlyLookHimVideos.inx=0,o.onlyLookHimVideos.rstart=0,o.trueVideos.rows=[],o.trueVideos.currRows=[],o.trueVideos.noes=[],o.trueVideos.map={},o.trueVideos.inx=0,o.trueVideos.rstart=0,Q(),y()})),$(".searchtag").click((function(){a=$(this).attr("data"),$("#searchpad").slideUp(100),o.onlyLookUserNo&&$("#onlyLookHim").click(),o.seed=Math.ceil(100*Math.random()),o.exploreVideos.rows=[],o.exploreVideos.currRows=[],o.exploreVideos.inx=0,o.exploreVideos.rstart=0,o.onlyLookHimVideos.rows=[],o.onlyLookHimVideos.currRows=[],o.onlyLookHimVideos.inx=0,o.onlyLookHimVideos.rstart=0,o.trueVideos.rows=[],o.trueVideos.currRows=[],o.trueVideos.noes=[],o.trueVideos.map={},o.trueVideos.inx=0,o.trueVideos.rstart=0,Q(),y()})),$("#wordbookpad").bind("mousedown touchstart",(function(o){if(this.touchstartTime=(new Date).getTime(),"touchstart"==o.type){var e=o.targetTouches[0];this.touchstartX=e.pageX,this.touchstartY=e.pageY}else"mousedown"==o.type&&(this.touchstartX=o.pageX,this.touchstartY=o.pageY)})).bind("mousemove touchmove",(function(o){if("touchmove"==o.type){var e=o.targetTouches[0];this.touchendX=e.pageX,this.touchendY=e.pageY}else"mousemove"==o.type&&(this.touchendX=o.pageX,this.touchendY=o.pageY);for(var t=null;!((t=t?$(t).parent():$(o.target)).scrollTop()>0)&&0!=t.length&&t!=this;);this.scrollEle=t})).bind("mouseup touchend",(function(o){this.scrollEle&&0==this.scrollEle.length&&this.touchendY-this.touchstartY>100&&($("#wordbookpad").slideUp(100),$("#prevnextpad").show(),$("#subtitlePad").show(),X()),this.touchstartY=null,this.touchendY=null})),$("#wordbookpadBtn").click((function(){$("#wordbookpad").css("height",$(window).height()-($("#video").height()+$("#controlpad").height()+20)+"px"),$("#wordbookpad").slideDown(100),$("#prevnextpad").hide(),$("#subtitlePad").hide(),O(),0==o.wordbooks.rows.length&&ao()})),$("#searchpadbtn").click((function(){$("#searchpad").css("height",$("#video").height()+"px"),$("#searchpad").slideDown(100)})),$("#searchpad").bind("touchstart",(function(o){var e=o.targetTouches[0];this.touchstart=e.pageY})).bind("touchmove",(function(o){var e=o.targetTouches[0];this.touchend=e.pageY,0==$(this).scrollTop()&&this.touchstart<this.touchend&&o.preventDefault()})).bind("touchend",(function(o){this.touchstart-this.touchend>50&&$("#searchpad").slideUp(100),this.touchstart=null,this.touchend=null})),$("#searchpad").bind("mousedown",(function(o){this.touchstart=o.pageY})).bind("mousemove",(function(o){this.touchend=o.pageY,0==$(this).scrollTop()&&this.touchstart<this.touchend&&o.preventDefault()})).bind("mouseup",(function(o){this.touchend-this.touchstart>50&&$("#searchpad").slideUp(100),this.touchstart=null,this.touchend=null})),$("#loopVideoBtn").click((function(){o.loopVideos.on?Q():function(){o.loopVideos.on=1,$("#chooseLoopVideosCountPad").show(),clearInterval(o.loopVideoChooseInterval);var e=2;$("#chooseLoopVideosCountPad .restSecond").text(e+"s"),$("#chooseLoopVideosCountPad .count"+o.loopVideos.count).css("background-color","#9b9b9b"),o.loopVideoChooseInterval=setInterval((function(){--e,$("#chooseLoopVideosCountPad .restSecond").text(e+"s"),0==e&&(clearInterval(o.loopVideoChooseInterval),$("#chooseLoopVideosCountPad").hide(),$("#chooseLoopVideosCountPad .count"+o.loopVideos.count).click())}),1e3)}()})),$("#chooseLoopVideosCountPad .count").click((function(){clearInterval(o.loopVideoChooseInterval),o.loopVideos.inx=1,o.loopVideos.count=this.attributes.data.value,$("#chooseLoopVideosCountPad .count").css("background-color","unset"),$(this).css("background-color","#9b9b9b"),o.loopVideos.count>1&&($("#loopVideoBtn").css("line-height","15px"),$("#loopVideoBtn").css("white-space","break-spaces"),$("#loopVideoBtn").text("循环\n"+o.loopVideos.inx+"/"+o.loopVideos.count)),$("#loopVideoBtn").css("background-color","#5a5a5a"),$("#chooseLoopVideosCountPad").hide()})),$("#chatminpad,#goChatBtn").click((function(){o.preChatPaused=$("#video")[0].paused,$("#chatpad").css("height",$(window).height()-($("#video").height()+$("#controlpad").height()+20)+"px"),$("#prevnextpad").hide(),$("#subtitlePad").hide(),$("#chatpad").slideDown(100,(function(){}))})),$("#chatroombtn").click((function(){$("#chatroompad").show(),$("#chatprivatepad").hide(),$(this).css("background-color","#d7d7d7"),$("#chatprivatebtn").css("background-color","#737373")})),$("#chatprivatebtn").click((function(){$("#chatroompad").hide(),$("#chatprivatepad").show(),$(this).css("background-color","#d7d7d7"),$("#chatroombtn").css("background-color","#737373")})),$("#index").bind("click",(function(o){var e=$(o.target).hasClass("translatable")?o.target:$(o.target).parents(".translatable")[0];e&&(e.transfrom?Y(e.transfrom,1):e.innerText&&Y(e.innerText,1))})),o.spans=[],o.spansIs=0,o.firstRangeWordInx=0,o.lastRangeWordInx=0,$("#zh_subtitles").bind("mousedown touchstart",(function(e){log.info("#zh_subtitles."+e.type);var t=null;if(t="touchmove"==e.type?document.elementFromPoint(e.targetTouches[0].pageX,e.targetTouches[0].pageY):e.target,$(t).hasClass("font")){o.firstRangeWordInx=0,o.lastRangeWordInx=0,O();var s=parseInt($(t).attr("index"));A=s+1,o.spansIs=1,o.spans=[],o.firstRangeWordInx=s,o.lastRangeWordInx=s,$("#zh_subtitles .font").css("background-color","unset"),$("#zh_subtitles .font.span"+s).css("background-color","#828282")}})).bind("mousemove touchmove",(function(e){var t=null;if(t="touchmove"==e.type?document.elementFromPoint(e.targetTouches[0].pageX,e.targetTouches[0].pageY):e.target,e.stopPropagation(),$(t).hasClass("font")){if(!o.spansIs)return;$("#zh_subtitles .font").css("background-color","unset");var s=parseInt($(t).attr("index"));o.spans[o.spans.length-1]!=s&&o.spans.push(s);var r=o.spans[0],a=o.spans[o.spans.length-1];if(r>a){var n=r;r=a,a=n}o.firstRangeWordInx=r,o.lastRangeWordInx=a;for(var d=r;d<=a;d++)$("#zh_subtitles .font.span"+d).css("background-color","#828282")}})).bind("mouseup touchend",(function(e){log.info("#zh_subtitles."+e.type);var t=null;if(t="touchmove"==e.type?document.elementFromPoint(e.targetTouches[0].pageX,e.targetTouches[0].pageY):e.target,$(t).hasClass("font")&&o.spansIs){for(var s=o.firstRangeWordInx,r=o.lastRangeWordInx,a="",n=s;n<=r;n++)a+=$("#zh_subtitles .font.span"+n).text()+" ";a=a.substr(0,a.length-1),o.dovideoshadow=1,O(),eo(a),Y(a,1),o.spansIs=0,o.spans=[]}})),$("#index").unbind("touchstart mousedown").bind("touchstart mousedown",(function(o){if(this.touchstartTime=(new Date).getTime(),"touchstart"==o.type){var e=o.targetTouches[0];this.touchstartX=e.pageX,this.touchstartY=e.pageY}else"mousedown"==o.type&&(this.touchstartX=o.pageX,this.touchstartY=o.pageY)})).unbind("touchmove mousemove").bind("touchmove mousemove",(function(o){var e,t;"touchmove"==o.type?(e=(s=o.targetTouches[0]).pageX,t=s.pageY):"mousemove"==o.type&&(e=o.pageX,t=o.pageY);if(this.touchstartX&&this.touchstartY&&this.touchendX&&this.touchendY&&Math.abs(this.touchstartX-e)/Math.abs(this.touchstartY-t)>1&&($("#video1").css("left",parseInt($("#video1").css("left").replace("px",""))+e-this.touchendX+"px"),$("#video2").css("left",parseInt($("#video2").css("left").replace("px",""))+e-this.touchendX+"px")),"touchmove"==o.type){var s=o.targetTouches[0];this.touchendX=s.pageX,this.touchendY=s.pageY}else"mousemove"==o.type&&(this.touchendX=o.pageX,this.touchendY=o.pageY);for(var r=null;!((r=r?$(r).parent():$(o.target)).scrollTop()>0)&&0!=r.length;);0==r.length&&this.touchstartY<this.touchendY&&o.preventDefault()})).unbind("touchend mouseup").bind("touchend mouseup",(function(e){this.touchendtime=(new Date).getTime(),this.touchendtime-this.touchstartTime<500&&this.touchstartX&&this.touchstartY&&this.touchendX&&this.touchendY?this.touchstartX-this.touchendX>100?(clearInterval(o.vvvv),o.vvvv=setInterval((function(){var e=parseInt($("#video1").css("left").replace("px",""));(e-=20)<0?(clearInterval(o.vvvv),O(),$("#video1").css("left","0"),Q(),y()):$("#video1").css("left",e+"px")}),2)):this.touchstartX-this.touchendX<-100?(clearInterval(o.vvvv),o.vvvv=setInterval((function(){var e=parseInt($("#video2").css("left").replace("px",""));(e+=20)>0?(clearInterval(o.vvvv),O(),$("#video2").css("left","0"),Q(),T()):$("#video2").css("left",e+"px")}),2)):($("#video1").css("left","100%"),$("#video2").css("left","-100%")):($("#video1").css("left","100%"),$("#video2").css("left","-100%")),this.touchstartTime=null,this.touchendtime=null,this.touchstartX=null,this.touchstartY=null,this.touchendX=null,this.touchendY=null})),$("#chatpad").bind("mousedown touchstart",(function(o){if(this.touchstartTime=(new Date).getTime(),"touchstart"==o.type){var e=o.targetTouches[0];this.touchstartX=e.pageX,this.touchstartY=e.pageY}else"mousedown"==o.type&&(this.touchstartX=o.pageX,this.touchstartY=o.pageY)})).bind("mousemove touchmove",(function(o){if("touchmove"==o.type){var e=o.targetTouches[0];this.touchendX=e.pageX,this.touchendY=e.pageY}else"mousemove"==o.type&&(this.touchendX=o.pageX,this.touchendY=o.pageY);for(var t=null;!((t=t?$(t).parent():$(o.target)).scrollTop()>0)&&0!=t.length&&t!=this;);this.scrollEle=t})).bind("mouseup touchend",(function(o){this.scrollEle&&0==this.scrollEle.length&&this.touchendY-this.touchstartY>100&&($("#chatpad").slideUp(100),$("#prevnextpad").show(),$("#subtitlePad").show()),this.touchstartY=null,this.touchendY=null})),$("#word-in").keydown((function(){13==(window.event||e).keyCode&&M()})),$("#chatinput").keydown((function(){if(13==(window.event||e).keyCode){if(""==this.value)return;var o={text:this.value,action:1,looking:n.name};Z.send(JSON.stringify(o)),this.value=""}})),$("#wordsframe_cancel").click((function(){o.manual&&(1==o.manual?X():2==o.manual&&O()),$("#wordsframe").hide(),$("#videoshasow").hide(),$("#videobox").css("top",0)}));var Z=null;function oo(){(Z=new WebSocket(`wss://${location.host}/mumu/websocket/${pagePre.login.userNo}`)).onopen=function(){o.ws=Z},Z.onmessage=function(e){var t=JSON.parse(e.data);if(1==t.action)null!=t.nickname&&(t.nickname=t.nickname.substr(0,1)+"..."+t.nickname.substr(3)),(a=$("#chatmsgtemple").clone(!0)).attr("id","chatmsg"+t.msgNo),t.userNo==$.cookie("token")&&a.css("color","green"),a.find(".name").text(t.nickname||"网友"),a.find(".msg").text(t.text),a.find(".looking").text(t.looking),a.show(),$("#chatmsgspad").prepend(a),$("#lastmsg").text((t.nickname||"网友").substr(0,6)+" : "+t.text);else if(10==t.action&&o.currWordText==t.word){o.currWord=t,O(),j(),$("#summtrans").show(),$("#summtrans-word").text(o.currWord.word),$("#word-in").val(o.currWord.word);var s=!1;if(clearTimeout(window.aaa),o.currWord.phonetic?$("#summtrans-phonetic").text("/"+o.currWord.phonetic+"/").show():$("#summtrans-phonetic").hide(),o.currWord.speakUrl?$("#summtrans-speak").attr("play-url",o.currWord.speakUrl).show():$("#summtrans-speak").hide(),$("#summtrans-vv").scrollTop(0),$("#summtrans-vv").html(""),o.currWord.explains?$(o.currWord.explains).each((function(o,e){s=!0,$("#summtrans-vv").append(`<div>${q(e)}</div>`)})):o.currWord.translation&&(s=!0,$("#summtrans-vv").append(`<div>${q(o.currWord.translation)}</div>`)),o.currWord.wfs&&$("#summtrans-vv").append(`<div style="margin-top:10px">${q(o.currWord.wfs)}</div>`),o.currWord.webs&&($("#summtrans-vv").append('<div style="margin-top:10px;">网络释义: </div>'),$(o.currWord.webs).each((function(o,e){s=!0,$("#summtrans-vv").append(`<div>${q(e)}</div>`)}))),!s&&o.currWord.translations&&$(o.currWord.translations).each((function(o,e){$("#summtrans-vv").append(`<div>${q(e)}</div>`)})),$(".lightkeytrans").bind("click",(function(){Y(this.innerText,1)})),$("#wordsframe").hide(),$("#summrest").show(),$("#summtrans-vv").show(),$("#summtrans-value").show(),$("#summtrans").show(),$("#videobox").css("top","-1000px"),$("#summtrans-speak").click(),t.addHistory){var r={word:o.currWord.word,translation:o.currWord.translation,phonetic:o.currWord.phonetic,historyWordNo:randomnum(12)},a=lo(r);o.historyWords.rows.splice(0,0,r),$("#historyWordsPad .words").prepend(a)}}},Z.onclose=function(o){},Z.onerror=function(o){}}function eo(e,t){e=B(e);var s=(t=B(t))||e;clearTimeout(o.sssss),o.sssss=setTimeout((function(){$("#fromRelatedWord").text(s),$.ajax({url:"/mumu/words1",data:{kw:s,rstart:1,rcount:100,from:n.language,to:2},ajaxCache:!0,success:function(s){if(s.data.words){$("#relatedWordsPad .relatedWord").remove();var r=e.replace(/(\s|-|,|\.)+/g," ").split(" "),a=[];for(iterator of r)a.push({id:iterator,word:iterator});(a.length>1||1==a.length&&(0==s.data.words.length||s.data.words[0].word!=a[0].word))&&s.data.words.unshift(...a),a.length>1&&s.data.words.unshift({id:e,word:e}),$(s.data.words).each(((o,e)=>{var t=$("#relatedWord0").clone(!0);t[0].data=e,t.attr("id","relatedWord"+e.id),t.addClass("relatedWord"),t.text(e.word),$("#relatedWord0").before(t),t.show()})),t&&$("#relatedWordsPad").children(":first").html(`\n                                <span style="font-size:15px;float:left;">${o.shortWordText}</span>\n                                <span style="font-size:15px;color:#adadad;float:left;">${o.currWordText.substr(o.shortWordText.length,o.currWordText.length-o.shortWordText.length)}</span>\n                            `)}}})}),100)}function to(e,t){var s=o.wordbooks.map["no"+t].words;e&&e.forEach((o=>{var e=$("#wordbooksPad .words .pad .row0").clone(!0);e.removeClass("row0"),e.addClass("row"+o.no),e.find(".word").text(o.word),o.speakUrl=o.ukSpeech?o.ukSpeech:o.usSpeech?o.usSpeech:o.speakUrl,o.phonetic=o.ukPhonetic?o.ukPhonetic:o.usPhonetic?o.usPhonetic:o.phonetic,o.phonetic?e.find(".phonetic").text("/"+o.phonetic+"/"):(e.find(".word").css("width","66.666666%"),e.find(".phonetic").hide()),e.find(".translation").text(o.translation),$("#wordbooksPad .words .pad .row0").before(e),e.show(),e[0].data=o,o.dom=e})),0==s.rows.length?($("#wordbooksPad .words .pad .someload").hide(),$("#wordbooksPad .words .pad .loadnodata").show()):($("#wordbooksPad .words .pad .someload").hide(),$("#wordbooksPad .words .pad .loadend").show())}function so(e){var t=o.wordbooks.map["no"+e].words,s=t.rows.length+1,r=t.rcount;for(const e of o.wordbookWordsAjaxs)e.abort();o.wordbookWordsAjaxs.push($.ajax({url:"/mumu/wordbook-words?",data:{wordbookNo:e,rstart:s,rcount:r},beforeSend:()=>{$("#wordbooksPad .words .pad .someload").hide(),$("#wordbooksPad .words .pad .loading").show()},success:function(s){0==s.code&&(o.wordbooks.selected.words={rows:s.data.rows,currRows:s.data.rows,rcount:200,selected:null},t.currRows=s.data.rows,t.rows.push(...s.data.rows),to(s.data.rows,e),t.rows.length>0?$("#startRollBtn").show():$("#startRollBtn").hide())}}))}function ro(e){e.templateNo&&"100000000000"!=pagePre.login.userNo?common.alert("不可编辑系统单词本"):common.promptLine({message:"请输入释义, 可为空.",confirm:function(t){if(null!=t){if(o.wordbooks.selected&&e.no==o.wordbooks.selected.no){$("#startRollBtn").show();var s=function(e,t){var s={word:o.currWord.word,translation:t,phonetic:o.currWord.phonetic,no:randomnum(12)};o.wordbooks.map["no"+e].words.rows.splice(0,0,s);var r=$("#wordbooksPad .words .pad .row0").clone(!0);r.removeClass("row0"),r.addClass("row"+s.no),r.find(".word").text(s.word),s.phonetic?r.find(".phonetic").text("/"+s.phonetic+"/"):(r.find(".word").css("width","66.666666%"),r.find(".phonetic").hide());return r.find(".translation").text(s.translation),r.show(),r[0].data=s,s.dom=r,r}(e.no,t);$("#wordbooksPad .words .pad ").prepend(s)}Z.send(JSON.stringify({action:8,wordbookNo:e.no,word:o.currWord.word,translation:t,templateNo:e.templateNo}))}}})}function ao(){var e=o.wordbooks.rows.length+1,t=o.wordbooks.rcount;$.ajax({url:"/mumu/wordbooks?",data:{rstart:e,rcount:t},beforeSend:()=>{$("#wordbooksPad .wordbooks .someload").hide(),$("#wordbooksPad .wordbooks .loading").show()},success:function(s){o.wordbooks.rows.push(...s.data.rows),o.wordbooks.currRows=s.data.rows,1==e&&0==s.data.rows.length?($("#wordbooksPad .wordbooks .someload").hide(),$("#wordbooksPad .wordbooks .loadnodata").show()):s.data.rows.length<t?($("#wordbooksPad .wordbooks .someload").hide(),$("#wordbooksPad .wordbooks .loadend").show()):($("#wordbooksPad .wordbooks .someload").hide(),$("#wordbooksPad .wordbooks .loadmore").show()),$(s.data.rows).each(((e,t)=>{var s=$("#wordbooksPad .wordbooks .row0").clone(!0);s.removeClass("row0"),s.addClass("row"+t.no),s.text(t.name),s[0].data=t,t.dom=s,s.show(),$("#wordbooksPad .wordbooks .row0").before(s),o.wordbooks.map["no"+t.no]=t,t.words={rows:[],currRows:[],rcount:200,selected:null}})),1==e&&$("#wordbooksPad .wordbooks .row").not(".row0").first().click(),0==o.wordbooks.rows.length?$("#clickToShowCreateWordbookBtn").css("visibility","hidden"):$("#clickToShowCreateWordbookBtn").css("visibility","visible")}})}function no(){var e=o.favoredWords.rows.length+1,t=o.favoredWords.rcount;$.ajax({url:"/mumu/favored-words?",data:{rstart:e,rcount:t},beforeSend:()=>{$("#favorsPad .someload").hide(),$("#favorsPad .loading").show()},success:function(s){0==s.code&&(1==e&&0==s.data.rows.length?($("#favorsPad .someload").hide(),$("#favorsPad .loadnodata").show()):s.data.rows.length<t?($("#favorsPad .someload").hide(),$("#favorsPad .loadend").show()):($("#favorsPad .someload").hide(),$("#favorsPad .loadmore").show()),s.data.rows.length>0&&(o.favoredWords.currRows=s.data.rows,o.favoredWords.rows.push(...s.data.rows),$(s.data.rows).each(((o,e)=>{$("#favorsPad .word0").before(io(e))}))))}})}function io(o){var e=$("#favorsPad .word0").clone(!0);return e.removeClass("word0"),e.addClass("word"+o.favorWordNo),e.find(".word").text(o.word),e.find(".translation").text(o.translation),o.phonetic?e.find(".phonetic").text("/"+o.phonetic+"/"):(e.find(".word").css("width","66.666666%"),e.find(".phonetic").hide()),e[0].data=o,e[0].transfrom=o.word,e.show(),e}function co(){var e=o.historyWords.rows.length+1,t=o.historyWords.rcount;$.ajax({url:"/mumu/history-words?",data:{rstart:e,rcount:t},beforeSend:()=>{$("#historyWordsPad .someload").hide(),$("#historyWordsPad .loading").show()},success:function(s){0==s.code&&(1==e&&0==s.data.rows.length?($("#historyWordsPad .someload").hide(),$("#historyWordsPad .loadnodata").show()):s.data.rows.length<t?($("#historyWordsPad .someload").hide(),$("#historyWordsPad .loadend").show()):($("#historyWordsPad .someload").hide(),$("#historyWordsPad .loadmore").show()),s.data.rows.length>0&&(o.historyWords.currRows=s.data.rows,o.historyWords.rows.push(...s.data.rows),$(s.data.rows).each(((o,e)=>{$("#historyWordsPad .word0").before(lo(e))}))))}})}function lo(o){var e=$("#historyWordsPad .word0").clone(!0);return e.removeClass("word0"),e.addClass("word"+o.historyWordNo),e.find(".word").text(o.word),e.find(".translation").text(o.translation),o.phonetic?e.find(".phonetic").text("/"+o.phonetic+"/"):(e.find(".word").css("width","66.666666%"),e.find(".phonetic").hide()),e[0].data=o,e[0].transfrom=o.word,e.show(),e}function uo(){var e=o.wordbooksOnAdd.rows.length+1,t=o.wordbooksOnAdd.rcount;$.ajax({url:"/mumu/wordbooks",data:{rstart:e,rcount:t},beforeSend:()=>{$("#wordbooksPadOnAdd .someload").hide(),$("#wordbooksPadOnAdd .loading").show()},success:function(s){0==s.code&&(1==e&&0==s.data.rows.length?($("#wordbooksPadOnAdd .someload").hide(),$("#wordbooksPadOnAdd .loadnodata").show()):s.data.rows.length<t?($("#wordbooksPadOnAdd .someload").hide(),$("#wordbooksPadOnAdd .loadend").show()):($("#wordbooksPadOnAdd .someload").hide(),$("#wordbooksPadOnAdd .loadmore").show()),s.data.rows.length>0&&(o.wordbooksOnAdd.currRows=s.data.rows,o.wordbooksOnAdd.rows.push(...s.data.rows),s.data.rows.forEach((o=>{var e=$("#wordbooksPadOnAdd .row0").clone(!0);e.removeClass("row0"),e.addClass("row"+o.no),e.text(o.name),$("#wordbooksPadOnAdd .row0").before(e),e.show(),e[0].data=o}))))}})}function ho(){$("#video1").attr("src","./img/black.png"),o.onlyLookUserNo||(o.exploreVideos.rows.splice(o.exploreVideos.inx+1-1,o.exploreVideos.rows.length-1),o.exploreVideos.currRows=[]),o.onlyLookHimVideos.rows=[],o.onlyLookHimVideos.currRows=[],o.onlyLookUserNo=n.userNo,$("#onlyLookHim").css("background-color","rgb(90, 90, 90)"),o.onlyLookHimVideos.rows.push(n),o.onlyLookHimVideos.currRows.push(n),o.onlyLookHimVideos.inx=1,o.trueVideos.rows.splice(o.trueVideos.inx+1-1,o.trueVideos.rows.length-1),o.trueVideos.currRows=[]}function mo(){$("#rollShowWordsPad").hide(),o._mp3.pause(),o.lettersound.pause(),clearTimeout(o.rollWordsInterval),clearTimeout(o.readRollWordTimeout),o.rollOpen=0}function wo(e){if(o.rollOpen){o._mp3.pause(),o.lettersound.pause(),clearTimeout(o.rollWordsInterval),clearTimeout(o.readRollWordTimeout);var t=o.wordbooks.selected.words;if(0!=t.rows.length){var s=t.rows[e-1];if(s||so(o.wordbooks.selected.no),!(s=t.rows[e-1]))return o.rollInx=1,void wo(o.rollInx);if(s.speakUrl=s.ukSpeech?s.ukSpeech:s.usSpeech?s.usSpeech:s.speakUrl,s.speakUrl||$.ajax({url:"/mumu/translate?from="+n.language+"&to=2&q="+s.word,ajaxCache:!0,async:!1,success:function(o){0==o.code&&(s.speakUrl=o.data.speakUrl,s.usSpeech=o.data.usSpeech,s.ukSpeech=o.data.ukSpeech,s.usPhonetic=o.data.usPhonetic,s.ukPhonetic=o.data.ukPhonetic)}}),s.speakUrl=s.ukSpeech?s.ukSpeech:s.usSpeech?s.usSpeech:s.speakUrl,s.phonetic=s.ukPhonetic?s.ukPhonetic:s.usPhonetic?s.usPhonetic:s.phonetic,o.rollInx=e,localStorage.setItem(config.project+"-rollInx",o.rollInx),$("#rollShowWordsPad .word").text(s.word),$("#rollShowWordsPad .inx").text(e),$("#rollShowWordsPad .phonetic").text(s.phonetic?"/"+s.phonetic+"/":" "),$("#rollShowWordsPad .translation").text(s.translation||" "),o.auto&&o.rollIsSound){!function(e){var t=0;e.speakUrl?(o._mp3.muted=!1,o._mp3.src=e.speakUrl):(o._mp3.muted=!0,o._mp3.src="/file/mumu/lettersounds/a.mp3");o._mp3.onpause=function(){if(o._mp3.currentTime==o._mp3.duration)if(t>0)o.readRollWordTimeout=setTimeout((function(){o._mp3.play()}),100),t--;else{function s(){o.rollWordsInterval=setTimeout((function(){o._mp3.onpause=function(){o.rollWordsInterval=setTimeout((function(){wo(o.rollInx+1)}),1e3)},o._mp3.src=e.translationVoice,o._mp3.play()}),100)}clearTimeout(o.readRollWordTimeout),clearTimeout(o.rollWordsInterval),e.translationVoice?s():$.ajax({url:"/mumu/get-read",data:{text:e.translation,lang:"zh"},success:function(o){e.translationVoice=o.data.voice,s()}})}},o._mp3.play()}(s)}}}else mo()}oo(),setInterval((()=>{if(Z&&3==Z.readyState&&oo(),!$("#video")[0].paused){var o=localStorage.getItem(config.project+"-totalsecondsno");o=parseInt(o||0),o+=5,localStorage.setItem(config.project+"-totalsecondsno",o)}}),5e3),setInterval((function(){Z&&1==Z.readyState&&Z.send("1")}),3e4),statisticsexps(),$("#relatedWord0").click((function(){var e=this.innerText.replace("\n","");Y(fp__data=e,fp_addHistory=1,fp_only=1),e==o.currWordText&&(o.shortWordText="",eo(o.currWordText))})),$.ajax({url:"/mumu/chatroom-msgs?",data:"rcount=300",async:!0,success:function(o){$(o.data.rows).each(((o,e)=>{null!=e.nickname&&(e.nickname=e.nickname.substr(0,1)+"..."+e.nickname.substr(3)),0==o&&($("#lastmsg").text((e.nickname||"网友").substr(0,6)+" : "+e.text),$("#chatminpad").show());var t=$("#chatmsgtemple").clone(!0);t.attr("id","chatmsg"+e.msgNo),e.userNo==$.cookie("token")&&t.css("color","green"),t.find(".name").text(e.nickname||"网友"),t.find(".msg").text(e.text),t.find(".looking").text(e.looking),t.show(),$("#chatmsgspad").append(t)})),0==o.data.rows.length&&($("#lastmsg").text("聊天室"),$("#chatminpad").show())}}),$("#wordbooksPad .createRowBtn").click((function(){common.promptLine({message:"请输入单词本名称",parent:$("#index"),confirm:function(e){e&&$.ajax({url:"/mumu/create-wordbook?",data:{name:e},success:function(t){if(0==t.code){var s={no:t.data.no,name:e,templateNo:t.data.templateNo},r=$("#wordbooksPad .wordbooks .row0").clone(!0);r.removeClass("row0"),r.addClass("row"+s.no),r.text(s.name),r[0].data=s,r.show(),$("#wordbooksPad .wordbooks .row0").before(r);var a=$("#wordbooksPadOnAdd .row0").clone(!0);a.removeClass("row0"),a.addClass("row"+s.no),a.text(s.name),$("#wordbooksPadOnAdd .row0").before(a),a.show(),a[0].data=s,o.wordbooks.rows.push(s),o.wordbooks.map["no"+s.no]=s,s.words={rows:[],currRows:[],rcount:200,selected:null}}else common.alert(t.msg)}})}})})),$("#wordbooksPad .wordbooks .row0").click((function(e){$("#startRollBtn").hide();var t=o.wordbooks.selected=this.data;$("#wordbooksPad .wordbooks .row").css("background-color","unset"),$(this).css("background-color","rgb(111, 111, 111)"),$("#wordbooksPad .createRowBtn").hide(),$("#wordbooksPad .editRowBtn").show(),$("#clickToShowCreateWordbookBtn").css("visibility","visible"),function(e){for(const e of o.wordbookWordsAjaxs)e.abort();var t=o.wordbooks.map["no"+e].words;t||(t={rows:[],currRows:[],rcount:50,selected:null},o.wordbooks.map["no"+e].words=t);$("#wordbooksPad .words .pad .someload").hide(),$("#wordbooksPad .words .pad .loadmore").show(),$("#wordbooksPad .words .pad").show(),$("#wordbooksPad .words .pad .row").not(".row0").remove(),0==t.rows.length?so(e):(to(t.rows,e),$("#startRollBtn").show())}(t.no)})),$("#wordbooksPad .words .loadmore").click((function(e){so(o.wordbooks.selected.no)})),$("#wordbooksPad .words .pad .row0").click((function(){var e=this.data;Y(e.word),eo(e.word);var t=o.wordbooks.selected.words;o.rollInx=t.rows.indexOf(e)+1,$("#wordbooksPad .words .pad .row").css("background-color","unset"),$(this).css("background-color","#444")})),$("#wordbooksPad .words  .coverTargetTextBtn").click((function(){"hidden"==$("#wordbooksPad .words .word").css("visibility")?$("#wordbooksPad .words .word").css("visibility","visible"):$("#wordbooksPad .words .word").css("visibility","hidden")})),$("#wordbooksPad .words  .coverPhoneticTextBtn").click((function(){"hidden"==$("#wordbooksPad .words .phonetic").css("visibility")?$("#wordbooksPad .words .phonetic").css("visibility","visible"):$("#wordbooksPad .words .phonetic").css("visibility","hidden")})),$("#wordbooksPad .words .coverMainTextBtn").click((function(){"hidden"==$("#wordbooksPad .words .translation").css("visibility")?$("#wordbooksPad .words .translation").css("visibility","visible"):$("#wordbooksPad .words .translation").css("visibility","hidden")})),$("#wordbooksPad .words .pad .row0 .removeBtn").click((function(e){$("#wordDetailPad").show();var t=$(this).parents(".row")[0].data;o.wordbooks.selected.words.selected=t,$("#wordDetailPad .namePad .value").text(t.word),$("#wordDetailPad .explainPad .value").text(t.translation),$("#wordbooksPad .words .pad .row").css("background-color","unset"),$(t.dom).css("background-color","#444"),e.stopPropagation()})),$("#wordbooksPad .editRowBtn").click((function(e){var t=o.wordbooks.selected;$("#wordbookDetailPad").show(),$("#wordbookDetailPad .namePad .value").text(t.name)})),$("#wordbookDetailPad .shareBtn").click((function(e){var t=o.wordbooks.selected;location.href="./wordbook.html?wordbookNo="+ttb(t.no)+"&templateNo="+ttb(t.templateNo)})),$("#wordbookDetailPad .deleteBtn").click((function(e){var t=o.wordbooks.selected;common.promptLine({message:"将删除<span style=color:red;font-size:15px>"+t.name+"</span>, 请输入delete以确认移除.",confirm:function(e){e&&("delete"==e.toLowerCase().trim()?$.ajax({url:"/mumu/delete-wordbook?",data:{no:t.no,name:t.name,templateNo:t.templateNo},async:!1,success:function(e){0==e.code?($("#wordbookDetailPad").hide(),$("#wordbooksPad .wordbooks .row"+t.no).remove(),t=o.wordbooks.selected=null,$("#wordbooksPad .wordbooks").click()):common.alert(e.msg)}}):common.alert("输入有误"))}})})),$("#wordbookDetailPad .namePad .editBtn").click((function(e){var t=o.wordbooks.selected;common.promptLine({message:"请输入新名称",value:t.name,confirm:function(o){o!=t.name&&$.ajax({url:"/mumu/alter-wordbook?",data:{no:t.no,name:o,templateNo:t.templateNo},success:function(e){0==e.code?(t.name=o,$("#wordbooksPad .wordbooks .row"+t.no).text(o),$("#wordbookDetailPad .value").text(o)):common.alert(e.msg)}})}})})),$("#wordbookDetailPad .closeBtn").click((function(o){$("#wordbookDetailPad").hide()})),$("#wordbooksPad .wordbooks").click((function(e){this==e.target&&(o.wordbooks.selected=null,$("#wordbooksPad .createRowBtn").show(),$("#wordbooksPad .editRowBtn").hide(),$("#wordbooksPad .words .pad").hide(),$("#wordbooksPad .wordbooks .row").css("background-color","unset"),$("#clickToShowCreateWordbookBtn").css("visibility","hidden"),$("#startRollBtn").hide())})),$("#wordbooksPad .wordbooks .loadmore").click((function(){ao()})),$("#favorsPad .loadmore").click((function(){no()})),$("#favorsPad .word0").click((function(o){var e=this.data;Y(e.word),eo(e.word)})),$("#favorsPad .word0 .removeBtn").click((function(e){var t=$(this).parents(".wrap"),s=t[0].data,r=($(this).parents(".row"),o.removeWordsControl.favor);!r||(new Date).getTime()-parseInt(r)>6e4?common.promptLine({message:"将删除<span style=color:red;font-size:15px>"+s.word+"</span>, 请输入delete以确认移除, 1分钟内不会再次提示.",manualClose:1,cancel:function(o,e){e.remove()},confirm:function(e,r){e&&"delete"==e.toLowerCase().trim()?(Z.send(JSON.stringify({action:5,word:s.word})),t.remove(),o.favoredWords.rows.splice(o.favoredWords.rows.indexOf(s),4),o.favoredWords.currRows.splice(o.favoredWords.currRows.indexOf(s),4),o.removeWordsControl.favor=(new Date).getTime(),r.remove()):common.alert("输入错误")}}):common.confirm({message:"将删除"+s.word+".",manualClose:1,confirm:function(e,r){Z.send(JSON.stringify({action:5,word:s.word})),t.remove(),o.favoredWords.rows.splice(o.favoredWords.rows.indexOf(s),4),o.favoredWords.currRows.splice(o.favoredWords.currRows.indexOf(s),4),o.removeWordsControl.favor=(new Date).getTime()}}),e.stopPropagation()})),$("#favorsPad .coverTargetTextBtn").click((function(){"hidden"==$("#favorsPad .word").css("visibility")?$("#favorsPad .word").css("visibility","visible"):$("#favorsPad .word").css("visibility","hidden")})),$("#favorsPad .coverPhoneticTextBtn").click((function(){"hidden"==$("#favorsPad .phonetic").css("visibility")?$("#favorsPad .phonetic").css("visibility","visible"):$("#favorsPad .phonetic").css("visibility","hidden")})),$("#favorsPad .coverMainTextBtn").click((function(){"hidden"==$("#favorsPad .translation").css("visibility")?$("#favorsPad .translation").css("visibility","visible"):$("#favorsPad .translation").css("visibility","hidden")})),$("#historyWordsPad .loadmore").click((function(){co()})),$("#historyWordsPad .word0 .removeBtn").click((function(e){var t=$(this).parents(".wrap"),s=t[0].data;Z.send(JSON.stringify({action:7,word:s.word})),t.remove(),o.historyWords.rows.splice(o.historyWords.rows.indexOf(s),4),o.historyWords.currRows.splice(o.historyWords.currRows.indexOf(s),4),e.stopPropagation()})),$("#historyWordsPad .word0").click((function(o){var e=this.data;Y(e.word),eo(e.word)})),$("#historyWordsPad .coverTargetTextBtn").click((function(){"hidden"==$("#historyWordsPad .word").css("visibility")?$("#historyWordsPad .word").css("visibility","visible"):$("#historyWordsPad .word").css("visibility","hidden")})),$("#historyWordsPad .coverPhoneticTextBtn").click((function(){"hidden"==$("#historyWordsPad .phonetic").css("visibility")?$("#historyWordsPad .phonetic").css("visibility","visible"):$("#historyWordsPad .phonetic").css("visibility","hidden")})),$("#historyWordsPad .coverMainTextBtn").click((function(){"hidden"==$("#historyWordsPad .translation").css("visibility")?$("#historyWordsPad .translation").css("visibility","visible"):$("#historyWordsPad .translation").css("visibility","hidden")})),$("#favorsBtn").click((function(){$("#favorsBtn").css("background-color","unset").css("color","#ffffff"),$("#historyWordsBtn").css("background-color","#9f9f9f").css("color","#000000"),$("#wordbooksBtn").css("background-color","#9f9f9f").css("color","#000000"),$("#favorsPad").show(),$("#historyWordsPad").hide(),$("#wordbooksPad").hide(),$("#startRollBtn").hide(),0==o.favoredWords.rows.length&&no()})),$("#historyWordsBtn").click((function(){$("#favorsBtn").css("background-color","#9f9f9f").css("color","#000000"),$("#historyWordsBtn").css("background-color","unset").css("color","#ffffff"),$("#wordbooksBtn").css("background-color","#9f9f9f").css("color","#000000"),$("#favorsPad").hide(),$("#historyWordsPad").show(),$("#wordbooksPad").hide(),$("#startRollBtn").hide(),0==o.historyWords.rows.length&&co()})),$("#wordbooksBtn").click((function(e){this==e.target&&($("#favorsBtn").css("background-color","#9f9f9f").css("color","#000000"),$("#historyWordsBtn").css("background-color","#9f9f9f").css("color","#000000"),$("#wordbooksBtn").css("background-color","unset").css("color","#ffffff"),$("#favorsPad").hide(),$("#historyWordsPad").hide(),$("#wordbooksPad").show(),o.wordbooks.selected?o.wordbooks.selected.words.rows.length>0&&$("#startRollBtn").show():$("#startRollBtn").hide())})),$("#addToWordbookBtn").click((function(){$("#wordbooksPadOnAdd").show(),0==o.wordbooksOnAdd.rows.length&&uo(),null!=o.wordbooks.selected?($("#wordbooksPadOnAdd .currRow .name").text(o.wordbooks.selected.name),$("#wordbooksPadOnAdd .currRow")[0].data=o.wordbooks.selected,$("#wordbooksPadOnAdd .currRowPad").show()):$("#wordbooksPadOnAdd .currRowPad").hide()})),$("#wordbooksPadOnAdd .closeBtn").click((function(){$("#wordbooksPadOnAdd").hide()})),$("#wordbooksPadOnAdd .currRow,#wordbooksPadOnAdd .row0").click((function(){var o=this.data;$("#wordbooksPadOnAdd").hide(),ro(o)})),$("#wordbooksPadOnAdd .loadmore").click((function(){uo()})),t&&ho(),$("#onlyLookHim").click((function(){o.onlyLookUserNo?function(){$("#video1").attr("src","./img/black.png"),o.onlyLookUserNo||(o.exploreVideos.rows.splice(o.exploreVideos.inx+1-1,o.exploreVideos.rows.length-1),o.exploreVideos.currRows=[]);o.onlyLookHimVideos.rows=[],o.onlyLookHimVideos.currRows=[],o.onlyLookUserNo=null,$("#onlyLookHim").css("background-color","unset"),o.trueVideos.rows.splice(o.trueVideos.inx+1-1,o.trueVideos.rows.length-1),o.trueVideos.currRows=[]}():ho()})),$("#rollShowWordsPad").click((function(o){this==o.target&&mo()})),$("#rollShowWordsPad .prev").click((function(e){wo(o.rollInx-1)})),$("#rollShowWordsPad .next").click((function(e){wo(o.rollInx+1)})),$("#rollShowWordsPad .restart").click((function(o){wo(1)})),$("#rollShowWordsPad .stop").click((function(e){o._mp3.pause(),o.lettersound.pause(),clearTimeout(o.rollWordsInterval),clearTimeout(o.readRollWordTimeout),$("#rollShowWordsPad .stop").hide(),$("#rollShowWordsPad .start").show(),o.rollIsSound=0,o.auto=0})),$("#rollShowWordsPad .start").click((function(e){var t;o.rollIsSound=1,o.auto=1,t=o.rollInx,$("#rollShowWordsPad .stop").show(),$("#rollShowWordsPad .start").hide(),o.rollIsSound=1,o.auto=1,wo(t=t||1)})),$("#startRollBtn").click((function(){o.rollOpen=1,$("#rollShowWordsPad").show(),$("#rollShowWordsPad .stop").hide(),$("#rollShowWordsPad .start").show(),O(),o.rollIsSound=0,o.auto=0,o.rollInx=o.rollInx?o.rollInx:1,wo(o.rollInx)})),$("#rollShowWordsPad .word").click((function(){var e=o.wordbooks.selected.words.rows[o.rollInx-1];Y(e.word),eo(e.word),mo()})),o._mp3=$("<video x5-playsinline playsinline controls360=no webkit-playsinline ></video>")[0],o.lettersound=$("<video x5-playsinline playsinline controls360=no webkit-playsinline ></video>")[0],$("#extendSearchPad").click((function(o){this==o.target&&($("#extendSearchPad").hide(),$("#extendSearchFrame").attr("src",null).hide(),$("#extendSearchFrame1").attr("src",null).hide(),$("#extendSearchFrame2").attr("src",null).hide(),$("#extendSearchFrame3").attr("src",null).hide(),$("#extendSearchFrame4").attr("src",null).hide(),$("#extendSearchPad .g").css("background-color","unset"),$("#extendSearchPad .g1").css("background-color","unset"),$("#extendSearchPad .g2").css("background-color","unset"),$("#extendSearchPad .g3").css("background-color","unset"),$("#extendSearchPad .g4").css("background-color","unset"))})),$("#goExtendSearchBtn").click((function(e){$("#extendSearchPad").show(),$("#extendSearchFrame").attr("src","https://m.youdao.com/dict?q="+o.currWordText).show(),$("#extendSearchFrame1").attr("src",null).hide(),$("#extendSearchFrame2").attr("src",null).hide(),$("#extendSearchFrame3").attr("src",null).hide(),$("#extendSearchFrame4").attr("src",null).hide(),$("#extendSearchPad .g").css("background-color","#ffffff"),$("#extendSearchPad .g1").css("background-color","#cacaca"),$("#extendSearchPad .g2").css("background-color","#cacaca"),$("#extendSearchPad .g3").css("background-color","#cacaca"),$("#extendSearchPad .g4").css("background-color","#cacaca")})),$("#extendSearchPad .g").click((function(o){$("#extendSearchFrame").show(),$("#extendSearchFrame1").hide(),$("#extendSearchFrame2").hide(),$("#extendSearchFrame3").hide(),$("#extendSearchFrame4").hide(),$("#extendSearchPad .g").css("background-color","#ffffff"),$("#extendSearchPad .g1").css("background-color","#cacaca"),$("#extendSearchPad .g2").css("background-color","#cacaca"),$("#extendSearchPad .g3").css("background-color","#cacaca"),$("#extendSearchPad .g4").css("background-color","#cacaca")})),$("#extendSearchPad .g1").click((function(e){$("#extendSearchFrame").hide(),$("#extendSearchFrame1").show(),$("#extendSearchFrame2").hide(),$("#extendSearchFrame3").hide(),$("#extendSearchFrame4").hide(),$("#extendSearchPad .g").css("background-color","#cacaca"),$("#extendSearchPad .g1").css("background-color","#ffffff"),$("#extendSearchPad .g2").css("background-color","#cacaca"),$("#extendSearchPad .g3").css("background-color","#cacaca"),$("#extendSearchPad .g4").css("background-color","#cacaca"),$("#extendSearchFrame1").attr("src")||$("#extendSearchFrame1").attr("src","https://cn.bing.com/images/search?ensearch=1&q="+o.currWordText)})),$("#extendSearchPad .g2").click((function(e){$("#extendSearchFrame").hide(),$("#extendSearchFrame1").hide(),$("#extendSearchFrame2").show(),$("#extendSearchFrame3").hide(),$("#extendSearchFrame4").hide(),$("#extendSearchPad .g").css("background-color","#cacaca"),$("#extendSearchPad .g1").css("background-color","#cacaca"),$("#extendSearchPad .g2").css("background-color","#ffffff"),$("#extendSearchPad .g3").css("background-color","#cacaca"),$("#extendSearchPad .g4").css("background-color","#cacaca"),$("#extendSearchFrame2").attr("src")||$("#extendSearchFrame2").attr("src","https://m.baidu.com/sf/vsearch?pd=video&atn=index&word=英文"+o.currWordText)})),$("#extendSearchPad .g3").click((function(e){$("#extendSearchFrame").hide(),$("#extendSearchFrame1").hide(),$("#extendSearchFrame2").hide(),$("#extendSearchFrame3").show(),$("#extendSearchFrame4").hide(),$("#extendSearchPad .g").css("background-color","#cacaca"),$("#extendSearchPad .g1").css("background-color","#cacaca"),$("#extendSearchPad .g2").css("background-color","#cacaca"),$("#extendSearchPad .g3").css("background-color","#ffffff"),$("#extendSearchPad .g4").css("background-color","#cacaca"),$("#extendSearchFrame3").attr("src")||$("#extendSearchFrame3").attr("src","https://m.aliexpress.com/wholesale/"+o.currWordText+".html?osf=direct")})),$("#extendSearchPad .g4").click((function(e){$("#extendSearchFrame").hide(),$("#extendSearchFrame1").hide(),$("#extendSearchFrame2").hide(),$("#extendSearchFrame3").hide(),$("#extendSearchFrame4").show(),$("#extendSearchPad .g").css("background-color","#cacaca"),$("#extendSearchPad .g1").css("background-color","#cacaca"),$("#extendSearchPad .g2").css("background-color","#cacaca"),$("#extendSearchPad .g3").css("background-color","#cacaca"),$("#extendSearchPad .g4").css("background-color","#ffffff"),$("#extendSearchFrame4").attr("src")||$("#extendSearchFrame4").attr("src","https://www.learnersdictionary.com/definition/"+o.currWordText)})),$("#closeViewBtn").click((function(){o.closeView?(o.closeView=0,$("#closeViewBtn").attr("src","./img/openeye.png")):(o.closeView=1,$("#closeViewBtn").attr("src","./img/closeeye.png")),P(),f=0,p=0,o.closeView?($("#video").attr("poster",null),$("#video").css("background-image","url("+n.cover+")"),$("#video").css("background-repeat","no-repeat"),$("#video").css("background-size","contain"),$("#video").css("background-position","center"),$("#video").attr("src",n.audio16k||n.audio||n.url)):($("#video").attr("poster",n.cover),$("#video").attr("src",n.url),$("#video").css("background-image","unset"),$("#video").css("background-repeat","unset"),$("#video").css("background-size","unset"),$("#video").css("background-position","unset")),$("#videobox").css("top","0"),$("#video").attr("autoplay",!0),X()})),$("#changevideoshowtype").click((function(){$("#video")[0].load()})),$("#toShortRelatedWordsBtn").click((function(){o.shortWordText=o.shortWordText?o.shortWordText:o.currWordText,o.shortWordText=o.shortWordText.substr(0,o.shortWordText.length-1),o.shortWordText||(o.shortWordText=o.currWordText),eo(o.currWordText,o.shortWordText)})),$("#toLongRelatedWordsBtn").click((function(){o.shortWordText=o.shortWordText?o.shortWordText:o.currWordText,o.shortWordText=o.currWordText.substr(0,o.shortWordText.length+1),o.shortWordText||(o.shortWordText=o.currWordText),eo(o.currWordText,o.shortWordText)})),$("#video").bind("contextmenu",(function(){return!1})),$("#seriesPad").bind("mousedown touchstart",(function(o){if(this.touchstartTime=(new Date).getTime(),"touchstart"==o.type){var e=o.targetTouches[0];this.touchstartX=e.pageX,this.touchstartY=e.pageY}else"mousedown"==o.type&&(this.touchstartX=o.pageX,this.touchstartY=o.pageY)})).bind("mousemove touchmove",(function(o){if("touchmove"==o.type){var e=o.targetTouches[0];this.touchendX=e.pageX,this.touchendY=e.pageY}else"mousemove"==o.type&&(this.touchendX=o.pageX,this.touchendY=o.pageY);for(var t=null;!((t=t?$(t).parent():$(o.target)).scrollTop()>0)&&0!=t.length&&t!=this;);this.scrollEle=t})).bind("mouseup touchend",(function(o){this.scrollEle&&0==this.scrollEle.length&&this.touchendY-this.touchstartY>100&&($("#seriesPad").slideUp(100),$("#prevnextpad").show(),$("#subtitlePad").show()),this.touchstartY=null,this.touchendY=null})),$("#inSeriesPad").click((function(){var e,t;$("#seriesPad").css("height",$(window).height()-($("#video").height()+$("#controlpad").height()+20)+"px"),$("#seriesPad").slideDown(100),$("#prevnextpad").hide(),$("#subtitlePad").hide(),o.seriesVideos.seriesNo!=n.seriesNo?($("#seriesPad .seiresName").text("专辑: "+n.seriesChname),$("#seriesPad .row").not(".trow").remove(),o.seriesVideos.seriesNo=n.seriesNo,o.seriesVideos.rows=[],e=o.seriesVideos.rows.length+1,t=o.seriesVideos.rcount,$.ajax({url:"/mumu/series-videos?",data:{kw:"",seriesNo:o.seriesVideos.seriesNo,rstart:e,rcount:t},beforeSend:()=>{$("#seriesPad .someload").hide(),$("#seriesPad .loading").show()},success:function(s){o.seriesVideos.rows.push(...s.data.rows),1==e&&0==s.data.rows.length?($("#seriesPad .someload").hide(),$("#seriesPad .loadnodata").show()):s.data.rows.length<t?($("#seriesPad .someload").hide(),$("#seriesPad .loadend").show()):($("#seriesPad .someload").hide(),$("#seriesPad .loadmore").show()),$(s.data.rows).each(((e,t)=>{var s=$("#seriesPad .trow").clone(!0);s.removeClass("trow"),s.addClass("row"+t.no),s.find(".cover").attr("src",t.cover),s.find(".name").text((t.orderNoInSeries?ttb(t.orderNoInSeries)+" | ":"")+ttb(t.chname)),s[0].data=t,s.show(),$("#seriesPad .trow").before(s),o.seriesVideos.map["no"+t.no]=t})),$("#seriesPad .row").find(".name").css("color","#b3b3b3").css("font-weight","unset"),$("#seriesPad .row"+n.no).find(".name").css("color","#d8d8d8").css("font-weight","900")}})):($("#seriesPad .rows").scrollTop(),$("#seriesPad .row").find(".name").css("color","#b3b3b3").css("font-weight","unset"),$("#seriesPad .row"+n.no).find(".name").css("color","#d8d8d8").css("font-weight","900"))})),$("#seriesPad .trow").click((function(){var e=this.data;o.trueVideos.rows.splice(o.trueVideos.inx,100,e),o.onlyLookHimVideos.rows.splice(o.onlyLookHimVideos.inx,100,e),y(),$("#seriesPad").slideUp(100),$("#prevnextpad").show(),$("#subtitlePad").show()})),setTimeout((function(){pagePre.login.fullmember||common.alert("抱歉, 体验用户只能浏览少量内容, 请联系管理员免费转正式.")}),3e4),$("#wordbookDetailPad .moveup").click((function(){var e=o.wordbooks.selected,t=o.wordbooks.rows.indexOf(e),s=o.wordbooks.rows[t-1],r=o.wordbooks.rows[t-2],a=null;a=s&&r?(s.orderNum+r.orderNum)/2:s?s.orderNum-1:e.orderNo,$.post("/mumu/alter-wordbook",{no:e.no,orderNum:a},(function(r){0==r.code?(common.changearr(o.wordbooks.rows,t,t-1),common.changedom(e.dom,s.dom)):common.alert(r.msg)}))})),$("#wordbookDetailPad .movereset").click((function(){var e=o.wordbooks.selected;common.promptLine({message:"将重置所有单词本排序, 请输入know以确认.",manualClose:1,cancel:function(o,e){e.remove()},confirm:function(t,s){t&&"know"==t.toLowerCase().trim()?(s.remove(),$.post("/mumu/reset-all-wordbooks-ordernum",{templateNo:e.templateNo},(function(e){0==e.code?(o.wordbooks={rows:[],rstart:1,rcount:50,currRows:[],selected:null},$("#wordbooksPad .wordbooks .row").not(".row0").remove(),ao()):common.alert(e.msg)}))):common.alert("输入错误")}})})),$("#wordbookDetailPad .movedown").click((function(){var e=o.wordbooks.selected,t=o.wordbooks.rows.indexOf(e),s=o.wordbooks.rows[t+1],r=o.wordbooks.rows[t+2],a=null;a=s&&r?(s.orderNum+r.orderNum)/2:s?s.orderNum+1:e.orderNo,$.post("/mumu/alter-wordbook",{no:e.no,orderNum:a},(function(r){0==r.code?(common.changearr(o.wordbooks.rows,t,t+1),common.changedom(e.dom,s.dom)):common.alert(r.msg)}))})),$("#wordDetailPad .moveup").click((function(){var e=o.wordbooks.selected,t=e.words.selected,s=e.words.rows.indexOf(t),r=e.words.rows[s-1],a=e.words.rows[s-2],n=null;n=r&&a?(r.orderNum+a.orderNum)/2:r?r.orderNum-1:t.orderNo,t.orderNum=n,Z.send(JSON.stringify({action:8,wordbookNo:e.no,word:t.word,translation:t.translation,templateNo:e.templateNo,orderNum:n})),common.changearr(e.words.rows,s,s-1),common.changedom(t.dom,r.dom)})),$("#wordDetailPad .movereset").click((function(){var e=o.wordbooks.selected;e.words.selected;common.promptLine({message:"将重置所有单词排序, 请输入know以确认.",manualClose:1,cancel:function(o,e){e.remove()},confirm:function(t,s){t&&"know"==t.toLowerCase().trim()?(s.remove(),$.post("/mumu/reset-all-wordbook-words-ordernum",{wordbookNo:e.no,templateNo:e.templateNo},(function(t){0==t.code?(e.words={rows:[],currRows:[],rcount:200,selected:null},o.wordbooks.map["no"+e.no].words.rows=[],$("#wordbooksPad .words .pad .row").not(".row0").remove(),so(e.no)):common.alert(t.msg)}))):common.alert("输入错误")}})})),$("#wordDetailPad .movedown").click((function(){var e=o.wordbooks.selected,t=e.words.selected,s=e.words.rows.indexOf(t),r=e.words.rows[s+1],a=e.words.rows[s+2],n=null;n=r&&a?(r.orderNum+a.orderNum)/2:r?r.orderNum+1:t.orderNo,t.orderNum=n,Z.send(JSON.stringify({action:8,wordbookNo:e.no,word:t.word,translation:t.translation,templateNo:e.templateNo,orderNum:n})),common.changearr(e.words.rows,s,s+1),common.changedom(t.dom,r.dom)})),$("#wordDetailPad .closeBtn").click((function(){$("#wordDetailPad").hide()})),$("#wordDetailPad .deleteBtn").click((function(){var e=o.wordbooks.selected,t=e.words.selected;e.templateNo&&"100000000000"!=pagePre.login.userNo?common.alert("不可编辑系统单词本"):common.promptLine({message:"将删除<span style=color:red;font-size:15px>"+t.word+"</span>, 请输入delete以确认移除.",manualClose:1,cancel:function(o,e){e.remove()},confirm:function(o,s){o&&"delete"==o.toLowerCase().trim()?(Z.send(JSON.stringify({action:9,wordbookNo:e.no,word:t.word,templateNo:e.templateNo})),e.words.rows.splice(e.words.rows.indexOf(t),1),$(t.dom).remove(),s.remove()):common.alert("输入错误")}}),$("#wordDetailPad").hide()}))}();