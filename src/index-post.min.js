!function(){var t={};window.page=t,log.debugon=1,setTimeout((function(){$("#logo").hide(),$("#index").show()}),1e3),$("#video")[0].crossOrigin="anonymous",$("#finger,gear").animate({left:"+=150px"},2e3,(function(){$("#finger").animate({left:"-=300px"},2e3,(()=>{$("#finger").fadeOut(500)}))})),$("#gear").animate({left:"+=150px"},2e3,(function(){$("#gear").animate({left:"-=300px"},2e3)})),document.addEventListener("WeixinJSBridgeReady",(function(){$("#video")[0].play()}),!1);var n,i,o=null,s=[],a=window.location.search.substring(1).split("&")[0].split("=")[1],r=null;a&&$.ajax({url:"/mumu/video?",type:"get",data:"videoNo="+a,async:!1,success:function(e){r=e.data.video}});var c=[],l=-1;$.ajax({url:"/mumu/chatroom-msgs?",type:"get",data:"rcount=300",async:!0,success:function(e){$(e.data.rows).each(((e,t)=>{0==e&&($("#lastmsg").text("南京网友: "+t.text),$("#chatminpad").show());var n=$("#chatmsgtemple").clone(!0);n.attr("id","chatmsg"+t.msgNo),t.userNo==$.cookie("token")&&n.css("color","green"),n.find(".name").text("南京网友"),n.find(".msg").text(t.text),n.find(".msghold").text(t.text),n.show(),$("#chatmsgspad").append(n)})),0==e.data.rows.length&&($("#lastmsg").text("聊天室"),$("#chatminpad").show())}}),$.ajax({url:"/mumu/explore-videos?",type:"get",data:"shortvideo=1&kw=&pageSize=30",async:!1,success:function(e){c.push(...e.data.videos),localStorage.setItem("videos",JSON.stringify(c)),r&&c.unshift(r)}});var u=localStorage.getItem("currentTime-"+i),d=parseInt(localStorage.getItem("currentIndex-"+i)),h=JSON.parse(localStorage.getItem("currentCaption-"+i)),p=h,m=0,g=0,f=0,v={subtitles:"",monitor:"",subtitlesList:[],current:h,currentIndex:d};t.en=v;var b=[];Y=Y;var w=$("#video")[0];function x(){z(),c[l+1]||$.ajax({url:"/mumu/explore-videos?",type:"get",data:"shortvideo=1&kw=&pageSize=30",async:!1,success:function(e){e.data.videos.length>0&&(c.push(...e.data.videos),localStorage.setItem("videos",JSON.stringify(c)))}}),c[l+1]&&(l++,i=c[l].no,n=c[l],localStorage.setItem("videosIndex",l),T(n))}function T(e){n=e,$("#titleinback").text(n.name),$("#titleinbackpad").show(),function(){if(localStorage.getItem("translateed"))$("#video").css("top","0"),$("#video").attr("autoplay",!0),$("#video").attr("src",n.url),setTimeout((function(){$("#video")[0].muted=!1}),500);else{$("#hintssec").text(3),z(),$("#video").css("top","-1000px"),$("#hints").css("height",$("#video").css("height")).show(),setTimeout((function(){$("#hints").fadeOut(1e3,(function(){$("#video").css("top","0"),$("#video").attr("src",n.url),setTimeout((function(){$("#video")[0].muted=!1}),500)}))}),3e3);var e=setInterval((function(){var t=$("#hintssec").text()-1;t<1?clearInterval(e):$("#hintssec").text(t)}),1e3)}}(),$.ajax({url:n.captionUrl,type:"get",async:!1,success:function(e){!function(e){log.debug("getEnSubtitles: "+ ++m),v.subtitlesList=[];let t=[];t=e.split(/[(\r\n)\r\n]+/),t.forEach(((e,n)=>{if(e||t.splice(n,1),new RegExp(/^(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d/).test(e)){var i=t[n+2],o=t[n+1];if(i.indexOf("{\\pos")>=0||o.indexOf("{\\pos")>=0)return;v.subtitlesList.push({startTime:C(e.split(" --\x3e ")[0].replace(",",".")),endTime:C(e.split(" --\x3e ")[1].replace(",",".")),chValue:o,enValue:i})}}));for(let e=0;e<v.subtitlesList.length;e++){e;const t=v.subtitlesList[e],n=v.subtitlesList[e+1];e<v.subtitlesList.length-2&&n.startTime-t.endTime>1e3&&v.subtitlesList.splice(e+1,0,{startTime:parseInt(t.endTime)+1e3,endTime:n.startTime,chValue:"",enValue:""})}var i=v.subtitlesList[0];i&&i.startTime>0&&v.subtitlesList.splice(0,0,{startTime:0,endTime:i.startTime,chValue:"",enValue:""});var o=v.subtitlesList[v.subtitlesList.length-1];o&&v.subtitlesList.push({startTime:parseInt(o.endTime)+1e3,endTime:1e3*n.duration,chValue:"",enValue:""});v.currentIndex>=0?(v.current=v.subtitlesList[v.currentIndex],Y(v.current)):Y(v.subtitlesList[0])}(e)}}),setTimeout((function(){var e=JSON.parse(localStorage.getItem("historyvideos"));e||(e=[]);for(var t=0;t<e.length;t++)e[t].no==n.no&&e.splice(t,1);e.unshift(n),localStorage.setItem("historyvideos",JSON.stringify(e))}),5e3)}function k(){g||u&&($("#video")[0].currentTime=u,log.debug("set lct: "+u+" ct: "+$("#video")[0].currentTime),$("#video")[0].currentTime>=u&&(g=1))}function y(){!function(){if(!f){if(0==u)return void(f=1);u&&($("#video")[0].currentTime=u,log.debug("set lct: "+u+" ct: "+$("#video")[0].currentTime),$("#video")[0].currentTime>=u&&(f=1))}}(),w.paused&&I(1e3*w.currentTime)}function I(e){if($("#loading").hide(),localStorage.setItem("durationsec-"+i,$("#video")[0].duration),localStorage.setItem("currentTime-"+i,$("#video")[0].currentTime),p){if(!(p.startTime<e))return;p=null}if(!(v.current&&v.current.startTime<=e&&e<v.current.endTime)){var t=v.subtitlesList[v.currentIndex+1];return t&&t.startTime<=e&&e<t.endTime?(log.debug("next "),v.current=t,v.currentIndex++,void Y(t)):t&&e<t.startTime&&(!v.current||e>v.current.endTime)?(log.debug("before next"),void log.debug("next: st: "+t.startTime+" currinx: "+v.currentIndex)):void $(v.subtitlesList).each((function(t,n){if(n.startTime<=e&&e<n.endTime){debugger;return log.debug("search all "),v.current=n,v.currentIndex=t,void Y(n)}}))}}function Y(e){if(!e)return;log.debug("setline: ct: "+$("#video")[0].currentTime+" st: "+e.startTime+" et: "+e.endTime+" "+e.enValue.substr(0,5)),localStorage.setItem("currentCaption-"+i,JSON.stringify(e)),localStorage.setItem("currentIndex-"+i,v.currentIndex);let t=e.enValue.split(" ");$("#zh_subtitles").html(""),v.currentwords=t;for(let e=0;e<t.length;e++)if("\\n"!=t[e]){var n=t[e].split("\\n");if(n[0]){var o=$('<span style="border-bottom:2px solid #ffffff;;user-select: none;display: inline-block;cursor: pointer;font-weight: 900;font-size: 18px;padding-left:3px;padding-right:3px;" index="'+e+'" class="font span'+e+'">'+n[0]+"</span>");o.bind("click",(function(){z(),B(e+1)})).bind("mouseout",(function(){$(this).css("border-bottom","2px solid #ffffff")})).bind("mouseover",(function(){$(this).css("border-bottom","2px solid black")})),$("#zh_subtitles").append(o)}n[1]&&t.splice(e+1,0,"\\n",n[1]),n[2]&&t.splice(e+3,0,"\\n",n[2]),n[3]&&t.splice(e+5,0,"\\n",n[3])}else $("#zh_subtitles").append("<br/>");$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),J=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),$("#summtrans").hide(),$("#wordsframe").hide(),$("#word-in").val(""),$("#video").css("top","0px")}function _(){if(v.currentIndex>0){var e=v.currentIndex,t=v.subtitlesList[--e];t&&(t.enValue||(t=v.subtitlesList[--e])),t&&(v.currentIndex=e,v.current=t,p=t,u=t.startTime/1e3,$("#video")[0].currentTime=t.startTime/1e3,log.debug("set ct: "+t.startTime/1e3+" ct: "+$("#video")[0].currentTime),Y(t),J=0,$(".chDialog").hide(),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""))}}function S(){var e=v.currentIndex,t=v.current;t&&(t.enValue||(t=v.subtitlesList[--e]),t&&(v.currentIndex=e,v.current=t,$("#video")[0].currentTime=t.startTime/1e3,p=t,u=t.startTime/1e3,log.debug("set ct: "+t.startTime/1e3+" ct: "+$("#video")[0].currentTime),Y(t),J=0,$(".chDialog").hide(),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}function N(){var e=v.currentIndex,t=v.subtitlesList[++e];t&&(t.enValue||(t=v.subtitlesList[++e]),t&&(v.currentIndex=e,v.current=t,p=t,u=t.startTime/1e3,$("#video")[0].currentTime=t.startTime/1e3,log.debug("set ct: "+t.startTime/1e3+" ct: "+$("#video")[0].currentTime),Y(t),J=0,$(".chDialog").hide(),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}function X(e){log.debug(e+3),$("#summrest").hide(),t.dovideoshadow=1,z(),E();var i=localStorage.getItem("translateed");i=parseInt(i?++i:1),localStorage.setItem("translateed",i),e=e.replace(/^(,|\.|\?|!|\[|\]\(|\))+/,"").replace(/(,|\.|\?|!|\[|\]\(|\))+$/,""),$("#summtrans").show(),$("#summtrans-word").text(e),$("#word-in").val(e),clearTimeout(window.timeoutdo1),window.timeoutdo1=setTimeout((function(){if($("#favor").attr("word",e),window.aaa=setTimeout((function(){$("#summtrans-phonetic").hide(),$("#summtrans-speak").hide(),$("#summtrans-value").hide()}),500),null==e||null==e||!e.toString().trim())return $("#summtrans-phonetic").hide(),$("#summtrans-speak").hide(),void $("#summtrans-value").hide();t.ajaxtranslate=$.ajax({url:"/mumu/translate?from="+n.language+"&to=2&q="+e,type:"get",async:!0,success:function(e){clearTimeout(window.aaa),e.data.phonetic?$("#summtrans-phonetic").text("/"+e.data.phonetic+"/").show():$("#summtrans-phonetic").hide(),e.data.speakUrl?$("#summtrans-speak").attr("play-url",e.data.speakUrl).show():$("#summtrans-speak").hide(),$("#summtrans-vv").html("").scrollTop(0),e.data.translations&&$(e.data.translations).each((function(e,t){$("#summtrans-vv").append(`<div>${R(t)}</div>`)})),e.data.webTranslations&&($("#summtrans-vv").append('<div style="margin-top:10px;">网络释义: </div>'),$(e.data.webTranslations).each((function(e,t){$("#summtrans-vv").append(`<div>${R(t)}</div>`)}))),$(".lightkeytrans").bind("click",(function(){X(this.innerText)})),$("#wordsframe").hide(),$("#summrest").show(),$("#summtrans-vv").show(),$("#summtrans-value").show(),$("#summtrans").show(),$("#video").css("top","-1000px")}})}),200)}function z(){log.debug("pauseVideo()"),$("#video")[0].pause()}function D(){log.debug("playVideo()"),$("#video")[0].play(),clearTimeout(window.timeoutdo1)}function L(){log.debug("onpause: "+ ++m),log.debug(" ct: "+$("#video")[0].currentTime+" st: "+(v.current&&v.current.startTime)+" et: "+(v.current&&v.current.endTime)+" "+(v.current&&v.current.enValue.substr(0,5))),clearInterval(v.monitor),$(".stopFn").css({display:"none"}),$(".startFn").css({display:"inline"}),$("#video")[0].currentTime==$("#video")[0].duration&&setTimeout((function(){x()}),1e3),E()}function E(){if(t.dovideoshadow&&$("#videoshasow").is(":hidden")){var e=videocapture($("#video")[0]);$("#videoshasowimg").attr("src",e.src),e.src||$("#videoshasowimg").css("background-color","#000000"),$("#videoshasow").show(),log.debug("$('#videoshasow').show()"),$("#video").css("top","-1000px")}}function V(){if(!v.current||!v.current.chValue)return;o=$("#video")[0].paused;$("#video")[0].currentTime;$(".chDialog").css("display","block"),$(".chDialog div").html(v.current.chValue.replace(/\\n/g,"<br/>")),z()}function O(){$(".chDialog").css("display","none"),o?z():D()}function C(e){let t=e.split(":"),n=0;return t.forEach(((e,t)=>{switch(t){case 0:n+=60*parseFloat(e)*60*1e3;break;case 1:n+=60*parseFloat(e)*1e3;break;case 2:n+=1e3*parseFloat(e);break}})),n}function U(e){log.debug(e),t.dovideoshadow=1,z();let n=$("#zh_subtitles").width()+$("#zh_subtitles").offset().left-5,i=$("#zh_subtitles").height()+$("#zh_subtitles").offset().top-5;if(b=[],$("#zh_subtitles span").css({background:"transparent",color:"black"}),ele=document.elementFromPoint(e.pageX,e.pageY),!$(ele).hasClass("font"))return;let o=e.clientX||e.pageX,s=e.clientY||e.pageY;n-5>o&&o>$("#zh_subtitles").offset().left+5&&$("#zh_subtitles").offset().top+5<s&&s<i-5&&ele.className.lastIndexOf("font span ")<0&&" "!=ele.innerHTML&&(b.push({class:ele.className,value:ele.innerHTML}),$("."+ele.className.split(" ")[1]).css({background:"#d2cbcb",color:"black"}))}function F(e){if(ele=document.elementFromPoint(e.pageX,e.pageY),!$(ele).hasClass("font"))return;let t=e.clientX||e.pageX,n=e.clientY||e.pageY,i=$("#zh_subtitles").width()+$("#zh_subtitles").offset().left,o=$("#zh_subtitles").height()+$("#zh_subtitles").offset().top;if(i-5>t&&t>$("#zh_subtitles").offset().left+5&&$("#zh_subtitles").offset().top+5<n&&n<o-5&&ele.className.lastIndexOf("font span ")<0){let e=!0;if(b.findIndex((function(t,n){t.class==ele.className&&(e=!1)})),e&&" "!=ele.innerHTML)if(b.length){let e=parseInt(b[b.length-1].class.replace("font span","")),t=parseInt(ele.className.replace("font span",""));if(log.debug(t-e),t==e+1)b.push({class:ele.className,value:ele.innerHTML}),$("."+ele.className.split(" ")[1]).css({background:"#d2cbcb",color:"black"});else if(t>e+1)for(let n=e;n<t;n++)$(".span"+n),b.push({class:$(".span"+n).attr("class"),value:$(".span"+n).html()}),$(".span"+n).css({background:"#d2cbcb",color:"black"});else for(let n=t;n<e;n++)$(".span"+n),b.push({class:$(".span"+n).attr("class"),value:$(".span"+n).html()}),$(".span"+n).css({background:"#d2cbcb",color:"black"})}else b.push({class:ele.className,value:ele.innerHTML}),$("."+ele.className.split(" ")[1]).css({background:"#d2cbcb",color:"black"})}}function P(e){ele=document.elementFromPoint(e.pageX,e.pageY);for(let e=0;e<b.length-1;e++)for(let t=0;t<b.length-e-1;t++)if(parseInt(b[t].class.replace("font span",""))>parseInt(b[t+1].class.replace("font span",""))){let e=b[t];b[t]=b[t+1],b[t+1]=e}let t="";$(b).each((function(e,n){e>0?t+=" "+n.value.replace(/^(,|\.|\?|!)+/,"").replace(/(,|\.|\?|!)+$/,""):t=n.value.replace(/^(,|\.|\?|!)+/,"").replace(/(,|\.|\?|!)+$/,"")})),t?(t,X(t)):"",$(".searchClass").blur()}h&&Y(h),$("#historyword_template").bind("click",(function(e){log.info("$(#historyword_template).click "+$(this).attr("data")),t.dovideoshadow=1,z(),X(this.innerText)})),x(),function(){var e=localStorage.getItem("historywords");e&&(s=JSON.parse(e));for(let e=0;e<s.length;e++){var t=s[e];t=t.replace(/^(,|\.|\?|!|\[|\]\(|\))+/,"").replace(/(,|\.|\?|!|\[|\]\(|\))+$/,"");var n=$("#historyword_template").clone(!0);n.attr("id","historyword-"+t.replace(/[^\w]/g,"")),n.attr("data",t),n.text(t),n.css("display","inline-block"),n.show(),$("#historywordspad").append(n)}}(),$(".yibiao").on("click","span svg",(function(){log.info("$(.yibiao).click"),new Audio($(this).attr("playsrc")).play()})),$("#favor").click((function(){log.info("#favor.click");var e=$(this).attr("word");/.*[\u4e00-\u9fa5]+.*$/.test(e)||$(this).attr("word").split(" ").length>3||(function(e){var t=s.indexOf(e);t>-1&&s.splice(t,1);$("#historyword-"+e.replace(/[^\w]/g,"")).remove()}(e),function(e){e=e.replace(/^(,|\.|\?|!|\[|\]\(|\))+/,"").replace(/(,|\.|\?|!|\[|\]\(|\))+$/,"");var t=(s=s||[]).indexOf(e);t>-1&&s.splice(t,1);s.unshift(e);var n=$("#historyword_template").clone(!0);n.attr("id","historyword-"+e.replace(/[^\w]/g,"")),n.attr("data",e),n.text(e),n.css("display","inline-block"),$("#historywordspad").prepend(n),localStorage.setItem("historywords",JSON.stringify(s))}(e))})),t.dovideoshadow=0,$("#zh_subtitles").mousedown((e=>{log.info("#zh_subtitles.mousedown"),$(e.target).hasClass("font")&&(moveStata=!0,_coordinates={clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY},U(_coordinates),$("#zh_subtitles").mousemove((e=>{$(e.target).hasClass("font")&&moveStata&&(_coordinates={clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY},F(_coordinates))})).mouseup((function(e){log.info("#zh_subtitles.mouseup"),$(e.target).hasClass("font")&&(moveStata=!1,_coordinates={clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY},P(_coordinates),$("#zh_subtitles").unbind("mousemove").unbind("mouseup"))})))}));var j,J=0,M=[];function B(e){(J=e,$(".font").css({background:"transparent"}),$(".font.span"+(J-1)).css({background:"#d2cbcb"}),t.dovideoshadow=1,z(),$("#summtrans-word").show(),J>0)&&($("#wordsframe").hide(),X(v.currentwords[J-1]))}function H(){isPc()?($("#gearframe1").hide(),$("#pcrecommand").text("控制键(a,s,d,space) 翻译键(q,w,e,enter)")):($("#gearframe1").show(),$("#pcrecommand").text("PC端操作更方便"))}function A(){document.activeElement==$("#word-in")[0]?($("#wordsframe").hide(),X($("#word-in").val()),$("#word-in").val()||($("#summtrans").hide(),$("#wordsframe").hide(),$("#video").css("top",0))):($("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").focus(),$("#word-in").trigger("input"),t.dovideoshadow=1,z())}document.onkeydown=function(e){var t=e||window.e,n=t.keyCode||t.which,i=(M=[]).pop();switch(null!=i&&null!=i&&M.push(i),n!=i&&M.push(n),log.debug(M+" down"),M.join()){case"27":$("#summtrans").hide(),$("#summtrans-word").text(""),$("#summtrans-phonetic").text("").hide(),$("#summtrans-speak").attr("play-url","").hide(),$("#summtrans-value").hide(),$("#summtrans-vv").text(""),$("#wordsframe").hide(),$("#word-in").val(""),$("#words .word").remove(),$("#video").css("top",0);break;case"32":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;$("#video")[0].paused?(O(),D()):z();break;case"13":"INPUT"!=document.activeElement.tagName&&A();break;case"97":case"65":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;_();break;case"115":case"83":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;S();break;case"119":case"87":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;$(".chDialog").is(":hidden")?V():O();break;case"100":case"68":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;N();break;case"113":case"81":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;J<=1?J=v.currentwords.length:J--,B(J);break;case"101":case"69":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;++J>v.currentwords.length&&(J=1),B(J);break}},document.onkeyup=function(e){log.debug(M+" up"),M.pop()},document.onfocus=function(){log.debug("document.blur()"),M=[]},window.onbeforeunload=function(){log.debug("onbeforeunload"),navigator.sendBeacon("/mumu/page-out"),log.flush()},document.addEventListener("touchend",(function(e){var t=(new Date).getTime();t-j<=300&&e.preventDefault(),j=t}),!1),H(),$(document.body).bind("resize",(function(){H()})),$.get("/mumu/wxjsapiticket",(e=>{$.get("/mumu/wxsign",{ticket:e.data.ticket,url:location.href},(e=>{log.debug(JSON.stringify(e)),wx.config({debug:!1,appId:e.data.appid,timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,signature:e.data.signature,jsApiList:["updateAppMessageShareData","updateTimelineShareData"]})}))}));var q=location.origin+"/mumu/index.html?videoNo="+i;function R(e){if(!e)return e;var t=e.match(/(\w*)\s*?(的过去|的现在|的复数|的第三|的ing)/);return t?e=e.replace(t[1],`<span class="lightkeytrans" style="text-decoration: underline;cursor:pointer;">${t[1]}</span>`):e}wx.ready((function(){wx.updateAppMessageShareData({title:n.name,desc:"幕幕 - 英语练习",link:q,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),wx.updateTimelineShareData({title:n.name+"\n幕幕 - 英语练习",link:q,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}})})),$("#video").bind("play",(function(){log.debug("onplay: "+ ++m),log.debug(" ct: "+$("#video")[0].currentTime+" st: "+(v.current&&v.current.startTime)+" et: "+(v.current&&v.current.endTime)+" "+(v.current&&v.current.enValue.substr(0,5))),t.ajaxtranslate&&t.ajaxtranslate.abort(),t.dovideoshadow=0,$(".dialog").hide(),$("#summtrans").hide(),$("#summtrans-word").text(""),$("#wordsframe").hide(),$("#word-in").val(""),$("#summtrans-value").hide(),$("#summtrans-vv").text(""),$("#summtrans-phonetic").text("").hide(""),$("#summtrans-speak").attr("play-src","").hide(""),$("#video").css("top","0px"),clearInterval(v.monitor),v.monitor=setInterval((function(){I(1e3*w.currentTime)}),10),J=0,"",$("#zh_subtitles span").css({background:"transparent",color:"black"}),$(".startFn").css({display:"none"}),$(".stopFn").css({display:"inline"}),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),$(".searchClass").val(""),$(".yibiao").html(""),$(".fanyi").html(""),$("#videoshasow").hide()})).bind("pause",(function(){L()})).bind("mouseover",(function(){$("#video").attr("controls",!0)})).bind("mouseout",(function(){$("#video").attr("controls",!1)})).bind("canplay",(function(){k()})).bind("durationchange",(function(){})).bind("loadeddata",(function(){})).bind("loadstart",(function(){})).bind("playing",(function(){})).bind("progress",(function(){})).bind("readystatechange",(function(){})).bind("suspend",(function(){})).bind("timeupdate",(function(){y()})).bind("waiting",(function(){})).bind("click",(function(){$("#video").attr("controls",!0)})).bind("loadedmetadata",(function(){})).bind("touchend",(function(){$("#video").attr("controls",!0)})).bind("focus",(function(){$("#video").attr("controls",!0)})).bind("blur",(function(){$("#video").attr("controls",!1)})),$("#summtrans-word").bind("click",(function(){log.info("#summtrans-word.click"),$("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").val(this.innerText).focus(),$("#word-in").trigger("input")})),$("#summtrans-speak").bind("click",(function(){log.info("#summtrans-speak.click"),this.audio||(this.audio=new Audio),this.audio.src=$(this).attr("play-url"),this.audio.play()})),$("#wordtempl").bind("click",(function(){log.info("#wordtempl.click"),$("#wordsframe").hide(),$("#word-in").val(""),$("#words .word").remove(),X(this.item.q)})),$("#word-in").bind("input",(function(){log.info("#word-in.input");var e=this,t=this.value;""==this.value?$("#wordsframe_cancel").show():$("#wordsframe_cancel").hide(),t?$.ajax({url:"/mumu/words",method:"get",data:{kw:t,start:1,pageSize:10,from:n.language,to:2},success:function(n){if(e.value==t){$("#words .word").remove();var i=n.data.words;$(i).each(((e,t)=>{var n=$("#wordtempl").clone(!0);n[0].item=t,n.attr("id","word"+(e+1)),n.addClass("word"),n.html(t.q+"&nbsp;&nbsp;"+(t.phonetic?"/"+t.phonetic+"/":"")+"&nbsp;&nbsp;"+(t.explain1||"")+(t.explain2?" | ":"")+(t.explain2||"")+(t.explain3?" | ":"")+(t.explain3||"")+(t.explain4?" | ":"")+(t.explain4||"")+(t.explain5?" | ":"")+(t.explain5||"")),$("#words").append(n),n.show()}))}}}):$("#words .word").remove()})),$("#zh_subtitles").bind("touchstart",(function(e){var t;(log.info("#zh_subtitles.touchstart"),$(e.target).hasClass("font"))&&(t=e,_coordinates={clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY,pageX:t.changedTouches[0].pageX,pageY:t.changedTouches[0].pageY},U(_coordinates),e.preventDefault())})).bind("touchmove",(function(e){var t;$(e.target).hasClass("font")&&(t=e,_coordinates={clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY,pageX:t.changedTouches[0].pageX,pageY:t.changedTouches[0].pageY},F(_coordinates),e.preventDefault())})).bind("touchend",(function(e){var t;(log.info("#zh_subtitles.touchend"),$(e.target).hasClass("font"))&&(t=e,_coordinates={clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY,pageX:t.changedTouches[0].pageX,pageY:t.changedTouches[0].pageY},P(_coordinates),e.preventDefault())})),$("#startFn,#startFn1").bind("click",(function(){log.info("#startFn.click"),D(),$("#video").attr("controls",!1)})),$("#stopFn,#stopFn1").bind("click",(function(){log.info("#stopFn.click"),z(),$("#video").attr("controls",!1)})),$("#prevline").bind("click",(function(){log.info("#prevline.click"),_()})),$("#currline").bind("click",(function(){log.info("#nextline.click"),S()})),$("#nextline").bind("click",(function(){log.info("#nextline.click"),N()})),$("#gear").bind("touchstart",(function(e){log.info("#gear.touchstart");var t=e.targetTouches[0];this.startX=t.pageX,this.startY=t.pageY})).bind("touchmove",(function(e){var n=e.targetTouches[0];this.endX=n.pageX,this.endY=n.pageY;var i=this.endX-this.startX;this.endY,this.startY;log.debug("distanceX: "+i+" lastDist: "+this.lastDist),null!=this.lastDist&&null!=this.lastDist||(this.lastDist=i);var o=i-this.lastDist;this.lastDist=i;var s=parseInt(this.style.left.replace("px"))+o;s<=0&&s>=-4900&&(this.style.left=s+"px"),this.xx||(this.xx=0),this.xx=this.xx+o;var a=null;this.xx>30?(a=J,a++):this.xx<-30&&(a=J,a--),null!=a&&(a<1&&(a=v.currentwords.length),a>v.currentwords.length&&(a=1),t.dovideoshadow=1,z(),B(a),this.xx=0),e.preventDefault()})).bind("touchend",(function(e){log.info("#gear.touchend"),this.lastDist=null,this.xx=0})),$("#replay").bind("click",(function(e){log.info("#replay.click"),$("#video")[0].load(),setTimeout((function(){$("#video")[0].muted=!1}),500)})),$("#hideBtn").bind("click",(function(e){log.info("#hideBtn.click"),$("#zh_subtitles").css("opacity"),1==$("#zh_subtitles").css("opacity")?($("#zh_subtitles").css("opacity",0),$("#hideBtn").text("显示")):($("#zh_subtitles").css("opacity",1),$("#hideBtn").text("隐藏"))})),$("#wholebtn").bind("click",(function(e){log.info("#wholebtn.click"),V()})),$("#searchbtn").bind("click",(function(e){log.info("#searchbtn.click"),A()})),$("#chDialog").bind("click",(function(e){log.info("#chDialog.click"),O()})),document.body.addEventListener("click",(function(){log.debug(event.target)})),$("#goPrevVideo").click((function(){log.info("#goPrevVideo.click"),c[l-1]&&(z(),l--,i=c[l].no,n=c[l],localStorage.setItem("videosIndex",l),T(n))})),$("#goNextVideo").click((function(){log.info("#goNextVideo.click"),x()})),$("#word-in").bind("blur",(function(){""==this.value&&($("#wordsframe").hide(),$("#video").css("top",0),D())})),$("#word-in").bind("focus",(function(){this.select(),""==this.value?$("#wordsframe_cancel").show():$("#wordsframe_cancel").hide()})),$("#chatminpad").click((function(){$("#chatpad").css("height",$(window).height()-($("#video").height()+64+$("#startstoppad").height()+5)+"px"),$("#startstoppad").show(),$("#chatpad").slideDown(100,(function(){$("#video").attr("loop","loop")}))})),$("#chatroombtn").click((function(){$("#chatroompad").show(),$("#chatprivatepad").hide(),$(this).css("background-color","#d7d7d7"),$("#chatprivatebtn").css("background-color","#737373")})),$("#chatprivatebtn").click((function(){$("#chatroompad").hide(),$("#chatprivatepad").show(),$(this).css("background-color","#d7d7d7"),$("#chatroombtn").css("background-color","#737373")})),$("#index").bind("click",(function(e){$(e.target).hasClass("translatable")&&X(e.target.innerHTML)})),$("#index").bind("touchstart",(function(e){if(!($(e.target).parents(".scrollable").length>0)){var t=e.targetTouches[0];this.indextouchstart=t.pageY,log.debug("indextouchstart "+this.indextouchstart)}})).bind("touchmove",(function(e){if(!($(e.target).parents(".scrollable").length>0)){var t=e.targetTouches[0];this.indextouchend=t.pageY,0==$(e.target).scrollTop()&&this.indextouchstart<this.indextouchend&&e.preventDefault()}})).bind("touchend",(function(e){$(e.target).parents(".scrollable").length>0||(log.debug("indextouchend "+this.indextouchend),this.indextouchstart=null,this.indextouchend=null)})),$("#chatprivatebtn,#chatroombtn,#chatprivatepad,#chatinput").bind("touchstart",(function(e){var t=e.targetTouches[0];this.touchstart=t.pageY,log.debug("touchstart "+this.touchstart)})).bind("touchmove",(function(e){var t=e.targetTouches[0];this.touchend=t.pageY,0==$(this).scrollTop()&&this.touchstart<this.touchend&&e.preventDefault()})).bind("touchend",(function(e){log.debug("touchend "+this.touchend),this.touchend-this.touchstart>50&&($("#startstoppad").hide(),$("#chatpad").slideUp(100,(function(){$("#video").attr("loop",!1)}))),this.touchstart=null,this.touchend=null})),$("#chatprivatebtn,#chatroombtn,#chatprivatepad,#chatinput").bind("mousedown",(function(e){log.debug("mousedown "+e.pageY),this.mousedown=e.pageY})).bind("mousemove",(function(e){this.mouseup=e.pageY,0==$(this).scrollTop()&&this.mousedown<this.mouseup&&e.preventDefault()})).bind("mouseup",(function(e){log.debug("mouseup "+e.pageY),this.mouseup=e.pageY,this.mouseup-this.mousedown>50&&($("#startstoppad").hide(),$("#chatpad").slideUp(100,(function(){$("#video").attr("loop",!1)}))),this.mousedown=null,this.mouseup=null})),$("#chatmsgspad").bind("touchstart",(function(e){var t=e.targetTouches[0];this.touchstart=t.pageY,log.debug("touchstart "+this.touchstart)})).bind("touchmove",(function(e){var t=e.targetTouches[0];this.touchend=t.pageY,0==$("#chatmsgspad").scrollTop()&&this.touchstart<this.touchend&&e.preventDefault()})).bind("touchend",(function(e){log.debug("touchend "+this.touchend),this.touchend-this.touchstart>50&&0==$("#chatmsgspad").scrollTop()&&($("#startstoppad").hide(),$("#chatpad").slideUp(100,(function(){$("#video").attr("loop",!1)}))),this.touchstart=null,this.touchend=null})),$("#chatmsgspad").bind("mousedown",(function(e){log.debug("mousedown "+e.pageY),this.mousedown=e.pageY})).bind("mousemove",(function(e){this.mouseup=e.pageY,0==$("#chatmsgspad").scrollTop()&&this.mousedown<this.mouseup&&e.preventDefault()})).bind("mouseup",(function(e){log.debug("mouseup "+e.pageY),this.mouseup=e.pageY,this.mouseup-this.mousedown>50&&0==$("#chatmsgspad").scrollTop()&&($("#startstoppad").hide(),$("#chatpad").slideUp(100,(function(){$("#video").attr("loop",!1)}))),this.mousedown=null,this.mouseup=null})),$("#word-in").keydown((function(){13==(window.event||e).keyCode&&A()})),$("#chatinput").keydown((function(){if(13==(window.event||e).keyCode){if(""==this.value)return;var t={text:this.value,action:1};W.send(JSON.stringify(t)),this.value=""}}));var W=null;function G(){(W=new WebSocket(`wss://${location.host}/mumu/websocket/${$.cookie("token")}`)).onopen=function(){log.debug("ws onopen"),t.ws=W},W.onmessage=function(e){log.debug("ws onmessage: "+e.data);var t=JSON.parse(e.data);if(1==t.action){var n=$("#chatmsgtemple").clone(!0);n.attr("id","chatmsg"+t.msgNo),t.userNo==$.cookie("token")&&n.css("color","green"),n.find(".name").text("南京网友"),n.find(".msg").text(t.text),n.find(".msghold").text(t.text),n.show(),$("#chatmsgspad").prepend(n),$("#lastmsg").text("南京网友: "+t.text)}},W.onclose=function(e){},W.onerror=function(e){}}G(),setInterval((()=>{W&&3==W.readyState&&(log.debug("to ws init after 3"),G())}),1e3),setInterval((function(){W&&1==W.readyState&&(log.debug("to ws heart check"),W.send("0"))}),3e4)}();