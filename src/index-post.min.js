!function(){var t={manual:1};window.page=t,t.translateajaxs=[],t.seed=Math.ceil(100*Math.random()),t.rstart=1,t.currVideos=[];var n="",s="";pagePre.loginTime&&(new Date).getTime()-pagePre.loginTime>864e5&&$.ajax({url:"/mumu/login-refresh",method:"get",async:!0,success:function(t){0==t.code&&(pagePre.login=t.data,localStorage.setItem(config.project+"-login",JSON.stringify(pagePre.login)),localStorage.setItem(config.project+"-loginTime",(new Date).getTime()))}}),setTimeout((function(){$("#logo").hide(),$("#index").show(),$("#finger").animate({left:"+=150px"},2e3,(function(){$("#finger").animate({left:"-=300px"},2e3,(()=>{$("#finger").fadeOut(500)}))})),$("#gear").animate({left:"+=150px"},2e3,(function(){$("#gear").animate({left:"-=300px"},2e3)}))}),1e3);var i=0;$("#video")[0].crossOrigin="anonymous",document.addEventListener("WeixinJSBridgeReady",(function(){$("#video")[0].play()}),!1);var o,a,r=[],c=window.location.search.substring(1).split("&")[0].split("=")[1],d=null,u=[],l=-1;c&&$.ajax({url:"/mumu/video?",type:"get",ajaxCache:!0,data:"videoNo="+c,async:!1,success:function(t){o=d=t.data.video}}),$.ajax({url:"/mumu/explore-videos?",type:"get",data:"shortvideo=1&kw="+n+"&pageSize=5&tag="+s+"&seed="+t.seed+"&rstart="+t.rstart,async:!1,success:function(e){u.push(...e.data.videos),localStorage.setItem(config.project+"-videos",JSON.stringify(u)),t.currVideos=e.data.videos,d&&u.unshift(d)}});var h=localStorage.getItem(config.project+"-currentTime-"+a),p=parseInt(localStorage.getItem(config.project+"-currentIndex-"+a)),m=JSON.parse(localStorage.getItem(config.project+"-currentCaption-"+a)),f=m,g=0,v=0,w={subtitles:"",monitor:"",subtitlesList:[],current:m,currentIndex:p};t.en=w;Y=Y;var b=$("#video")[0];function x(){_(),j(),u[l+1]||$.ajax({url:"/mumu/explore-videos?",type:"get",data:"shortvideo=1&kw="+n+"&pageSize=5&tag="+s+"&seed="+t.seed+"&rstart="+(t.rstart+t.currVideos.length),async:!1,success:function(e){e.data.videos.length>0?(u.push(...e.data.videos),t.rstart=t.rstart+t.currVideos.length,t.currVideos=e.data.videos,localStorage.setItem(config.project+"-videos",JSON.stringify(u))):(t.seed=Math.ceil(100*Math.random()),$.ajax({url:"/mumu/explore-videos?",type:"get",data:"shortvideo=1&kw="+n+"&pageSize=5&tag="+s+"&seed="+t.seed+"&rstart=1",async:!0,success:function(e){t.currVideos=e.data.videos,u=[],l=-1,t.rstart=1,u.push(...e.data.videos),localStorage.setItem(config.project+"-videos",JSON.stringify(u)),x()}}))}}),u[l+1]&&(l++,a=u[l].no,o=u[l],localStorage.setItem(config.project+"-videosIndex",l),k(o),u[l+1]&&$("#video1").attr("poster",u[l+1].cover),u[l-1]&&$("#video2").attr("poster",u[l-1].cover))}function T(){_(),j(),u[l-1]?(l--,a=u[l].no,o=u[l],localStorage.setItem(config.project+"-videosIndex",l),k(o)):location.replace("./index.html")}function k(e){o=e,a=e.no,M=location.origin+"/mumu?videoNo="+a,wx.updateAppMessageShareData({title:o.name,desc:"幕幕 - 短视频练英语\n"+(o.chname||" "),link:M,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),wx.updateTimelineShareData({title:o.name+"\n幕幕 - 短视频练英语",link:M,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),$("#zh_subtitles").html(""),$("#titleinback").text(o.name),$("#titleinbackpad").show(),$("#video").attr("poster",o.cover),f=null,w.currentIndex=0,$.ajax({url:o.captionUrl,type:"get",async:!1,success:function(t){!function(t){w.subtitlesList=[];let e=[];e=t.split(/[(\r\n)\r\n]+/),e.forEach(((t,n)=>{if(t||e.splice(n,1),new RegExp(/^(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d/).test(t)){var s=e[n+2],i=e[n+1];if(s.indexOf("{\\pos")>=0||i.indexOf("{\\pos")>=0)return;w.subtitlesList.push({startTime:U(t.split(" --\x3e ")[0].replace(",",".")),endTime:U(t.split(" --\x3e ")[1].replace(",",".")),chValue:i,enValue:s})}}));for(let t=0;t<w.subtitlesList.length;t++){t;const e=w.subtitlesList[t],n=w.subtitlesList[t+1];t<w.subtitlesList.length-2&&n.startTime-e.endTime>1e3&&w.subtitlesList.splice(t+1,0,{startTime:parseInt(e.endTime)+1e3,endTime:n.startTime,chValue:"",enValue:""})}var n=w.subtitlesList[0];n&&n.startTime>0&&w.subtitlesList.splice(0,0,{startTime:0,endTime:n.startTime,chValue:"",enValue:""});var s=w.subtitlesList[w.subtitlesList.length-1];s&&w.subtitlesList.push({startTime:parseInt(s.endTime)+1e3,endTime:1e3*o.duration,chValue:"",enValue:""});w.currentIndex>=0?(w.current=w.subtitlesList[w.currentIndex],Y(w.current)):Y(w.subtitlesList[0])}(t)}}),clearTimeout(t.addHistoryTimeout),t.addHistoryTimeout=setTimeout((function(){var t=JSON.parse(localStorage.getItem(config.project+"-historyvideos"));t||(t=[]);for(var e=0;e<t.length;e++)t[e].no==o.no&&t.splice(e,1);t.unshift(o),localStorage.setItem(config.project+"-historyvideos",JSON.stringify(t))}),5e3),function(){if($("#video").attr("src",o.url),localStorage.getItem(config.project+"-translateed"))$("#video").css("top","0"),$("#video").attr("autoplay",!0),z();else{$("#hintssec").text(3),_(),$("#video").css("top","-1000px"),$("#hints").show(),setTimeout((function(){$("#hints").fadeOut(1e3,(function(){$("#video").css("top","0"),z()}))}),3e3);var t=setInterval((function(){var e=$("#hintssec").text()-1;e<1?clearInterval(t):$("#hintssec").text(e)}),1e3)}}()}function y(){g||h&&($("#video")[0].currentTime=h,$("#video")[0].currentTime>=h&&(g=1))}function I(){!function(){if(!v){if(0==h)return void(v=1);h&&($("#video")[0].currentTime=h,$("#video")[0].currentTime>=h&&(v=1))}}(),b.paused&&S(1e3*b.currentTime)}function S(e){if($("#loading").hide(),localStorage.setItem(config.project+"-durationsec-"+a,$("#video")[0].duration),localStorage.setItem(config.project+"-currentTime-"+a,$("#video")[0].currentTime),f){if(!(f.startTime<e))return;f=null}if(!(w.current&&w.current.startTime<=e&&e<w.current.endTime)){var n=w.subtitlesList[w.currentIndex+1];if(n&&n.startTime<=e&&e<n.endTime)return t.diandu&&_(),i?void D():(w.current=n,w.currentIndex++,void Y(n));n&&e<n.startTime&&(!w.current||e>w.current.endTime)||$(w.subtitlesList).each((function(t,n){if(n.startTime<=e&&e<n.endTime){debugger;return w.current=n,w.currentIndex=t,void Y(n)}}))}}function Y(t){if(!t)return;localStorage.setItem(config.project+"-currentCaption-"+a,JSON.stringify(t)),localStorage.setItem(config.project+"-currentIndex-"+a,w.currentIndex);let e=t.enValue.split(" ");$("#zh_subtitles").html(""),w.currentwords=e;for(let t=0;t<e.length;t++)if("\\n"!=e[t]){var n=e[t].split("\\n");if(n[0]){var s=$('<span style="border-bottom:2px solid #ffffff;;user-select: none;display: inline-block;cursor: pointer;font-weight: 900;font-size: 18px;padding-left:3px;padding-right:3px;box-size:bo" index="'+t+'" class="font span'+t+'">'+n[0]+"</span>");s.bind("mouseout",(function(){isPc()&&$(this).css("border-bottom","2px solid #ffffff")})).bind("mouseover",(function(){isPc()&&$(this).css("border-bottom","2px solid black")})),$("#zh_subtitles").append(s)}n[1]&&e.splice(t+1,0,"\\n",n[1]),n[2]&&e.splice(t+3,0,"\\n",n[2]),n[3]&&e.splice(t+5,0,"\\n",n[3])}else $("#zh_subtitles").append("<br/>");$("#chDialog").html(t.chValue.replace(/\\n/g,"<br/>")),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),W=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),$("#summtrans").hide(),$("#wordsframe").hide(),$("#word-in").val(""),$("#video").css("top","0px")}function X(){if(w.currentIndex>0){var t=w.currentIndex,e=w.subtitlesList[--t];e&&(e.enValue||(e=w.subtitlesList[--t]),e&&(w.currentIndex=t,w.current=e,f=e,h=e.startTime/1e3,$("#video")[0].currentTime=e.startTime/1e3,log.debug("set st: "+e.startTime/1e3+" ct: "+$("#video")[0].currentTime+" - "+w.current.enValue.substr(0,10)),Y(e),W=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}}function F(){i?(i=0,$("#loopLine").css("background-color","#ffffff")):(i=1,$("#loopLine").css("background-color","#ffcc79"))}function j(){i=0,$("#loopLine").css("background-color","#ffffff")}function D(){var t=w.currentIndex,e=w.current;e&&(e.enValue||(e=w.subtitlesList[--t]),e&&(w.currentIndex=t,w.current=e,$("#video")[0].currentTime=e.startTime/1e3,f=e,h=e.startTime/1e3,Y(e),W=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}function N(){var t=w.currentIndex,e=w.subtitlesList[++t];e&&(e.enValue||(e=w.subtitlesList[++t]),e&&(w.currentIndex=t,w.current=e,f=e,h=e.startTime/1e3,$("#video")[0].currentTime=e.startTime/1e3,Y(e),W=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}function L(t){return t?t.replace(/^(\s|:|-|,|\.|\?|!|\[|\]\(|\))+/,"").replace(/(\s|:|-|,|\.|\?|!|\[|\]\(|\))+$/,"").toLowerCase():""}function V(e){$("#summrest").hide(),t.dovideoshadow=1,_(),P(),e=L(e),$("#summtrans").show(),$("#summtrans-word").text(e),$("#word-in").val(e),clearTimeout(window.timeoutdo1),window.timeoutdo1=setTimeout((function(){if($("#favor").attr("word",e),window.aaa=setTimeout((function(){$("#summtrans-phonetic").hide(),$("#summtrans-speak").hide(),$("#summtrans-value").hide()}),500),null==e||null==e||!e.toString().trim())return $("#summtrans-phonetic").hide(),$("#summtrans-speak").hide(),void $("#summtrans-value").hide();for(const e of t.translateajaxs)e.abort();t.translateajaxs.push($.ajax({url:"/mumu/translate?from="+o.language+"&to=2&q="+e,type:"get",ajaxCache:{timeout:2592e3},async:!0,success:function(t){var e=!1;clearTimeout(window.aaa),t.data.phonetic?$("#summtrans-phonetic").text("/"+t.data.phonetic+"/").show():$("#summtrans-phonetic").hide(),t.data.speakUrl?$("#summtrans-speak").attr("play-url",t.data.speakUrl).show():$("#summtrans-speak").hide(),$("#summtrans-vv").html("").scrollTop(0),t.data.explains&&$(t.data.explains).each((function(t,n){e=!0,$("#summtrans-vv").append(`<div>${B(n)}</div>`)})),t.data.wfs&&$("#summtrans-vv").append(`<div style="margin-top:10px">${B(t.data.wfs)}</div>`),t.data.webs&&($("#summtrans-vv").append('<div style="margin-top:10px;">网络释义: </div>'),$(t.data.webs).each((function(t,n){e=!0,$("#summtrans-vv").append(`<div>${B(n)}</div>`)}))),!e&&t.data.translations&&$(t.data.translations).each((function(t,e){$("#summtrans-vv").append(`<div>${B(e)}</div>`)})),$(".lightkeytrans").bind("click",(function(){V(this.innerText)})),$("#wordsframe").hide(),$("#summrest").show(),$("#summtrans-vv").show(),$("#summtrans-value").show(),$("#summtrans").show(),$("#video").css("top","-1000px");var n=localStorage.getItem(config.project+"-totaltranslatesno");n=n||0,n++,localStorage.setItem(config.project+"-totaltranslatesno",n),$("#summtrans-speak").click();var s=localStorage.getItem(config.project+"-translateed");(s=parseInt(s?++s:1))>=4&&(H.send(JSON.stringify({action:3,words:3})),s=1),localStorage.setItem(config.project+"-translateed",s)}}))}),200)}function _(){$("#video")[0].pause()}function z(){$("#video")[0].play(),clearTimeout(window.timeoutdo1)}function O(){clearInterval(w.monitor),$(".stopFn").css({display:"none"}),$(".startFn").css({display:"inline"}),$("#video")[0].currentTime==$("#video")[0].duration&&setTimeout((function(){x()}),1e3),P()}function P(){if(t.dovideoshadow&&$("#videoshasow").is(":hidden")){var e=videocapture($("#video")[0]);$("#videoshasowimg").attr("src",e.src),e.src||$("#videoshasowimg").css("background-color","#000000"),$("#videoshasow").show(),$("#video").css("top","-1000px")}}function U(t){let e=t.split(":"),n=0;return e.forEach(((t,e)=>{switch(e){case 0:n+=60*parseFloat(t)*60*1e3;break;case 1:n+=60*parseFloat(t)*1e3;break;case 2:n+=1e3*parseFloat(t);break}})),n}m&&Y(m),$("#historyword_template").bind("click",(function(e){log.info("$(#historyword_template).click "+$(this).attr("data")),t.dovideoshadow=1,_(),G(this.innerText),V(this.innerText),$(".historyword").css("background-color","#ffffff"),$(this).css("background-color","#e7e7e7")})),x(),function(){var t=localStorage.getItem(config.project+"-historywords");t&&(r=JSON.parse(t));for(let t=0;t<r.length;t++){var e=r[t],n=$("#historyword_template").clone(!0);n.attr("id","historyword-"+e.replace(/[^\w]/g,"")),n.attr("data",e),n.text(e),n.css("display","inline-block"),n.show(),$("#historywordspad").append(n)}}(),$(".yibiao").on("click","span svg",(function(){log.info("$(.yibiao).click"),new Audio($(this).attr("playsrc")).play()})),$("#loopLine").click(F),$("#favor").click((function(){log.info("#favor.click");var t=$(this).attr("word");/.*[\u4e00-\u9fa5]+.*$/.test(t)||$(this).attr("word").split(" ").length>3||(function(t){var e=r.indexOf(t);e>-1&&r.splice(e,1);$("#historyword-"+t.replace(/[^\w]/g,"")).remove()}(t),function(t){t=L(t);var e=(r=r||[]).indexOf(t);e>-1&&r.splice(e,1);r.unshift(t);var n=$("#historyword_template").clone(!0);n.attr("id","historyword-"+t.replace(/[^\w]/g,"")),n.attr("data",t),n.text(t),n.css("display","inline-block"),$("#historywordspad").prepend(n),localStorage.setItem(config.project+"-historywords",JSON.stringify(r))}(t))})),t.dovideoshadow=0;var E,W=0,C=[];function J(e){(W=e,$(".font").css({background:"transparent"}),$(".font.span"+(W-1)).css({background:"#d2cbcb"}),t.dovideoshadow=1,_(),$("#summtrans-word").show(),W>0)&&($("#wordsframe").hide(),V(w.currentwords[W-1]))}function R(){document.activeElement==$("#word-in")[0]?($("#wordsframe").hide(),G($("#word-in").val()),V($("#word-in").val()),$("#word-in").val()||($("#summtrans").hide(),$("#wordsframe").hide(),$("#video").css("top",0))):($("#words .word").remove(),$("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").focus(),$("#word-in").trigger("input"),t.dovideoshadow=1,_())}if(document.onkeydown=function(e){var n=e||window.e,s=n.keyCode||n.which,i=(C=[]).pop();switch(null!=i&&null!=i&&C.push(i),s!=i&&C.push(s),C.join()){case"27":$("#summtrans").hide(),$("#summtrans-word").text(""),$("#summtrans-phonetic").text("").hide(),$("#summtrans-speak").attr("play-url","").hide(),$("#summtrans-value").hide(),$("#summtrans-vv").text(""),$("#wordsframe").hide(),$("#word-in").val(""),$("#words .word").remove(),$("#video").css("top",0);break;case"32":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;$("#video")[0].paused?(z(),t.manual=1):(t.manual=2,_());break;case"13":"INPUT"!=document.activeElement.tagName&&R();break;case"97":case"65":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;X();break;case"115":case"83":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;F();break;case"119":case"87":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;A();break;case"100":case"68":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;N();break;case"113":case"81":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;W<=1?W=w.currentwords.length:W--,J(W);break;case"101":case"69":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;++W>w.currentwords.length&&(W=1),J(W);break}},document.onkeyup=function(t){C.pop()},document.onfocus=function(){C=[]},window.onbeforeunload=function(){navigator.sendBeacon("/mumu/page-out"),log.flush()},document.addEventListener("touchend",(function(t){var e=(new Date).getTime();e-E<=300&&t.preventDefault(),E=e}),!1),$(document.body).bind("resize",(function(){})),is_weixn()){$.get("/mumu/wxjsapiticket",(t=>{$.get("/mumu/wxsign",{ticket:t.data.ticket,url:location.href},(t=>{wx.config({debug:!1,appId:t.data.appid,timestamp:t.data.timestamp,nonceStr:t.data.nonceStr,signature:t.data.signature,jsApiList:["updateAppMessageShareData","updateTimelineShareData"]})}))}));var M=location.origin+"/mumu/index.html?videoNo="+a;wx.ready((function(){wx.updateAppMessageShareData({title:o.name,desc:"幕幕 - 短视频练英语\n"+(o.chname||" "),link:M,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),wx.updateTimelineShareData({title:o.name+"\n幕幕 - 短视频练英语",link:M,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}})}))}function B(t){if(!t)return t;var e=t.match(/(\w*)\s*?(的过去|的现在|的复数|的第三|的ing)/);return e?t=t.replace(e[1],`<span class="lightkeytrans" style="text-decoration: underline;cursor:pointer;margin:0 5px;color: bisque;">${e[1]}</span>`):t}function A(){$("#chDialog").is(":hidden")?($("#chDialog").show(),$("#wholebtnlash").hide()):($("#chDialog").hide(),$("#wholebtnlash").show())}$("#video").bind("play",(function(){!function(){t.ajaxtranslate&&t.ajaxtranslate.abort();for(const e of t.translateajaxs)e.abort();$(".historyword").css("background-color","#ffffff"),t.dovideoshadow=0,$(".dialog").hide(),$("#summtrans").hide(),$("#summtrans-word").text(""),$("#wordsframe").hide(),$("#word-in").val(""),$("#summtrans-value").hide(),$("#summtrans-vv").text(""),$("#summtrans-phonetic").text("").hide(""),$("#summtrans-speak").attr("play-src","").hide(""),$("#video").css("top","0px"),clearInterval(w.monitor),w.monitor=setInterval((function(){S(1e3*b.currentTime)}),10),W=0,"",$("#zh_subtitles span").css({background:"transparent",color:"black"}),$(".startFn").css({display:"none"}),$(".stopFn").css({display:"inline"}),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),$(".searchClass").val(""),$(".yibiao").html(""),$(".fanyi").html(""),$("#videoshasow").hide()}()})).bind("pause",(function(){O()})).bind("mouseover",(function(){})).bind("mouseout",(function(){})).bind("canplay",(function(){y()})).bind("durationchange",(function(){})).bind("loadeddata",(function(){})).bind("loadstart",(function(){})).bind("playing",(function(){})).bind("progress",(function(){})).bind("readystatechange",(function(){})).bind("suspend",(function(){})).bind("timeupdate",(function(){I()})).bind("waiting",(function(){})).bind("click",(function(){})).bind("loadedmetadata",(function(){})).bind("touchend",(function(){})).bind("focus",(function(){})).bind("blur",(function(){})),$("#summtrans-word").bind("click",(function(){log.info("#summtrans-word.click"),$("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").val(this.innerText).focus(),$("#word-in").trigger("input")})),$("#summtrans-speak").bind("click",(function(){log.info("#summtrans-speak.click"),this.audio||(this.audio=new Audio),this.audio.src=$(this).attr("play-url"),this.audio.play()})),$("#wordtempl").bind("click",(function(){log.info("#wordtempl.click"),$("#wordsframe").hide(),$("#word-in").val(""),$("#words .word").remove(),G(this.item.word),V(this.item.word)})),$("#word-in").bind("input",(function(){log.info("#word-in.input");var e=$("#word-in")[0],n=$("#word-in")[0].value;""==n?$("#wordsframe_cancel").show():$("#wordsframe_cancel").hide(),clearTimeout(t.ssssaaa),t.ssssaaa=setTimeout((function(){$("#words .word").remove()}),1e3),n?$.ajax({url:"/mumu/words1",method:"get",data:{kw:n,rstart:1,rcount:10,from:o.language,to:2},ajaxCache:{timeout:2592e3},success:function(s){if(e.value==n){clearTimeout(t.ssssaaa),$("#words .word").remove();var i=s.data.words;$(i).each(((t,e)=>{var n=$("#wordtempl").clone(!0);n[0].item=e,n.attr("id","word"+e.id),n.addClass("word"),n.html(e.word+"&nbsp;&nbsp;"+(e.phonetic?"/"+e.phonetic+"/":"")+"&nbsp;&nbsp;"+(e.explain||"")),$("#words").append(n),n.show()}))}}}):$("#words .word").remove()})),$("#startFn,#startFn1").bind("mousedown",(function(){isMobile()||(log.info("#startFn.mousedown"),t.startt=new Date,clearTimeout(t.dddd),t.dddd=setTimeout((function(){t.diandu?(t.diandu=0,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(191, 187, 187)")):(t.diandu=1,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(255 0 0)"))}),1e3))})).bind("mouseup",(function(){isMobile()||(log.info("#startFn.mouseup"),t.manual=1,clearTimeout(t.dddd),t.startt&&(t.endt=new Date,t.endt.getTime()-t.startt.getTime()<1e3&&z()))})).bind("touchstart",(function(){log.info("#startFn.touchstart"),t.startt=new Date,clearTimeout(t.dddd),t.dddd=setTimeout((function(){t.diandu?(t.diandu=0,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(191, 187, 187)")):(t.diandu=1,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(255 0 0)"))}),1e3)})).bind("touchend",(function(){(log.info("#startFn.touchend"),clearTimeout(t.dddd),t.manual=1,t.startt)&&(t.endt=new Date,t.endt.getTime()-t.startt.getTime()<1e3&&z())})),$("#stopFn,#stopFn1").bind("mousedown",(function(){isMobile()||(log.info("#stopFn.mousedown"),t.startt=new Date,clearTimeout(t.dddd),t.dddd=setTimeout((function(){t.diandu?(t.diandu=0,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(191, 187, 187)")):(t.diandu=1,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(255 0 0)"))}),1e3))})).bind("mouseup",(function(){isMobile()||(log.info("#stopFn.mouseup"),t.manual=2,clearTimeout(t.dddd),t.startt&&(t.endt=new Date,t.endt.getTime()-t.startt.getTime()<1e3&&_()))})).bind("touchstart",(function(){log.info("#stopFn.touchstart"),t.startt=new Date,clearTimeout(t.dddd),t.dddd=setTimeout((function(){t.diandu?(t.diandu=0,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(191, 187, 187)")):(t.diandu=1,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(255 0 0)"))}),1e3)})).bind("touchend",(function(){(log.info("#stopFn.touchend"),clearTimeout(t.dddd),t.manual=2,t.startt)&&(t.endt=new Date,t.endt.getTime()-t.startt.getTime()<1e3&&_())})),$("#prevline").bind("click",(function(){log.info("#prevline.click"),X()})),$("#currline").bind("click",(function(){log.info("#nextline.click"),D()})),$("#nextline").bind("click",(function(){log.info("#nextline.click"),N()})),$("#gear").bind("touchstart",(function(t){log.info("#gear.touchstart");var e=t.targetTouches[0];this.startX=e.pageX,this.startY=e.pageY})).bind("touchmove",(function(e){if(this.startX&&this.startY){var n=e.targetTouches[0];this.endX=n.pageX,this.endY=n.pageY;var s=this.endX-this.startX;this.endY,this.startY;null!=this.lastDist&&null!=this.lastDist||(this.lastDist=s);var i=s-this.lastDist;this.lastDist=s;var o=parseInt(this.style.left.replace("px"))+i;o<=0&&o>=-4900&&(this.style.left=o+"px"),this.xx||(this.xx=0),this.xx=this.xx+i;var a=null;this.xx>30?(a=W,a++):this.xx<-30&&(a=W,a--),w.current&&w.current.enValue&&null!=a&&(a<1&&(a=w.currentwords.length),a>w.currentwords.length&&(a=1),t.dovideoshadow=1,_(),J(a),this.xx=0),e.preventDefault()}})).bind("touchend",(function(t){log.info("#gear.touchend"),this.startX=null,this.startY=null,this.endX=null,this.endY=null,this.lastDist=null,this.xx=0})),$("#gear").bind("mousedown",(function(t){log.info("#gear.mousedown"),this.startX=t.pageX,this.startY=t.pageY})).bind("mousemove",(function(e){if(this.startX&&this.startY){this.endX=e.pageX,this.endY=e.pageY;var n=this.endX-this.startX;this.endY,this.startY;null!=this.lastDist&&null!=this.lastDist||(this.lastDist=n);var s=n-this.lastDist;this.lastDist=n;var i=parseInt(this.style.left.replace("px"))+s;i<=0&&i>=-4900&&(this.style.left=i+"px"),this.xx||(this.xx=0),this.xx=this.xx+s;var o=null;this.xx>30?(o=W,o++):this.xx<-30&&(o=W,o--),w.current&&w.current.enValue&&null!=o&&(o<1&&(o=w.currentwords.length),o>w.currentwords.length&&(o=1),t.dovideoshadow=1,_(),J(o),this.xx=0)}})).bind("mouseup",(function(t){log.info("#gear.mouseup"),this.startX=null,this.startY=null,this.endX=null,this.endY=null,this.lastDist=null,this.xx=0})),$("#replay").bind("click",(function(t){log.info("#replay.click"),$("#video")[0].load()})),$("#hideBtn").bind("click",(function(t){log.info("#hideBtn.click"),$("#zh_subtitles").css("opacity"),1==$("#zh_subtitles").css("opacity")?($("#zh_subtitles").css("opacity",0),$("#chDialog").hide(),$("#hideBtn").css("background-color","rgb(230, 230, 230)")):($("#chDialog").show(),$("#zh_subtitles").css("opacity",1),$("#hideBtn").css("background-color","#ffffff"))})),$("#wholebtn").bind("click",(function(t){log.info("#wholebtn.click"),A()})),$("#searchbtn").bind("click",(function(t){log.info("#searchbtn.click"),R()})),document.body.addEventListener("click",(function(){})),$("#goPrevVideo").click((function(){log.info("#goPrevVideo.click"),T()})),$("#goNextVideo").click((function(){log.info("#goNextVideo.click"),x()})),$("#word-in").bind("blur",(function(){""==this.value&&setTimeout((function(){$("#wordsframe").hide(),$("#video").css("top",0),t.manual&&(1==t.manual?z():2==t.manual&&_())}),100)})),$("#word-in").bind("focus",(function(){this.select(),""==this.value?$("#wordsframe_cancel").show():$("#wordsframe_cancel").hide()})),$("#searchclear").click((function(){n="",s="",$("#searchtext").text("搜索").css("color","#bfbbbb"),$("#searchpad").slideUp(100),$.ajax({url:"/mumu/explore-videos?",type:"get",data:"shortvideo=1&kw="+n+"&pageSize=5&tag="+s+"&seed="+t.seed+"&rstart=1",async:!0,success:function(e){t.currVideos=e.data.videos,u=[],l=-1,t.rstart=1,u.push(...e.data.videos),localStorage.setItem(config.project+"-videos",JSON.stringify(u)),x()}})})),$(".searchtag").click((function(){s=this.innerText,$("#searchtext").text("#"+this.innerText+"#").css("color","#6f6f6f"),$("#searchpad").slideUp(100),$.ajax({url:"/mumu/explore-videos?",type:"get",data:"shortvideo=1&kw="+n+"&pageSize=5&tag="+s+"&seed="+t.seed+"&rstart=1",async:!0,success:function(e){u=[],l=-1,t.currVideos=e.data.videos,t.rstart=1,u.push(...e.data.videos),localStorage.setItem(config.project+"-videos",JSON.stringify(u)),x()}})})),$("#searchpadbtn").click((function(){$("#searchpad").css("height",$(window).height()-($("#video").height()+64+10)+"px"),$("#searchpad").slideDown(100)})),$("#searchpad").bind("touchstart",(function(t){var e=t.targetTouches[0];this.touchstart=e.pageY})).bind("touchmove",(function(t){var e=t.targetTouches[0];this.touchend=e.pageY,0==$(this).scrollTop()&&this.touchstart<this.touchend&&t.preventDefault()})).bind("touchend",(function(t){this.touchend-this.touchstart>50&&$("#searchpad").slideUp(100),this.touchstart=null,this.touchend=null})),$("#searchpad").bind("mousedown",(function(t){this.touchstart=t.pageY})).bind("mousemove",(function(t){this.touchend=t.pageY,0==$(this).scrollTop()&&this.touchstart<this.touchend&&t.preventDefault()})).bind("mouseup",(function(t){this.touchend-this.touchstart>50&&$("#searchpad").slideUp(100),this.touchstart=null,this.touchend=null})),$("#loopVideoBtn").click((function(){$("#video").attr("loop")?($("#video").attr("loop",!1),$(this).css("background-color","#ffffff")):($("#video").attr("loop","loop"),$(this).css("background-color","#e6e6e6"))})),$("#unloopVideoBtn").click((function(){$("#video").attr("loop",!1),$("#loopVideoBtn").show(),$("#unloopVideoBtn").hide()})),$("#chatminpad").click((function(){t.preChatPaused=$("#video")[0].paused,$("#chatpad").css("height",$(window).height()-($("#video").height()+64+$("#controlpad").height()+20)+"px"),$("#gearframe1").hide(),$("#prevnextpad").hide(),$("#chatpad").slideDown(100,(function(){}))})),$("#chatroombtn").click((function(){$("#chatroompad").show(),$("#chatprivatepad").hide(),$(this).css("background-color","#d7d7d7"),$("#chatprivatebtn").css("background-color","#737373")})),$("#chatprivatebtn").click((function(){$("#chatroompad").hide(),$("#chatprivatepad").show(),$(this).css("background-color","#d7d7d7"),$("#chatroombtn").css("background-color","#737373")})),$("#index").bind("click",(function(t){$(t.target).hasClass("translatable")&&V(t.target.innerHTML)})),t.spans=[],t.spansIs=0,t.firstRangeWordInx=0,t.lastRangeWordInx=0,$("#zh_subtitles").bind("mousedown touchstart",(function(e){log.info("#zh_subtitles."+e.type);var n=null;if(n="touchmove"==e.type?document.elementFromPoint(e.targetTouches[0].pageX,e.targetTouches[0].pageY):e.target,$(n).hasClass("font")){t.firstRangeWordInx=0,t.lastRangeWordInx=0,_();var s=parseInt($(n).attr("index"));W=s+1,t.spansIs=1,t.spans=[],t.firstRangeWordInx=s,t.lastRangeWordInx=s,$("#zh_subtitles .font").css("background-color","#ffffff"),$("#zh_subtitles .font.span"+s).css("background-color","rgb(210, 203, 203)")}})).bind("mousemove touchmove",(function(e){var n=null;if(n="touchmove"==e.type?document.elementFromPoint(e.targetTouches[0].pageX,e.targetTouches[0].pageY):e.target,$(n).hasClass("font")){if(!t.spansIs)return;$("#zh_subtitles .font").css("background-color","#ffffff");var s=parseInt($(n).attr("index"));t.spans[t.spans.length-1]!=s&&t.spans.push(s);var i=t.spans[0],o=t.spans[t.spans.length-1];if(i>o){var a=i;i=o,o=a}t.firstRangeWordInx=i,t.lastRangeWordInx=o;for(var r=i;r<=o;r++)$("#zh_subtitles .font.span"+r).css("background-color","rgb(210, 203, 203)")}e.preventDefault()})).bind("mouseup touchend",(function(e){log.info("#zh_subtitles."+e.type);var n=null;if(n="touchmove"==e.type?document.elementFromPoint(e.targetTouches[0].pageX,e.targetTouches[0].pageY):e.target,$(n).hasClass("font")&&t.spansIs){for(var s=t.firstRangeWordInx,i=t.lastRangeWordInx,o="",a=s;a<=i;a++)o+=$("#zh_subtitles .font.span"+a).text()+" ";o=o.substr(0,o.length-1),t.dovideoshadow=1,_(),G(o),V(o),t.spansIs=0,t.spans=[]}})),$("#index").bind("touchstart",(function(t){if(this.startTime=(new Date).getTime(),!($(t.target).parents(".scrollable").length>0||$(t.target).parents("#gearframe1,#zh_subtitles,#prevnextpad,#chatpad").length>0)){var e=t.targetTouches[0];this.indextouchstartX=e.pageX,this.indextouchstartY=e.pageY}})).bind("touchmove",(function(t){if(!($(t.target).parents(".scrollable").length>0||$(t.target).parents("#gearframe1,#zh_subtitles,#prevnextpad,#chatpad").length>0)){var e=t.targetTouches[0];this.indextouchstartX&&this.indextouchstartY&&this.indextouchendX&&this.indextouchendY&&($("#video1").css("left",parseInt($("#video1").css("left").replace("px",""))+e.pageX-this.indextouchendX+"px"),$("#video2").css("left",parseInt($("#video2").css("left").replace("px",""))+e.pageX-this.indextouchendX+"px")),this.indextouchendX=e.pageX,this.indextouchendY=e.pageY,0==$(t.target).scrollTop()&&this.indextouchstartY<this.indextouchendY&&t.preventDefault()}})).bind("touchend",(function(t){this.endTime=(new Date).getTime(),$(t.target).parents(".scrollable").length>0||$(t.target).parents("#gearframe1,#zh_subtitles,#prevnextpad,#chatpad").length>0||(log.debug(this.endTime-this.startTime),$("#video1").css("left","100%"),$("#video2").css("left","-100%"),this.endTime-this.startTime<500&&this.indextouchstartX&&this.indextouchstartY&&this.indextouchendX&&this.indextouchendY&&(this.indextouchstartX-this.indextouchendX>100?x():this.indextouchstartX-this.indextouchendX<-100&&T()),this.indextouchstartX=null,this.indextouchstartY=null,this.indextouchendX=null,this.indextouchendY=null)})),$("#index").bind("mousedown",(function(t){this.startTime=(new Date).getTime(),$(t.target).parents(".scrollable").length>0||$(t.target).parents("#gearframe1,#zh_subtitles,#prevnextpad,#chatpad").length>0||(this.indextouchstartX=t.pageX,this.indextouchstartY=t.pageY)})).bind("mousemove",(function(t){$(t.target).parents(".scrollable").length>0||$(t.target).parents("#gearframe1,#zh_subtitles,#prevnextpad,#chatpad").length>0||(this.indextouchstartX&&this.indextouchstartY&&this.indextouchendX&&this.indextouchendY&&($("#video1").css("left",parseInt($("#video1").css("left").replace("px",""))+t.pageX-this.indextouchendX+"px"),$("#video2").css("left",parseInt($("#video2").css("left").replace("px",""))+t.pageX-this.indextouchendX+"px")),this.indextouchendX=t.pageX,this.indextouchendY=t.pageY,0==$(t.target).scrollTop()&&this.indextouchstartY<this.indextouchendY&&t.preventDefault())})).bind("mouseup",(function(t){this.endTime=(new Date).getTime(),$(t.target).parents(".scrollable").length>0||$(t.target).parents("#gearframe1,#zh_subtitles,#prevnextpad,#chatpad").length>0||($("#video1").css("left","100%"),$("#video2").css("left","-100%"),this.endTime-this.startTime<500&&this.indextouchstartX&&this.indextouchstartY&&this.indextouchendX&&this.indextouchendY&&(this.indextouchstartX-this.indextouchendX>100?x():this.indextouchstartX-this.indextouchendX<-100&&T()),this.indextouchstartX=null,this.indextouchstartY=null,this.indextouchendX=null,this.indextouchendY=null)})),$("#chatprivatebtn,#chatroombtn,#chatprivatepad,#chatinput").bind("touchstart",(function(t){var e=t.targetTouches[0];this.touchstart=e.pageY})).bind("touchmove",(function(t){var e=t.targetTouches[0];this.touchend=e.pageY,0==$(this).scrollTop()&&this.touchstart<this.touchend&&t.preventDefault()})).bind("touchend",(function(t){this.touchend-this.touchstart>50&&($("#gearframe1").show(),$("#prevnextpad").show(),$("#chatpad").slideUp(100,(function(){}))),this.touchstart=null,this.touchend=null})),$("#chatprivatebtn,#chatroombtn,#chatprivatepad,#chatinput").bind("mousedown",(function(t){this.mousedown=t.pageY})).bind("mousemove",(function(t){this.mouseup=t.pageY,0==$(this).scrollTop()&&this.mousedown<this.mouseup&&t.preventDefault()})).bind("mouseup",(function(t){this.mouseup=t.pageY,this.mouseup-this.mousedown>50&&($("#gearframe1").show(),$("#prevnextpad").show(),$("#chatpad").slideUp(100,(function(){}))),this.mousedown=null,this.mouseup=null})),$("#chatmsgspad").bind("touchstart",(function(t){var e=t.targetTouches[0];this.touchstart=e.pageY})).bind("touchmove",(function(t){var e=t.targetTouches[0];this.touchend=e.pageY,0==$("#chatmsgspad").scrollTop()&&this.touchstart<this.touchend&&t.preventDefault()})).bind("touchend",(function(t){this.touchend-this.touchstart>50&&0==$("#chatmsgspad").scrollTop()&&($("#gearframe1").show(),$("#prevnextpad").show(),$("#chatpad").slideUp(100,(function(){}))),this.touchstart=null,this.touchend=null})),$("#chatmsgspad").bind("mousedown",(function(t){this.mousedown=t.pageY})).bind("mousemove",(function(t){this.mouseup=t.pageY,0==$("#chatmsgspad").scrollTop()&&this.mousedown<this.mouseup&&t.preventDefault()})).bind("mouseup",(function(t){this.mouseup=t.pageY,this.mouseup-this.mousedown>50&&0==$("#chatmsgspad").scrollTop()&&($("#gearframe1").show(),$("#prevnextpad").show(),$("#chatpad").slideUp(100,(function(){}))),this.mousedown=null,this.mouseup=null})),$("#word-in").keydown((function(){13==(window.event||e).keyCode&&R()})),$("#chatinput").keydown((function(){if(13==(window.event||e).keyCode){if(""==this.value)return;var t={text:this.value,action:1,looking:o.name};H.send(JSON.stringify(t)),this.value=""}}));var H=null;function q(){(H=new WebSocket(`wss://${location.host}/mumu/websocket/${pagePre.login.userNo}`)).onopen=function(){t.ws=H},H.onmessage=function(t){var e=JSON.parse(t.data);if(1==e.action){null!=e.nickname&&(e.nickname=e.nickname.substr(0,1)+"..."+e.nickname.substr(3));var n=$("#chatmsgtemple").clone(!0);n.attr("id","chatmsg"+e.msgNo),e.userNo==$.cookie("token")&&n.css("color","green"),n.find(".name").text(e.nickname||"网友"),n.find(".msg").text(e.text),n.find(".looking").text(e.looking),n.show(),$("#chatmsgspad").prepend(n),$("#lastmsg").text((e.nickname||"网友").substr(0,6)+" : "+e.text)}},H.onclose=function(t){},H.onerror=function(t){}}function G(e){e=L(e),clearTimeout(t.sssss),t.sssss=setTimeout((function(){$("#relatedWordsPad .relatedWord").remove(),$("#fromRelatedWord").text(e),$.ajax({url:"/mumu/related-words",method:"get",data:{kw:e,rstart:1,rcount:50,from:o.language,to:2},ajaxCache:{timeout:2592e3},success:function(t){t.data.words&&$(t.data.words).each(((t,e)=>{var n=$("#relatedWord0").clone(!0);n[0].data=e,n.attr("id","relatedWord"+e.id),n.addClass("relatedWord"),n.text(e.word),$("#relatedWord0").before(n),n.show()}))}})}),100)}q(),setInterval((()=>{if(H&&3==H.readyState&&q(),!$("#video")[0].paused){var t=localStorage.getItem(config.project+"-totalsecondsno");t=parseInt(t||0),t+=5,localStorage.setItem(config.project+"-totalsecondsno",t),H.send(JSON.stringify({action:2,videoNo:a,seconds:5}))}}),5e3),setInterval((function(){H&&1==H.readyState&&H.send("0")}),3e4),statisticsexps(),$("#relatedWord0").click((function(){V(this.innerText)})),$("#fromRelatedWordPad").click((function(){V($("#fromRelatedWord").text())})),$.ajax({url:"/mumu/chatroom-msgs?",type:"get",data:"rcount=300",async:!0,success:function(t){$(t.data.rows).each(((t,e)=>{null!=e.nickname&&(e.nickname=e.nickname.substr(0,1)+"..."+e.nickname.substr(3)),0==t&&($("#lastmsg").text((e.nickname||"网友").substr(0,6)+" : "+e.text),$("#chatminpad").show());var n=$("#chatmsgtemple").clone(!0);n.attr("id","chatmsg"+e.msgNo),e.userNo==$.cookie("token")&&n.css("color","green"),n.find(".name").text(e.nickname||"网友"),n.find(".msg").text(e.text),n.find(".looking").text(e.looking),n.show(),$("#chatmsgspad").append(n)})),0==t.data.rows.length&&($("#lastmsg").text("聊天室"),$("#chatminpad").show())}})}();