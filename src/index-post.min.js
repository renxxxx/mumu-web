!function(){var o={manual:1};window.page=o,o.translateajaxs=[],o.seed=Math.ceil(100*Math.random()),o.rstart=1,o.currVideos=[];var t="",s="";o.favoredWords={rows:[],rstart:1,rcount:50,currRows:[]},o.historyWords={rows:[],rstart:1,rcount:50,currRows:[]},o.wordbooks={rows:[],rstart:1,rcount:50,currRows:[],selected:null},o.wordbooksOnAdd={rows:[],rcount:50,currRows:[],selected:null},o.currWord=null,o.wordBooksWordsMap={},pagePre.loginTime&&(new Date).getTime()-pagePre.loginTime>864e5&&$.ajax({url:"/mumu/login-refresh",async:!0,success:function(o){0==o.code&&(pagePre.login=o.data,localStorage.setItem(config.project+"-login",JSON.stringify(pagePre.login)),localStorage.setItem(config.project+"-loginTime",(new Date).getTime()))}}),setTimeout((function(){$("#logo").hide(),$("#index").show(),$("#finger").animate({left:"+=150px"},2e3,(function(){$("#finger").animate({left:"-=300px"},2e3,(()=>{$("#finger").fadeOut(500)}))})),$("#gear").animate({left:"+=150px"},2e3,(function(){$("#gear").animate({left:"-=300px"},2e3)}))}),1e3);var n=0;$("#video")[0].crossOrigin="anonymous",document.addEventListener("WeixinJSBridgeReady",(function(){$("#video")[0].play()}),!1);var r,a,i=window.location.search.substring(1).split("&")[0].split("=")[1],d=null,c=[],u=-1;i&&$.ajax({url:"/mumu/video?",ajaxCache:!0,data:"videoNo="+i,async:!1,success:function(o){r=d=o.data.video}}),$.ajax({url:"/mumu/explore-videos?",data:"shortvideo=1&kw="+t+"&pageSize=5&tag="+s+"&seed="+o.seed+"&rstart="+o.rstart,async:!1,success:function(t){c.push(...t.data.videos),localStorage.setItem(config.project+"-videos",JSON.stringify(c)),o.currVideos=t.data.videos,d&&c.unshift(d)}});var l=localStorage.getItem(config.project+"-currentTime-"+a),h=parseInt(localStorage.getItem(config.project+"-currentIndex-"+a)),m=JSON.parse(localStorage.getItem(config.project+"-currentCaption-"+a)),f=m,w=0,p=0,g={subtitles:"",monitor:"",subtitlesList:[],current:m,currentIndex:h};o.en=g;W=W;var v=$("#video")[0];function b(){F(),Y(),c[u+1]||$.ajax({url:"/mumu/explore-videos?",data:"shortvideo=1&kw="+t+"&pageSize=5&tag="+s+"&seed="+o.seed+"&rstart="+(o.rstart+o.currVideos.length),async:!1,success:function(e){e.data.videos.length>0?(c.push(...e.data.videos),o.rstart=o.rstart+o.currVideos.length,o.currVideos=e.data.videos,localStorage.setItem(config.project+"-videos",JSON.stringify(c))):(o.seed=Math.ceil(100*Math.random()),$.ajax({url:"/mumu/explore-videos?",data:"shortvideo=1&kw="+t+"&pageSize=5&tag="+s+"&seed="+o.seed+"&rstart=1",async:!0,success:function(t){o.currVideos=t.data.videos,c=[],u=-1,o.rstart=1,c.push(...t.data.videos),localStorage.setItem(config.project+"-videos",JSON.stringify(c)),b()}}))}}),c[u+1]&&(u++,a=c[u].no,r=c[u],localStorage.setItem(config.project+"-videosIndex",u),x(r),c[u+1]&&$("#video1").attr("poster",c[u+1].cover),c[u-1]&&$("#video2").attr("poster",c[u-1].cover))}function k(){F(),Y(),c[u-1]?(u--,a=c[u].no,r=c[u],localStorage.setItem(config.project+"-videosIndex",u),x(r)):location.replace("./index.html")}function x(t){r=t,a=t.no,E=location.origin+"/mumu?videoNo="+a,wx.updateAppMessageShareData({title:r.name,desc:"幕幕 - 短视频练英语\n"+(r.chname||" "),link:E,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),wx.updateTimelineShareData({title:r.name+"\n幕幕 - 短视频练英语",link:E,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),$("#zh_subtitles").html(""),$("#titleinback").text(r.name),$("#titleinbackpad").show(),$("#video").attr("poster",r.cover),f=null,g.currentIndex=0,$.ajax({url:r.captionUrl,type:"get",async:!1,success:function(o){!function(o){g.subtitlesList=[];let t=[];t=o.split(/[(\r\n)\r\n]+/),t.forEach(((o,e)=>{if(o||t.splice(e,1),new RegExp(/^(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d/).test(o)){var s=t[e+2],n=t[e+1];if(s.indexOf("{\\pos")>=0||n.indexOf("{\\pos")>=0)return;g.subtitlesList.push({startTime:A(o.split(" --\x3e ")[0].replace(",",".")),endTime:A(o.split(" --\x3e ")[1].replace(",",".")),chValue:n,enValue:s})}}));for(let o=0;o<g.subtitlesList.length;o++){o;const t=g.subtitlesList[o],e=g.subtitlesList[o+1];o<g.subtitlesList.length-2&&e.startTime-t.endTime>1e3&&g.subtitlesList.splice(o+1,0,{startTime:parseInt(t.endTime)+1e3,endTime:e.startTime,chValue:"",enValue:""})}var e=g.subtitlesList[0];e&&e.startTime>0&&g.subtitlesList.splice(0,0,{startTime:0,endTime:e.startTime,chValue:"",enValue:""});var s=g.subtitlesList[g.subtitlesList.length-1];s&&g.subtitlesList.push({startTime:parseInt(s.endTime)+1e3,endTime:1e3*r.duration,chValue:"",enValue:""});g.currentIndex>=0?(g.current=g.subtitlesList[g.currentIndex],W(g.current)):W(g.subtitlesList[0])}(o)}}),clearTimeout(o.addHistoryTimeout),o.addHistoryTimeout=setTimeout((function(){var o=JSON.parse(localStorage.getItem(config.project+"-historyvideos"));o||(o=[]);for(var t=0;t<o.length;t++)o[t].no==r.no&&o.splice(t,1);o.unshift(r),localStorage.setItem(config.project+"-historyvideos",JSON.stringify(o))}),5e3),function(){if($("#video").attr("src",r.url),localStorage.getItem(config.project+"-translateed"))$("#video").css("top","0"),$("#video").attr("autoplay",!0),B();else{$("#hintssec").text(3),F(),$("#video").css("top","-1000px"),$("#hints").show(),setTimeout((function(){$("#hints").fadeOut(1e3,(function(){$("#video").css("top","0"),B()}))}),3e3);var o=setInterval((function(){var t=$("#hintssec").text()-1;t<1?clearInterval(o):$("#hintssec").text(t)}),1e3)}}()}function y(){w||l&&($("#video")[0].currentTime=l,$("#video")[0].currentTime>=l&&(w=1))}function P(){!function(){if(!p){if(0==l)return void(p=1);l&&($("#video")[0].currentTime=l,$("#video")[0].currentTime>=l&&(p=1))}}(),v.paused&&T(1e3*v.currentTime)}function T(t){if($("#loading").hide(),localStorage.setItem(config.project+"-durationsec-"+a,$("#video")[0].duration),localStorage.setItem(config.project+"-currentTime-"+a,$("#video")[0].currentTime),f){if(!(f.startTime<t))return;f=null}if(!(g.current&&g.current.startTime<=t&&t<g.current.endTime)){var e=g.subtitlesList[g.currentIndex+1];if(e&&e.startTime<=t&&t<e.endTime)return o.diandu&&F(),n?void D():(g.current=e,g.currentIndex++,void W(e));e&&t<e.startTime&&(!g.current||t>g.current.endTime)||$(g.subtitlesList).each((function(o,e){if(e.startTime<=t&&t<e.endTime){debugger;return g.current=e,g.currentIndex=o,void W(e)}}))}}function W(o){if(!o)return;localStorage.setItem(config.project+"-currentCaption-"+a,JSON.stringify(o)),localStorage.setItem(config.project+"-currentIndex-"+a,g.currentIndex);let t=o.enValue.split(" ");$("#zh_subtitles").html(""),g.currentwords=t;for(let o=0;o<t.length;o++)if("\\n"!=t[o]){var e=t[o].split("\\n");if(e[0]){var s=$('<span style="border-bottom:2px solid #ffffff;;user-select: none;display: inline-block;cursor: pointer;font-weight: 900;font-size: 18px;padding-left:3px;padding-right:3px;box-size:bo" index="'+o+'" class="font span'+o+'">'+e[0]+"</span>");s.bind("mouseout",(function(){isPc()&&$(this).css("border-bottom","2px solid #ffffff")})).bind("mouseover",(function(){isPc()&&$(this).css("border-bottom","2px solid black")})),$("#zh_subtitles").append(s)}e[1]&&t.splice(o+1,0,"\\n",e[1]),e[2]&&t.splice(o+3,0,"\\n",e[2]),e[3]&&t.splice(o+5,0,"\\n",e[3])}else $("#zh_subtitles").append("<br/>");$("#chDialog").html(o.chValue.replace(/\\n/g,"<br/>")),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),V=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),$("#summtrans").hide(),$("#wordsframe").hide(),$("#word-in").val(""),$("#video").css("top","0px")}function I(){if(g.currentIndex>0){var o=g.currentIndex,t=g.subtitlesList[--o];t&&(t.enValue||(t=g.subtitlesList[--o]),t&&(g.currentIndex=o,g.current=t,f=t,l=t.startTime/1e3,$("#video")[0].currentTime=t.startTime/1e3,log.debug("set st: "+t.startTime/1e3+" ct: "+$("#video")[0].currentTime+" - "+g.current.enValue.substr(0,10)),W(t),V=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}}function S(){n?(n=0,$("#loopLine").css("background-color","#ffffff")):(n=1,$("#loopLine").css("background-color","#ffcc79"))}function Y(){n=0,$("#loopLine").css("background-color","#ffffff")}function D(){var o=g.currentIndex,t=g.current;t&&(t.enValue||(t=g.subtitlesList[--o]),t&&(g.currentIndex=o,g.current=t,$("#video")[0].currentTime=t.startTime/1e3,f=t,l=t.startTime/1e3,W(t),V=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}function j(){var o=g.currentIndex,t=g.subtitlesList[++o];t&&(t.enValue||(t=g.subtitlesList[++o]),t&&(g.currentIndex=o,g.current=t,f=t,l=t.startTime/1e3,$("#video")[0].currentTime=t.startTime/1e3,W(t),V=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}function O(o){return o?o.replace(/^(\s|:|-|,|\.|\?|!|\[|\]\(|\))+/,"").replace(/(\s|:|-|,|\.|\?|!|\[|\]\(|\))+$/,"").toLowerCase():""}function N(t,e){$("#summrest").hide(),o.dovideoshadow=1,F(),R(),t=O(t),$("#summtrans").show(),$("#summtrans-word").text(t),$("#word-in").val(t),clearTimeout(window.timeoutdo1),window.timeoutdo1=setTimeout((function(){if($("#favor").attr("word",t),window.aaa=setTimeout((function(){$("#summtrans-phonetic").hide(),$("#summtrans-speak").hide(),$("#summtrans-value").hide()}),500),null==t||null==t||!t.toString().trim())return $("#summtrans-phonetic").hide(),$("#summtrans-speak").hide(),void $("#summtrans-value").hide();for(const t of o.translateajaxs)t.abort();o.translateajaxs.push($.ajax({url:"/mumu/translate?from="+r.language+"&to=2&q="+t,ajaxCache:{timeout:2592e3},async:!0,success:function(t){var s=!1;clearTimeout(window.aaa),o.currWord=t.data,t.data.phonetic?$("#summtrans-phonetic").text("/"+t.data.phonetic+"/").show():$("#summtrans-phonetic").hide(),t.data.speakUrl?$("#summtrans-speak").attr("play-url",t.data.speakUrl).show():$("#summtrans-speak").hide(),$("#summtrans-vv").html("").scrollTop(0),t.data.explains&&$(t.data.explains).each((function(o,t){s=!0,$("#summtrans-vv").append(`<div>${U(t)}</div>`)})),t.data.wfs&&$("#summtrans-vv").append(`<div style="margin-top:10px">${U(t.data.wfs)}</div>`),t.data.webs&&($("#summtrans-vv").append('<div style="margin-top:10px;">网络释义: </div>'),$(t.data.webs).each((function(o,t){s=!0,$("#summtrans-vv").append(`<div>${U(t)}</div>`)}))),!s&&t.data.translations&&$(t.data.translations).each((function(o,t){$("#summtrans-vv").append(`<div>${U(t)}</div>`)})),$(".lightkeytrans").bind("click",(function(){N(this.innerText,1)})),$("#wordsframe").hide(),$("#summrest").show(),$("#summtrans-vv").show(),$("#summtrans-value").show(),$("#summtrans").show(),$("#video").css("top","-1000px");var n=localStorage.getItem(config.project+"-totaltranslatesno");n=n||0,n++,localStorage.setItem(config.project+"-totaltranslatesno",n),$("#summtrans-speak").click();var r,a,i=localStorage.getItem(config.project+"-translateed");(i=parseInt(i?++i:1))>=4&&(q.send(JSON.stringify({action:3,words:3})),i=1),localStorage.setItem(config.project+"-translateed",i),e&&(r={word:o.currWord.word,translation:o.currWord.translation,phonetic:o.currWord.phonetic,historyWordNo:randomnum(12)},a=to(r),o.historyWords.rows.splice(0,0,r),$("#historyWordsPad .words").prepend(a),q.send(JSON.stringify({action:6,word:o.currWord.word})))}}))}),200)}function F(){$("#video")[0].pause()}function B(){$("#video")[0].play(),clearTimeout(window.timeoutdo1)}function X(){clearInterval(g.monitor),$(".stopFn").css({display:"none"}),$(".startFn").css({display:"inline"}),$("#video")[0].currentTime==$("#video")[0].duration&&setTimeout((function(){b()}),1e3),R()}function R(){if(o.dovideoshadow&&$("#videoshasow").is(":hidden")){var t=videocapture($("#video")[0]);$("#videoshasowimg").attr("src",t.src),t.src||$("#videoshasowimg").css("background-color","#000000"),$("#videoshasow").show(),$("#video").css("top","-1000px")}}function A(o){let t=o.split(":"),e=0;return t.forEach(((o,t)=>{switch(t){case 0:e+=60*parseFloat(o)*60*1e3;break;case 1:e+=60*parseFloat(o)*1e3;break;case 2:e+=1e3*parseFloat(o);break}})),e}m&&W(m),$("#historyword_template").bind("click",(function(t){log.info("$(#historyword_template).click "+$(this).attr("data")),o.dovideoshadow=1,F(),G(this.innerText),N(this.innerText),$(".historyword").css("background-color","#ffffff"),$(this).css("background-color","#e7e7e7")})),b(),$(".yibiao").on("click","span svg",(function(){log.info("$(.yibiao).click"),new Audio($(this).attr("playsrc")).play()})),$("#loopLine").click(S),$("#favor").click((function(){var t,e;log.info("#favor.click"),t={word:o.currWord.word,translation:o.currWord.translation,phonetic:o.currWord.phonetic,favorWordNo:randomnum(12)},e=oo(t),o.favoredWords.rows.splice(0,0,t),$("#favorsPad .words").prepend(e),q.send(JSON.stringify({action:4,word:o.currWord.word}))})),o.dovideoshadow=0;var C,V=0,L=[];function z(t){(V=t,$(".font").css({background:"transparent"}),$(".font.span"+(V-1)).css({background:"#d2cbcb"}),o.dovideoshadow=1,F(),$("#summtrans-word").show(),V>0)&&($("#wordsframe").hide(),N(g.currentwords[V-1],1))}function _(){var t=O($("#word-in").val());document.activeElement==$("#word-in")[0]?($("#wordsframe").hide(),G(t),N(t,1),$("#word-in").val()||($("#summtrans").hide(),$("#wordsframe").hide(),$("#video").css("top",0))):($("#words .word").remove(),$("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").focus(),$("#word-in").trigger("input"),o.dovideoshadow=1,F())}if(document.onkeydown=function(t){var e=t||window.e,s=e.keyCode||e.which,n=(L=[]).pop();switch(null!=n&&null!=n&&L.push(n),s!=n&&L.push(s),L.join()){case"27":$("#summtrans").hide(),$("#summtrans-word").text(""),$("#summtrans-phonetic").text("").hide(),$("#summtrans-speak").attr("play-url","").hide(),$("#summtrans-value").hide(),$("#summtrans-vv").text(""),$("#wordsframe").hide(),$("#word-in").val(""),$("#words .word").remove(),$("#video").css("top",0);break;case"32":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;$("#video")[0].paused?(B(),o.manual=1):(o.manual=2,F());break;case"13":"INPUT"!=document.activeElement.tagName&&_();break;case"97":case"65":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;I();break;case"115":case"83":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;S();break;case"119":case"87":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;M();break;case"100":case"68":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;j();break;case"113":case"81":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;V<=1?V=g.currentwords.length:V--,z(V);break;case"101":case"69":if(document.activeElement==$("#word-in")[0])return;if("INPUT"==document.activeElement.tagName)return;++V>g.currentwords.length&&(V=1),z(V);break}},document.onkeyup=function(o){L.pop()},document.onfocus=function(){L=[]},window.onbeforeunload=function(){navigator.sendBeacon("/mumu/page-out"),log.flush()},document.addEventListener("touchend",(function(o){var t=(new Date).getTime();t-C<=300&&o.preventDefault(),C=t}),!1),$(document.body).bind("resize",(function(){})),is_weixn()){$.get("/mumu/wxjsapiticket",(o=>{$.get("/mumu/wxsign",{ticket:o.data.ticket,url:location.href},(o=>{wx.config({debug:!1,appId:o.data.appid,timestamp:o.data.timestamp,nonceStr:o.data.nonceStr,signature:o.data.signature,jsApiList:["updateAppMessageShareData","updateTimelineShareData"]})}))}));var E=location.origin+"/mumu/index.html?videoNo="+a;wx.ready((function(){wx.updateAppMessageShareData({title:r.name,desc:"幕幕 - 短视频练英语\n"+(r.chname||" "),link:E,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),wx.updateTimelineShareData({title:r.name+"\n幕幕 - 短视频练英语",link:E,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}})}))}function U(o){if(!o)return o;var t=o.match(/(\w*)\s*?(的过去|的现在|的复数|的第三|的ing)/);return t?o=o.replace(t[1],`<span class="lightkeytrans" style="text-decoration: underline;cursor:pointer;margin:0 5px;color: bisque;">${t[1]}</span>`):o}function J(){o.subtitlesStatus||(o.subtitlesStatus=0),o.subtitlesStatus++,o.subtitlesStatus>3&&(o.subtitlesStatus=1),1==o.subtitlesStatus?($("#chDialog").show(),$("#zh_subtitles").css("visibility","visible")):2==o.subtitlesStatus?($("#chDialog").hide(),$("#zh_subtitles").css("visibility","visible")):3==o.subtitlesStatus&&($("#chDialog").hide(),$("#zh_subtitles").css("visibility","hidden"))}function M(){$("#chDialog").is(":hidden")?($("#chDialog").show(),$("#wholebtnlash").hide()):($("#chDialog").hide(),$("#wholebtnlash").show())}$("#video").bind("play",(function(){!function(){o.ajaxtranslate&&o.ajaxtranslate.abort();for(const t of o.translateajaxs)t.abort();$(".historyword").css("background-color","#ffffff"),o.dovideoshadow=0,$(".dialog").hide(),$("#summtrans").hide(),$("#summtrans-word").text(""),$("#wordsframe").hide(),$("#word-in").val(""),$("#summtrans-value").hide(),$("#summtrans-vv").text(""),$("#summtrans-phonetic").text("").hide(""),$("#summtrans-speak").attr("play-src","").hide(""),$("#video").css("top","0px"),clearInterval(g.monitor),g.monitor=setInterval((function(){T(1e3*v.currentTime)}),10),V=0,"",$("#zh_subtitles span").css({background:"transparent",color:"black"}),$(".startFn").css({display:"none"}),$(".stopFn").css({display:"inline"}),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),$(".searchClass").val(""),$(".yibiao").html(""),$(".fanyi").html(""),$("#videoshasow").hide()}()})).bind("pause",(function(){X()})).bind("mouseover",(function(){})).bind("mouseout",(function(){})).bind("canplay",(function(){y()})).bind("durationchange",(function(){})).bind("loadeddata",(function(){})).bind("loadstart",(function(){})).bind("playing",(function(){})).bind("progress",(function(){})).bind("readystatechange",(function(){})).bind("suspend",(function(){})).bind("timeupdate",(function(){P()})).bind("waiting",(function(){})).bind("click",(function(){})).bind("loadedmetadata",(function(){})).bind("touchend",(function(){})).bind("focus",(function(){})).bind("blur",(function(){})),$("#summtrans-word").bind("click",(function(){log.info("#summtrans-word.click"),$("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").val(this.innerText).focus(),$("#word-in").trigger("input")})),$("#summtrans-speak").bind("click",(function(){log.info("#summtrans-speak.click"),this.audio||(this.audio=new Audio),this.audio.src=$(this).attr("play-url"),this.audio.play()})),$("#wordtempl").bind("click",(function(){log.info("#wordtempl.click"),$("#wordsframe").hide(),$("#word-in").val(""),$("#words .word").remove(),G(this.item.word),N(this.item.word,1)})),$("#word-in").bind("input",(function(){log.info("#word-in.input");var t=$("#word-in")[0],e=$("#word-in")[0].value;""==e?$("#wordsframe_cancel").show():$("#wordsframe_cancel").hide(),clearTimeout(o.ssssaaa),o.ssssaaa=setTimeout((function(){$("#words .word").remove()}),1e3),e?$.ajax({url:"/mumu/words1",data:{kw:e,rstart:1,rcount:100,from:r.language,to:2},ajaxCache:{timeout:2592e3},success:function(s){if(t.value==e){clearTimeout(o.ssssaaa),$("#words .word").remove();var n=s.data.words;$(n).each(((o,t)=>{var e=$("#wordtempl").clone(!0);e[0].item=t,e.attr("id","word"+t.id),e.addClass("word"),e.html(t.word+"&nbsp;&nbsp;"+(t.phonetic?"/"+t.phonetic+"/":"")+"&nbsp;&nbsp;"+(t.explain||"")),$("#words").append(e),e.show()}))}}}):$("#words .word").remove()})),$("#startFn,#startFn1").bind("mousedown",(function(){isMobile()||(log.info("#startFn.mousedown"),o.startt=new Date,clearTimeout(o.dddd),o.dddd=setTimeout((function(){o.diandu?(o.diandu=0,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(191, 187, 187)")):(o.diandu=1,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(255 0 0)"))}),1e3))})).bind("mouseup",(function(){isMobile()||(log.info("#startFn.mouseup"),o.manual=1,clearTimeout(o.dddd),o.startt&&(o.endt=new Date,o.endt.getTime()-o.startt.getTime()<1e3&&B()))})).bind("touchstart",(function(){log.info("#startFn.touchstart"),o.startt=new Date,clearTimeout(o.dddd),o.dddd=setTimeout((function(){o.diandu?(o.diandu=0,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(191, 187, 187)")):(o.diandu=1,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(255 0 0)"))}),1e3)})).bind("touchend",(function(){(log.info("#startFn.touchend"),clearTimeout(o.dddd),o.manual=1,o.startt)&&(o.endt=new Date,o.endt.getTime()-o.startt.getTime()<1e3&&B())})),$("#stopFn,#stopFn1").bind("mousedown",(function(){isMobile()||(log.info("#stopFn.mousedown"),o.startt=new Date,clearTimeout(o.dddd),o.dddd=setTimeout((function(){o.diandu?(o.diandu=0,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(191, 187, 187)")):(o.diandu=1,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(255 0 0)"))}),1e3))})).bind("mouseup",(function(){isMobile()||(log.info("#stopFn.mouseup"),o.manual=2,clearTimeout(o.dddd),o.startt&&(o.endt=new Date,o.endt.getTime()-o.startt.getTime()<1e3&&F()))})).bind("touchstart",(function(){log.info("#stopFn.touchstart"),o.startt=new Date,clearTimeout(o.dddd),o.dddd=setTimeout((function(){o.diandu?(o.diandu=0,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(191, 187, 187)")):(o.diandu=1,$("#stopFn,#stopFn1,#startFn,#startFn1").css("border-color","rgb(255 0 0)"))}),1e3)})).bind("touchend",(function(){(log.info("#stopFn.touchend"),clearTimeout(o.dddd),o.manual=2,o.startt)&&(o.endt=new Date,o.endt.getTime()-o.startt.getTime()<1e3&&F())})),$("#prevline").bind("click",(function(){log.info("#prevline.click"),I()})),$("#currline").bind("click",(function(){log.info("#nextline.click"),D()})),$("#nextline").bind("click",(function(){log.info("#nextline.click"),j()})),$("#gear").bind("touchstart",(function(o){log.info("#gear.touchstart");var t=o.targetTouches[0];this.startX=t.pageX,this.startY=t.pageY})).bind("touchmove",(function(t){if(this.startX&&this.startY){var e=t.targetTouches[0];this.endX=e.pageX,this.endY=e.pageY;var s=this.endX-this.startX;this.endY,this.startY;null!=this.lastDist&&null!=this.lastDist||(this.lastDist=s);var n=s-this.lastDist;this.lastDist=s;var r=parseInt(this.style.left.replace("px"))+n;r<=0&&r>=-4900&&(this.style.left=r+"px"),this.xx||(this.xx=0),this.xx=this.xx+n;var a=null;this.xx>30?(a=V,a++):this.xx<-30&&(a=V,a--),g.current&&g.current.enValue&&null!=a&&(a<1&&(a=g.currentwords.length),a>g.currentwords.length&&(a=1),o.dovideoshadow=1,F(),z(a),this.xx=0),t.preventDefault()}})).bind("touchend",(function(o){log.info("#gear.touchend"),this.startX=null,this.startY=null,this.endX=null,this.endY=null,this.lastDist=null,this.xx=0})),$("#gear").bind("mousedown",(function(o){log.info("#gear.mousedown"),this.startX=o.pageX,this.startY=o.pageY})).bind("mousemove",(function(t){if(this.startX&&this.startY){this.endX=t.pageX,this.endY=t.pageY;var e=this.endX-this.startX;this.endY,this.startY;null!=this.lastDist&&null!=this.lastDist||(this.lastDist=e);var s=e-this.lastDist;this.lastDist=e;var n=parseInt(this.style.left.replace("px"))+s;n<=0&&n>=-4900&&(this.style.left=n+"px"),this.xx||(this.xx=0),this.xx=this.xx+s;var r=null;this.xx>30?(r=V,r++):this.xx<-30&&(r=V,r--),g.current&&g.current.enValue&&null!=r&&(r<1&&(r=g.currentwords.length),r>g.currentwords.length&&(r=1),o.dovideoshadow=1,F(),z(r),this.xx=0)}})).bind("mouseup",(function(o){log.info("#gear.mouseup"),this.startX=null,this.startY=null,this.endX=null,this.endY=null,this.lastDist=null,this.xx=0})),$("#replay").bind("click",(function(o){log.info("#replay.click"),$("#video")[0].load()})),$("#hideBtn").bind("click",(function(o){log.info("#hideBtn.click"),$("#zh_subtitles").css("opacity"),1==$("#zh_subtitles").css("opacity")?($("#zh_subtitles").css("opacity",0),$("#chDialog").hide(),$("#hideBtn").css("background-color","rgb(230, 230, 230)")):($("#chDialog").show(),$("#zh_subtitles").css("opacity",1),$("#hideBtn").css("background-color","#ffffff"))})),$("#wholebtn").bind("click",(function(o){log.info("#wholebtn.click"),M()})),$("#searchbtn").bind("click",(function(o){log.info("#searchbtn.click"),_()})),J(),$("#subtitlesBtn").click((function(){J()})),document.body.addEventListener("click",(function(){})),$("#goPrevVideo").click((function(){log.info("#goPrevVideo.click"),k()})),$("#goNextVideo").click((function(){log.info("#goNextVideo.click"),b()})),$("#word-in").bind("blur",(function(){""==this.value&&setTimeout((function(){$("#wordsframe").hide(),$("#video").css("top",0),o.manual&&(1==o.manual?B():2==o.manual&&F())}),100)})),$("#word-in").bind("focus",(function(){this.select(),""==this.value?$("#wordsframe_cancel").show():$("#wordsframe_cancel").hide()})),$("#searchclear").click((function(){t="",s="",$("#searchtext").text("搜索").css("color","#bfbbbb"),$("#searchpad").slideUp(100),$.ajax({url:"/mumu/explore-videos?",data:"shortvideo=1&kw="+t+"&pageSize=5&tag="+s+"&seed="+o.seed+"&rstart=1",async:!0,success:function(t){o.currVideos=t.data.videos,c=[],u=-1,o.rstart=1,c.push(...t.data.videos),localStorage.setItem(config.project+"-videos",JSON.stringify(c)),b()}})})),$(".searchtag").click((function(){s=this.innerText,$("#searchtext").text("#"+this.innerText+"#").css("color","#6f6f6f"),$("#searchpad").slideUp(100),$.ajax({url:"/mumu/explore-videos?",data:"shortvideo=1&kw="+t+"&pageSize=5&tag="+s+"&seed="+o.seed+"&rstart=1",async:!0,success:function(t){c=[],u=-1,o.currVideos=t.data.videos,o.rstart=1,c.push(...t.data.videos),localStorage.setItem(config.project+"-videos",JSON.stringify(c)),b()}})})),$("#wordbookpad").bind("mousedown touchstart",(function(o){if("touchstart"==o.type){var t=o.targetTouches[0];this.touchstartY=t.pageY}else"mousedown"==o.type&&(this.touchstartY=o.pageY)})).bind("mousemove touchmove",(function(o){if("touchmove"==o.type){var t=o.targetTouches[0];this.touchendY=t.pageY}else"mousemove"==o.type&&(this.touchendY=o.pageY)})).bind("mouseup touchend",(function(o){this.touchendY-this.touchstartY>50&&($("#wordbookpad").slideUp(100),$("#gearframe1").show(),$("#prevnextpad").show()),this.touchstartY=null,this.touchendY=null})),$("#wordbookpadBtn").click((function(){var t;$("#wordbookpad").css("height",$(window).height()-($("#video").height()+90+$("#controlpad").height()+20)+"px"),$("#wordbookpad").slideDown(100),$("#gearframe1").hide(),$("#prevnextpad").hide(),0==o.wordbooks.rows.length&&(t=o.wordbooks.rows.length+1,$.ajax({url:"/mumu/wordbooks?",data:{rstart:t,rcount:o.wordbooks.rcount},success:function(e){o.wordbooks.rows.push(...e.data.rows),o.wordbooks.currRows=e.data.rows,$(e.data.rows).each(((t,e)=>{var s=$("#wordbooksPad .wordbooks .row0").clone(!0);s.removeClass("row0"),s.addClass("row"+e.no),s.text(e.name),s[0].data=e,s.show(),$("#wordbooksPad .wordbooks .row0").before(s);var n=o.wordBooksWordsMap["no"+e.no];n||(n={rows:[],currRows:[],rcount:50,selected:null},o.wordBooksWordsMap["no"+e.no]=n)})),1==t&&$("#wordbooksPad .wordbooks .row").not(".row0").first().click()}}))})),$("#searchpadbtn").click((function(){$("#searchpad").css("height",$(window).height()-($("#video").height()+64+35)+"px"),$("#searchpad").slideDown(100)})),$("#searchpad").bind("touchstart",(function(o){var t=o.targetTouches[0];this.touchstart=t.pageY})).bind("touchmove",(function(o){var t=o.targetTouches[0];this.touchend=t.pageY,0==$(this).scrollTop()&&this.touchstart<this.touchend&&o.preventDefault()})).bind("touchend",(function(o){this.touchend-this.touchstart>50&&$("#searchpad").slideUp(100),this.touchstart=null,this.touchend=null})),$("#searchpad").bind("mousedown",(function(o){this.touchstart=o.pageY})).bind("mousemove",(function(o){this.touchend=o.pageY,0==$(this).scrollTop()&&this.touchstart<this.touchend&&o.preventDefault()})).bind("mouseup",(function(o){this.touchend-this.touchstart>50&&$("#searchpad").slideUp(100),this.touchstart=null,this.touchend=null})),$("#loopVideoBtn").click((function(){$("#video").attr("loop")?($("#video").attr("loop",!1),$(this).css("background-color","#ffffff")):($("#video").attr("loop","loop"),$(this).css("background-color","#e6e6e6"))})),$("#unloopVideoBtn").click((function(){$("#video").attr("loop",!1),$("#loopVideoBtn").show(),$("#unloopVideoBtn").hide()})),$("#chatminpad").click((function(){o.preChatPaused=$("#video")[0].paused,$("#chatpad").css("height",$(window).height()-($("#video").height()+90+$("#controlpad").height()+20)+"px"),$("#gearframe1").hide(),$("#prevnextpad").hide(),$("#chatpad").slideDown(100,(function(){}))})),$("#chatroombtn").click((function(){$("#chatroompad").show(),$("#chatprivatepad").hide(),$(this).css("background-color","#d7d7d7"),$("#chatprivatebtn").css("background-color","#737373")})),$("#chatprivatebtn").click((function(){$("#chatroompad").hide(),$("#chatprivatepad").show(),$(this).css("background-color","#d7d7d7"),$("#chatroombtn").css("background-color","#737373")})),$("#index").bind("click",(function(o){var t=$(o.target).hasClass("translatable")?o.target:$(o.target).parents(".translatable")[0];t&&(t.transfrom?N(t.transfrom,1):t.innerText&&N(t.innerText,1))})),o.spans=[],o.spansIs=0,o.firstRangeWordInx=0,o.lastRangeWordInx=0,$("#zh_subtitles").bind("mousedown touchstart",(function(t){log.info("#zh_subtitles."+t.type);var e=null;if(e="touchmove"==t.type?document.elementFromPoint(t.targetTouches[0].pageX,t.targetTouches[0].pageY):t.target,$(e).hasClass("font")){o.firstRangeWordInx=0,o.lastRangeWordInx=0,F();var s=parseInt($(e).attr("index"));V=s+1,o.spansIs=1,o.spans=[],o.firstRangeWordInx=s,o.lastRangeWordInx=s,$("#zh_subtitles .font").css("background-color","#ffffff"),$("#zh_subtitles .font.span"+s).css("background-color","rgb(210, 203, 203)")}})).bind("mousemove touchmove",(function(t){var e=null;if(e="touchmove"==t.type?document.elementFromPoint(t.targetTouches[0].pageX,t.targetTouches[0].pageY):t.target,t.stopPropagation(),$(e).hasClass("font")){if(!o.spansIs)return;$("#zh_subtitles .font").css("background-color","#ffffff");var s=parseInt($(e).attr("index"));o.spans[o.spans.length-1]!=s&&o.spans.push(s);var n=o.spans[0],r=o.spans[o.spans.length-1];if(n>r){var a=n;n=r,r=a}o.firstRangeWordInx=n,o.lastRangeWordInx=r;for(var i=n;i<=r;i++)$("#zh_subtitles .font.span"+i).css("background-color","rgb(210, 203, 203)")}})).bind("mouseup touchend",(function(t){log.info("#zh_subtitles."+t.type);var e=null;if(e="touchmove"==t.type?document.elementFromPoint(t.targetTouches[0].pageX,t.targetTouches[0].pageY):t.target,$(e).hasClass("font")&&o.spansIs){for(var s=o.firstRangeWordInx,n=o.lastRangeWordInx,r="",a=s;a<=n;a++)r+=$("#zh_subtitles .font.span"+a).text()+" ";r=r.substr(0,r.length-1),o.dovideoshadow=1,F(),G(r),N(r,1),o.spansIs=0,o.spans=[]}})),$("#index").unbind("touchstart mousedown").bind("touchstart mousedown",(function(o){if(this.touchstartTime=(new Date).getTime(),"touchstart"==o.type){var t=o.targetTouches[0];this.touchstartX=t.pageX,this.touchstartY=t.pageY}else"mousedown"==o.type&&(this.touchstartX=o.pageX,this.touchstartY=o.pageY)})).unbind("touchmove mousemove").bind("touchmove mousemove",(function(o){var t;"touchmove"==o.type?(t=(e=o.targetTouches[0]).pageX,e.pageY):"mousemove"==o.type&&(t=o.pageX,o.pageY);if(this.touchstartX&&this.touchstartY&&this.touchendX&&this.touchendY&&($("#video1").css("left",parseInt($("#video1").css("left").replace("px",""))+t-this.touchendX+"px"),$("#video2").css("left",parseInt($("#video2").css("left").replace("px",""))+t-this.touchendX+"px")),"touchmove"==o.type){var e=o.targetTouches[0];this.touchendX=e.pageX,this.touchendY=e.pageY}else"mousemove"==o.type&&(this.touchendX=o.pageX,this.touchendY=o.pageY);for(var s=null;!((s=s?$(s).parent():$(o.target)).scrollTop()>0)&&0!=s.length;);0==s.length&&this.touchstartY<this.touchendY&&o.preventDefault()})).unbind("touchend mouseup").bind("touchend mouseup",(function(o){this.touchendtime=(new Date).getTime(),$("#video1").css("left","100%"),$("#video2").css("left","-100%"),this.touchendtime-this.touchstartTime<500&&this.touchstartX&&this.touchstartY&&this.touchendX&&this.touchendY&&(this.touchstartX-this.touchendX>100?b():this.touchstartX-this.touchendX<-100&&k()),this.touchstartTime=null,this.touchendtime=null,this.touchstartX=null,this.touchstartY=null,this.touchendX=null,this.touchendY=null})),$("#chatprivatebtn,#chatroombtn,#chatprivatepad,#chatinput").bind("touchstart",(function(o){var t=o.targetTouches[0];this.touchstart=t.pageY})).bind("touchmove",(function(o){var t=o.targetTouches[0];this.touchend=t.pageY,0==$(this).scrollTop()&&this.touchstart<this.touchend&&o.preventDefault()})).bind("touchend",(function(o){this.touchend-this.touchstart>50&&($("#gearframe1").show(),$("#prevnextpad").show(),$("#chatpad").slideUp(100,(function(){}))),this.touchstart=null,this.touchend=null})),$("#chatprivatebtn,#chatroombtn,#chatprivatepad,#chatinput").bind("mousedown",(function(o){this.mousedown=o.pageY})).bind("mousemove",(function(o){this.mouseup=o.pageY,0==$(this).scrollTop()&&this.mousedown<this.mouseup&&o.preventDefault()})).bind("mouseup",(function(o){this.mouseup=o.pageY,this.mouseup-this.mousedown>50&&($("#gearframe1").show(),$("#prevnextpad").show(),$("#chatpad").slideUp(100,(function(){}))),this.mousedown=null,this.mouseup=null})),$("#chatmsgspad").bind("touchstart",(function(o){var t=o.targetTouches[0];this.touchstart=t.pageY})).bind("touchmove",(function(o){var t=o.targetTouches[0];this.touchend=t.pageY,0==$("#chatmsgspad").scrollTop()&&this.touchstart<this.touchend&&o.preventDefault()})).bind("touchend",(function(o){this.touchend-this.touchstart>50&&0==$("#chatmsgspad").scrollTop()&&($("#gearframe1").show(),$("#prevnextpad").show(),$("#chatpad").slideUp(100,(function(){}))),this.touchstart=null,this.touchend=null})),$("#chatmsgspad").bind("mousedown",(function(o){this.mousedown=o.pageY})).bind("mousemove",(function(o){this.mouseup=o.pageY,0==$("#chatmsgspad").scrollTop()&&this.mousedown<this.mouseup&&o.preventDefault()})).bind("mouseup",(function(o){this.mouseup=o.pageY,this.mouseup-this.mousedown>50&&0==$("#chatmsgspad").scrollTop()&&($("#gearframe1").show(),$("#prevnextpad").show(),$("#chatpad").slideUp(100,(function(){}))),this.mousedown=null,this.mouseup=null})),$("#word-in").keydown((function(){13==(window.event||e).keyCode&&_()})),$("#chatinput").keydown((function(){if(13==(window.event||e).keyCode){if(""==this.value)return;var o={text:this.value,action:1,looking:r.name};q.send(JSON.stringify(o)),this.value=""}}));var q=null;function H(){(q=new WebSocket(`wss://${location.host}/mumu/websocket/${pagePre.login.userNo}`)).onopen=function(){o.ws=q},q.onmessage=function(o){var t=JSON.parse(o.data);if(1==t.action){null!=t.nickname&&(t.nickname=t.nickname.substr(0,1)+"..."+t.nickname.substr(3));var e=$("#chatmsgtemple").clone(!0);e.attr("id","chatmsg"+t.msgNo),t.userNo==$.cookie("token")&&e.css("color","green"),e.find(".name").text(t.nickname||"网友"),e.find(".msg").text(t.text),e.find(".looking").text(t.looking),e.show(),$("#chatmsgspad").prepend(e),$("#lastmsg").text((t.nickname||"网友").substr(0,6)+" : "+t.text)}},q.onclose=function(o){},q.onerror=function(o){}}function G(t){t=O(t),clearTimeout(o.sssss),o.sssss=setTimeout((function(){$("#relatedWordsPad .relatedWord").remove(),$("#fromRelatedWord").text(t),$.ajax({url:"/mumu/related-words",data:{kw:t,rstart:1,rcount:100,from:r.language,to:2},ajaxCache:{timeout:2592e3},success:function(o){o.data.words&&$(o.data.words).each(((o,t)=>{var e=$("#relatedWord0").clone(!0);e[0].data=t,e.attr("id","relatedWord"+t.id),e.addClass("relatedWord"),e.text(t.word),$("#relatedWord0").before(e),e.show()}))}})}),100)}function K(o){o.forEach((o=>{var t=$("#wordbooksPad .words .pad .row0").clone(!0);t.removeClass("row0"),t.addClass("row"+o.no),t.find(".word").text(o.word),o.phonetic?t.find(".phonetic").text("/"+o.phonetic+"/"):(t.find(".word").css("width","66.666666%"),t.find(".phonetic").hide()),t.find(".translation").text(o.translation),$("#wordbooksPad .words .pad .row0").before(t),t.show(),t[0].data=o}))}function Q(t){var e=o.wordBooksWordsMap["no"+t],s=e.rows.length+1,n=e.rcount;$.ajax({url:"/mumu/wordbook-words?",data:{wordbookNo:t,rstart:s,rcount:n},beforeSend:()=>{$("#wordbooksPad .words .pad .someload").hide(),$("#wordbooksPad .words .pad .loading").show()},success:function(o){0==o.code&&(1==s&&0==o.data.rows.length?($("#wordbooksPad .words .pad .someload").hide(),$("#wordbooksPad .words .pad .loadnodata").show()):o.data.rows.length<n?($("#wordbooksPad .words .pad .someload").hide(),$("#wordbooksPad .words .pad .loadend").show()):($("#wordbooksPad .words .pad .someload").hide(),$("#wordbooksPad .words .pad .loadmore").show()),o.data.rows.length>0&&(e.currRows=o.data.rows,e.rows.push(...o.data.rows),K(o.data.rows)))}})}function Z(t){var e=function(t){var e={word:o.currWord.word,translation:o.currWord.translation,phonetic:o.currWord.phonetic,no:randomnum(12)};o.wordBooksWordsMap["no"+t].rows.splice(0,0,e);var s=$("#wordbooksPad .words .pad .row0").clone(!0);s.removeClass("row0"),s.addClass("row"+e.no),s.find(".word").text(e.word),e.phonetic?s.find(".phonetic").text("/"+e.phonetic+"/"):(s.find(".word").css("width","66.666666%"),s.find(".phonetic").hide());return s.find(".translation").text(e.translation),s.show(),s[0].data=e,s}(t);$("#wordbooksPad .words .pad ").prepend(e),q.send(JSON.stringify({action:8,wordbookNo:t,word:o.currWord.word}))}function oo(o){var t=$("#favorsPad .word0").clone(!0);return t.removeClass("word0"),t.addClass("word"+o.favorWordNo),t.find(".word").text(o.word),t.find(".translation").text(o.translation),o.phonetic?t.find(".phonetic").text("/"+o.phonetic+"/"):(t.find(".word").css("width","66.666666%"),t.find(".phonetic").hide()),t[0].data=o,t[0].transfrom=o.word,t.show(),t}function to(o){var t=$("#historyWordsPad .word0").clone(!0);return t.removeClass("word0"),t.addClass("word"+o.historyWordNo),t.find(".word").text(o.word),t.find(".translation").text(o.translation),o.phonetic?t.find(".phonetic").text("/"+o.phonetic+"/"):(t.find(".word").css("width","66.666666%"),t.find(".phonetic").hide()),t[0].data=o,t[0].transfrom=o.word,t.show(),t}function eo(){var t=o.wordbooksOnAdd.rows.length+1,e=o.wordbooksOnAdd.rcount;$.ajax({url:"/mumu/wordbooks",data:{rstart:t,rcount:e},beforeSend:()=>{$("#wordbooksPadOnAdd .someload").hide(),$("#wordbooksPadOnAdd .loading").show()},success:function(s){0==s.code&&(1==t&&0==s.data.rows.length?($("#wordbooksPadOnAdd .someload").hide(),$("#wordbooksPadOnAdd .loadnodata").show()):s.data.rows.length<e?($("#wordbooksPadOnAdd .someload").hide(),$("#wordbooksPadOnAdd .loadend").show()):($("#wordbooksPadOnAdd .someload").hide(),$("#wordbooksPadOnAdd .loadmore").show()),s.data.rows.length>0&&(o.wordbooksOnAdd.currRows=s.data.rows,o.wordbooksOnAdd.rows.push(...s.data.rows),s.data.rows.forEach((o=>{var t=$("#wordbooksPadOnAdd .row0").clone(!0);t.removeClass("row0"),t.addClass("row"+o.no),t.text(o.name),$("#wordbooksPadOnAdd .row0").before(t),t.show(),t[0].data=o}))))}})}H(),setInterval((()=>{if(q&&3==q.readyState&&H(),!$("#video")[0].paused){var o=localStorage.getItem(config.project+"-totalsecondsno");o=parseInt(o||0),o+=5,localStorage.setItem(config.project+"-totalsecondsno",o),q.send(JSON.stringify({action:2,videoNo:a,seconds:5}))}}),5e3),setInterval((function(){q&&1==q.readyState&&q.send("0")}),3e4),statisticsexps(),$("#relatedWord0").click((function(){N(this.innerText,1)})),$("#fromRelatedWordPad").click((function(){N($("#fromRelatedWord").text(),1)})),$.ajax({url:"/mumu/chatroom-msgs?",data:"rcount=300",async:!0,success:function(o){$(o.data.rows).each(((o,t)=>{null!=t.nickname&&(t.nickname=t.nickname.substr(0,1)+"..."+t.nickname.substr(3)),0==o&&($("#lastmsg").text((t.nickname||"网友").substr(0,6)+" : "+t.text),$("#chatminpad").show());var e=$("#chatmsgtemple").clone(!0);e.attr("id","chatmsg"+t.msgNo),t.userNo==$.cookie("token")&&e.css("color","green"),e.find(".name").text(t.nickname||"网友"),e.find(".msg").text(t.text),e.find(".looking").text(t.looking),e.show(),$("#chatmsgspad").append(e)})),0==o.data.rows.length&&($("#lastmsg").text("聊天室"),$("#chatminpad").show())}}),$("#wordbooksPad .createRowBtn").click((function(){common.prompt({message:"请输入单词本名称",parent:$("#index"),confirm:function(o){o&&$.ajax({url:"/mumu/create-wordbook?",data:{name:o},success:function(t){if(0==t.code){var e={no:t.data.no,name:o},s=$("#wordbooksPad .wordbooks .row0").clone(!0);s.removeClass("row0"),s.addClass("row"+e.no),s.text(e.name),s[0].data=e,s.show(),$("#wordbooksPad .wordbooks .row0").before(s)}else common.alert(t.msg)}})}})})),$("#wordbooksPad .wordbooks .row0").click((function(t){var e=o.wordbooks.selected=this.data;$("#wordbooksPad .createRowBtn").hide(),$("#wordbooksPad .editRowBtn").show(),function(t){var e=o.wordBooksWordsMap["no"+t];e||(e={rows:[],currRows:[],rcount:50,selected:null},o.wordBooksWordsMap["no"+t]=e);$("#wordbooksPad .words .pad .row").not(".row0").remove(),0==e.rows.length?Q(t):(0==e.rows.length?($("#wordbooksPad .words .pad .someload").hide(),$("#wordbooksPad .words .pad .loadnodata").show()):e.currRows.length<e.rcount?($("#wordbooksPad .words .pad .someload").hide(),$("#wordbooksPad .words .pad .loadend").show()):($("#wordbooksPad .words .pad .someload").hide(),$("#wordbooksPad .words .pad .loadmore").show()),K(e.rows))}(e.no)})),$("#wordbooksPad .words .loadmore").click((function(t){Q(o.wordbooks.selected.no)})),$("#wordbooksPad .words .pad .row0").click((function(){var o=this.data;N(o.word),G(o.word)})),$("#wordbooksPad .words  .coverTargetTextBtn").click((function(){"hidden"==$("#wordbooksPad .words .word,#wordbooksPad .words .phonetic").css("visibility")?$("#wordbooksPad .words .word,#wordbooksPad .words .phonetic").css("visibility","visible"):$("#wordbooksPad .words .word,#wordbooksPad .words .phonetic").css("visibility","hidden")})),$("#wordbooksPad .words .coverMainTextBtn").click((function(){"hidden"==$("#wordbooksPad .words .translation").css("visibility")?$("#wordbooksPad .words .translation").css("visibility","visible"):$("#wordbooksPad .words .translation").css("visibility","hidden")})),$("#wordbooksPad .words .pad .row0 .removeBtn").click((function(){var t=$(this).parents(".row"),e=t[0].data;q.send(JSON.stringify({action:9,wordbookNo:o.wordbooks.selected.no,word:e.word})),t.remove()})),$("#wordbooksPad .editRowBtn").click((function(t){var e=o.wordbooks.selected;$("#wordbookDetailPad").show(),$("#wordbookDetailPad .namePad .value").text(e.name)})),$("#wordbookDetailPad .deleteBtn").click((function(t){var e=o.wordbooks.selected;common.prompt({message:"请输入 "+e.name+" 以确认删除.",confirm:function(t){t&&(t==e.name?$.ajax({url:"/mumu/delete-wordbook?",data:{no:e.no,name:e.name},success:function(t){0==t.code?($("#wordbookDetailPad").hide(),$("#wordbooksPad .wordbooks .row"+e.no).remove(),e=o.wordbooks.selected=null,$("#wordbooksPad .wordbooks").click()):common.alert(t.msg)}}):common.alert("输入有误"))}})})),$("#wordbookDetailPad .namePad .editBtn").click((function(t){var e=o.wordbooks.selected;common.prompt({message:"请输入新名称",value:e.name,confirm:function(o){o!=e.name&&$.ajax({url:"/mumu/alter-wordbook?",data:{no:e.no,name:o},success:function(t){0==t.code?(e.name=o,$("#wordbooksPad .wordbooks .row"+e.no).text(o),$("#wordbookDetailPad .value").text(o)):common.alert(t.msg)}})}})})),$("#wordbookDetailPad .closeBtn").click((function(o){$("#wordbookDetailPad").hide()})),$("#wordbooksPad .wordbooks").click((function(t){this==t.target&&(o.wordbooks.selected=null,$("#wordbooksPad .createRowBtn").show(),$("#wordbooksPad .editRowBtn").hide(),$("#wordbooksPad .words .pad").hide())})),$("#favorsPad .word0").click((function(o){var t=this.data;N(t.word),G(t.word)})),$("#favorsPad .word0 .removeBtn").click((function(t){var e=$(this).parents(".wrap"),s=e[0].data;q.send(JSON.stringify({action:5,word:s.word})),e.remove(),o.favoredWords.rows.splice(o.favoredWords.rows.indexOf(s),4),o.favoredWords.currRows.splice(o.favoredWords.currRows.indexOf(s),4),t.stopPropagation()})),$("#favorsPad .coverTargetTextBtn").click((function(){"hidden"==$("#favorsPad .word,#favorsPad .phonetic").css("visibility")?$("#favorsPad .word,#favorsPad .phonetic").css("visibility","visible"):$("#favorsPad .word,#favorsPad .phonetic").css("visibility","hidden")})),$("#favorsPad .coverMainTextBtn").click((function(){"hidden"==$("#favorsPad .translation").css("visibility")?$("#favorsPad .translation").css("visibility","visible"):$("#favorsPad .translation").css("visibility","hidden")})),$("#historyWordsPad .word0 .removeBtn").click((function(t){var e=$(this).parents(".wrap"),s=e[0].data;q.send(JSON.stringify({action:7,word:s.word})),e.remove(),o.historyWords.rows.splice(o.historyWords.rows.indexOf(s),4),o.historyWords.currRows.splice(o.historyWords.currRows.indexOf(s),4),t.stopPropagation()})),$("#historyWordsPad .word0").click((function(o){var t=this.data;N(t.word),G(t.word)})),$("#historyWordsPad .coverTargetTextBtn").click((function(){"hidden"==$("#historyWordsPad .word,#historyWordsPad .phonetic").css("visibility")?$("#historyWordsPad .word,#historyWordsPad .phonetic").css("visibility","visible"):$("#historyWordsPad .word,#historyWordsPad .phonetic").css("visibility","hidden")})),$("#historyWordsPad .coverMainTextBtn").click((function(){"hidden"==$("#historyWordsPad .translation").css("visibility")?$("#historyWordsPad .translation").css("visibility","visible"):$("#historyWordsPad .translation").css("visibility","hidden")})),$("#favorsBtn").click((function(){var t,e;$("#favorsBtn").css("background-color","unset").css("color","#ffffff"),$("#historyWordsBtn").css("background-color","#9f9f9f").css("color","#000000"),$("#wordbooksBtn").css("background-color","#9f9f9f").css("color","#000000"),$("#favorsPad").show(),$("#historyWordsPad").hide(),$("#wordbooksPad").hide(),0==o.favoredWords.rows.length&&(t=o.favoredWords.rows.length+1,e=o.favoredWords.rcount,$.ajax({url:"/mumu/favored-words?",data:{rstart:t,rcount:e},beforeSend:()=>{$("#favorsPad .someload").hide(),$("#favorsPad .loading").show()},success:function(s){0==s.code&&(1==t&&0==s.data.rows.length?($("#favorsPad .someload").hide(),$("#favorsPad .loadnodata").show()):s.data.rows.length<e?($("#favorsPad .someload").hide(),$("#favorsPad .loadend").show()):($("#favorsPad .someload").hide(),$("#favorsPad .loadmore").show()),s.data.rows.length>0&&(o.favoredWords.currRows=s.data.rows,o.favoredWords.rows.push(...s.data.rows),$(s.data.rows).each(((o,t)=>{$("#favorsPad .word0").before(oo(t))}))))}}))})),$("#historyWordsBtn").click((function(){var t,e;$("#favorsBtn").css("background-color","#9f9f9f").css("color","#000000"),$("#historyWordsBtn").css("background-color","unset").css("color","#ffffff"),$("#wordbooksBtn").css("background-color","#9f9f9f").css("color","#000000"),$("#favorsPad").hide(),$("#historyWordsPad").show(),$("#wordbooksPad").hide(),0==o.historyWords.rows.length&&(t=o.historyWords.rows.length+1,e=o.historyWords.rcount,$.ajax({url:"/mumu/history-words?",data:{rstart:t,rcount:e},beforeSend:()=>{$("#historyWordsPad .someload").hide(),$("#historyWordsPad .loading").show()},success:function(s){0==s.code&&(1==t&&0==s.data.rows.length?($("#historyWordsPad .someload").hide(),$("#historyWordsPad .loadnodata").show()):s.data.rows.length<e?($("#historyWordsPad .someload").hide(),$("#historyWordsPad .loadend").show()):($("#historyWordsPad .someload").hide(),$("#historyWordsPad .loadmore").show()),s.data.rows.length>0&&(o.historyWords.currRows=s.data.rows,o.historyWords.rows.push(...s.data.rows),$(s.data.rows).each(((o,t)=>{$("#historyWordsPad .word0").before(to(t))}))))}}))})),$("#wordbooksBtn").click((function(){$("#favorsBtn").css("background-color","#9f9f9f").css("color","#000000"),$("#historyWordsBtn").css("background-color","#9f9f9f").css("color","#000000"),$("#wordbooksBtn").css("background-color","unset").css("color","#ffffff"),$("#favorsPad").hide(),$("#historyWordsPad").hide(),$("#wordbooksPad").show()})),$("#addToWordbookBtn").click((function(){$("#wordbooksPadOnAdd").show(),0==o.wordbooksOnAdd.rows.length&&eo(),null!=o.wordbooks.selected?($("#wordbooksPadOnAdd .currRow .name").text(o.wordbooks.selected.name),$("#wordbooksPadOnAdd .currRow")[0].data=o.wordbooks.selected,$("#wordbooksPadOnAdd .currRowPad").show()):$("#wordbooksPadOnAdd .currRowPad").hide()})),$("#wordbooksPadOnAdd .closeBtn").click((function(){$("#wordbooksPadOnAdd").hide()})),$("#wordbooksPadOnAdd .currRow,#wordbooksPadOnAdd .row0").click((function(){var t=this.data;if($("#wordbooksPadOnAdd").hide(),t.no==o.wordbooks.selected.no)Z(t.no);else{var e=o.wordBooksWordsMap["no"+t.no],s={word:o.currWord.word,translation:o.currWord.translation,phonetic:o.currWord.phonetic,no:randomnum(12)};e.rows.splice(0,0,s),$("#wordbooksPadOnAdd").hide(),q.send(JSON.stringify({action:8,wordbookNo:t.no,word:o.currWord.word}))}})),$("#wordbooksPadOnAdd .loadmore").click((function(){eo()}))}();