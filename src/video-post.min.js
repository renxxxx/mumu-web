!function(){$("#finger,gear").animate({left:"+=150px"},2e3,(function(){$("#finger").animate({left:"-=300px"},2e3,(()=>{$("#finger").fadeOut(500)}))})),$("#gear").animate({left:"+=150px"},2e3,(function(){$("#gear").animate({left:"-=300px"},2e3)}));var e,t=[],n=window.location.search.substring(1).split("&")[0].split("=")[1],i=localStorage.getItem("currentTime-"+n),s=parseInt(localStorage.getItem("currentIndex-"+n)),a=JSON.parse(localStorage.getItem("currentCaption-"+n)),r=a,o=0,c=0,l={subtitles:"",monitor:"",subtitlesList:[],current:a,currentIndex:s},u=[];f=f;var d=$("#video")[0];function p(){o||i&&($("#video")[0].currentTime=i,$("#video")[0].currentTime>=i&&(o=1))}function m(){!function(){if(!c){if(0==i)return void(c=1);i&&($("#video")[0].currentTime=i,$("#video")[0].currentTime>=i&&(c=1))}}(),d.paused&&h(1e3*d.currentTime)}function h(e){if($("#loading").hide(),localStorage.setItem("durationsec-"+n,$("#video")[0].duration),localStorage.setItem("currentTime-"+n,$("#video")[0].currentTime),r){if(!(r.startTime<e))return;r=null}if(!(l.current&&l.current.startTime<=e&&e<l.current.endTime)){var t=l.subtitlesList[l.currentIndex+1];if(t&&t.startTime<=e&&e<t.endTime)return l.current=t,l.currentIndex++,void f(t);t&&e<t.startTime&&(!l.current||e>l.current.endTime)||$(l.subtitlesList).each((function(t,n){if(n.startTime<=e&&e<n.endTime){debugger;return l.current=n,l.currentIndex=t,void f(n)}}))}}function f(e){if(!e)return;localStorage.setItem("currentCaption-"+n,JSON.stringify(e)),localStorage.setItem("currentIndex-"+n,l.currentIndex);let t=e.enValue.split(" ");$("#zh_subtitles").html(""),l.currentwords=t;for(let e=0;e<t.length;e++){var i=t[e].split("\\n");if(i[0]){var s=$('<span style="user-select: none;display: inline-block;cursor: pointer;font-weight: 900;font-size: 18px;padding-left:3px;padding-right:3px;" class="font span'+e+'">'+i[0]+"</span>");s.bind("click",(function(){k(),E(e+1)})).bind("mouseout",(function(){$(this).css("border-bottom","")})).bind("mouseover",(function(){$(this).css("border-bottom","2px solid black")})),$("#zh_subtitles").append(s)}i[1]&&(t.splice(e+1,0,i[1]),$("#zh_subtitles").append("<br/>"))}$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),D=0,$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),$("#summtrans").hide(),$("#wordsframe").hide(),$("#word-in").val(""),$("#video").css("top","0px")}function g(){if(l.currentIndex>0){var e=l.currentIndex,t=l.subtitlesList[--e];t&&(t.enValue||(t=l.subtitlesList[--e])),t&&(l.currentIndex=e,l.current=t,r=t,i=t.startTime/1e3,$("#video")[0].currentTime=t.startTime/1e3,f(t),D=0,_(),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""))}}function b(){var e=l.currentIndex,t=l.current;t&&(t.enValue||(t=l.subtitlesList[--e]),t&&(l.currentIndex=e,l.current=t,$("#video")[0].currentTime=t.startTime/1e3,r=t,i=t.startTime/1e3,f(t),D=0,_(),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}function v(){var e=l.currentIndex,t=l.subtitlesList[++e];t&&(t.enValue||(t=l.subtitlesList[++e]),t&&(l.currentIndex=e,l.current=t,r=t,i=t.startTime/1e3,$("#video")[0].currentTime=t.startTime/1e3,f(t),D=0,_(),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html("")))}function w(e){var n=(t=t||[]).indexOf(e);n>-1&&t.splice(n,1),t.unshift(e);var i=$("#historyword_template").clone(!0);i.attr("id","historyword-"+e.replace(/[^\w]/g,"")),i.text(e),i.css("display","inline-block"),$("#historywordspad").prepend(i),localStorage.setItem("historywords",JSON.stringify(t))}function x(e){var n=t.indexOf(e);n>-1&&t.splice(n,1),$("#historyword-"+e.replace(/[^\w]/g,"")).remove()}function T(t){t=t.replace(/^(,|\.|\?|!)+/,"").replace(/(,|\.|\?|!)+$/,""),$("#summtrans").show(),$("#summtrans-word").text(t),$("#word-in").val(t),clearTimeout(window.timeoutdo1),window.timeoutdo1=setTimeout((function(){if(window.aaa=setTimeout((function(){$("#summtrans-phonetic").hide(),$("#summtrans-speak").hide(),$("#summtrans-value").hide()}),500),null==t||null==t||!t.toString().trim())return $("#summtrans-phonetic").hide(),$("#summtrans-speak").hide(),void $("#summtrans-value").hide();$.ajax({url:"/mumu/translate?from="+e.language+"&to=2&q="+t,type:"get",async:!0,success:function(e){clearTimeout(window.aaa),e.data.phonetic?$("#summtrans-phonetic").text("/"+e.data.phonetic+"/").show():$("#summtrans-phonetic").hide(),e.data.speakUrl?$("#summtrans-speak").attr("play-url",e.data.speakUrl).show():$("#summtrans-speak").hide(),$("#summtrans-vv").html("").scrollTop(0),e.data.translations&&$(e.data.translations).each((function(e,t){$("#summtrans-vv").append(`<div>${O(t)}</div>`)})),e.data.webTranslations&&($("#summtrans-vv").append('<div style="margin-top:10px;">网络释义: </div>'),$(e.data.webTranslations).each((function(e,t){$("#summtrans-vv").append(`<div>${O(t)}</div>`)}))),$(".lightkeytrans").bind("click",(function(){T(this.innerText)})),$("#summtrans-vv").show(),$("#summtrans-value").show(),$("#summtrans").show(),$("#video").css("top","-1000px")}})}),200)}function k(){$("#video")[0].pause()}function y(){$("#video")[0].play()}function I(){if(!l.current)return;$("#video")[0].currentTime;$(".chDialog").css("display","block"),$(".chDialog div").html(l.current.chValue.replace("\\n","</br>")),k()}function _(){$(".chDialog").css("display","none")}function X(e){let t=e.split(":"),n=0;return t.forEach(((e,t)=>{switch(t){case 0:n+=60*parseFloat(e)*60*1e3;break;case 1:n+=60*parseFloat(e)*1e3;break;case 2:n+=1e3*parseFloat(e);break}})),n}function Y(e){k();let t=$("#zh_subtitles").width()+$("#zh_subtitles").offset().left-5,n=$("#zh_subtitles").height()+$("#zh_subtitles").offset().top-5;if(u=[],$("#zh_subtitles span").css({background:"transparent",color:"black"}),ele=document.elementFromPoint(e.pageX,e.pageY),!$(ele).hasClass("font"))return;let i=e.clientX||e.pageX,s=e.clientY||e.pageY;t-5>i&&i>$("#zh_subtitles").offset().left+5&&$("#zh_subtitles").offset().top+5<s&&s<n-5&&ele.className.lastIndexOf("font span ")<0&&" "!=ele.innerHTML&&(u.push({class:ele.className,value:ele.innerHTML}),$("."+ele.className.split(" ")[1]).css({background:"#d2cbcb",color:"black"}))}function L(e){if(ele=document.elementFromPoint(e.pageX,e.pageY),!$(ele).hasClass("font"))return;let t=e.clientX||e.pageX,n=e.clientY||e.pageY,i=$("#zh_subtitles").width()+$("#zh_subtitles").offset().left,s=$("#zh_subtitles").height()+$("#zh_subtitles").offset().top;if(i-5>t&&t>$("#zh_subtitles").offset().left+5&&$("#zh_subtitles").offset().top+5<n&&n<s-5&&ele.className.lastIndexOf("font span ")<0){let e=!0;if(u.findIndex((function(t,n){t.class==ele.className&&(e=!1)})),e&&" "!=ele.innerHTML)if(u.length){let e=parseInt(u[u.length-1].class.replace("font span","")),t=parseInt(ele.className.replace("font span",""));if(t==e+1)u.push({class:ele.className,value:ele.innerHTML}),$("."+ele.className.split(" ")[1]).css({background:"#d2cbcb",color:"black"});else if(t>e+1)for(let n=e;n<t;n++)$(".span"+n),u.push({class:$(".span"+n).attr("class"),value:$(".span"+n).html()}),$(".span"+n).css({background:"#d2cbcb",color:"black"});else for(let n=t;n<e;n++)$(".span"+n),u.push({class:$(".span"+n).attr("class"),value:$(".span"+n).html()}),$(".span"+n).css({background:"#d2cbcb",color:"black"})}else u.push({class:ele.className,value:ele.innerHTML}),$("."+ele.className.split(" ")[1]).css({background:"#d2cbcb",color:"black"})}}function z(e){ele=document.elementFromPoint(e.pageX,e.pageY);for(let e=0;e<u.length-1;e++)for(let t=0;t<u.length-e-1;t++)if(parseInt(u[t].class.replace("font span",""))>parseInt(u[t+1].class.replace("font span",""))){let e=u[t];u[t]=u[t+1],u[t+1]=e}let t="";$(u).each((function(e,n){e>0?t+=" "+n.value.replace(/^(,|\.|\?|!)+/,"").replace(/(,|\.|\?|!)+$/,""):t=n.value.replace(/^(,|\.|\?|!)+/,"").replace(/(,|\.|\?|!)+$/,"")})),t?(t,1==t.split(" ").length&&(x(t),w(t)),T(t)):"",$(".searchClass").blur()}a&&f(a),$.ajax({url:"/mumu/video?",type:"get",data:"videoNo="+n,async:!1,success:function(t){(e=t.data.video).height&&e.width&&($("#video").css("height",parseInt($("#video").css("width").replace("px",""))*(e.height/e.width)),$("#summtrans").css("height",$("#video").css("height")),$("#wordsframe").css("height",$("#video").css("height"))),$.ajax({url:e.captionUrl,type:"get",async:!0,success:function(t){!function(t){let n=[];n=t.split(/[(\r\n)\r\n]+/),n.forEach(((e,t)=>{if(e||n.splice(t,1),new RegExp(/^(20|21|22|23|[0-1]\d):[0-5]\d:[0-5]\d/).test(e)){var i=n[t+2],s=n[t+1];if(i.indexOf("{\\pos")>=0||s.indexOf("{\\pos")>=0)return;l.subtitlesList.push({startTime:X(e.split(" --\x3e ")[0].replace(",",".")),endTime:X(e.split(" --\x3e ")[1].replace(",",".")),chValue:s,enValue:i})}}));for(let e=0;e<l.subtitlesList.length;e++){const t=l.subtitlesList[e],n=l.subtitlesList[e+1];e<l.subtitlesList.length-2&&n.startTime-t.endTime>1e3&&l.subtitlesList.splice(e+1,0,{startTime:parseInt(t.endTime)+1e3,endTime:n.startTime,chValue:"",enValue:""})}var i=l.subtitlesList[0];i&&i.startTime>0&&l.subtitlesList.splice(0,0,{startTime:0,endTime:i.startTime,chValue:"",enValue:""});var s=l.subtitlesList[l.subtitlesList.length-1];s&&l.subtitlesList.push({startTime:parseInt(s.endTime)+1e3,endTime:1e3*e.duration,chValue:"",enValue:""}),l.currentIndex>=0?(l.current=l.subtitlesList[l.currentIndex],f(l.current)):f(l.subtitlesList[0]),$("#video").attr("src",e.url)}(t)}})}}),$("#historyword_template").bind("click",(function(e){k(),T(this.innerText)})),function(){var e=localStorage.getItem("historywords");e&&(t=JSON.parse(e));for(let e=0;e<t.length;e++){const i=t[e];var n=$("#historyword_template").clone(!0);n.attr("id","historyword-"+i.replace(/[^\w]/g,"")),n.text(i),n.css("display","inline-block"),n.show(),$("#historywordspad").append(n)}}(),$(".yibiao").on("click","span svg",(function(){new Audio($(this).attr("playsrc")).play()})),$("#zh_subtitles").mousedown((e=>{moveStata=!0,_coordinates={clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY},Y(_coordinates),$("#zh_subtitles").mousemove((e=>{moveStata&&(_coordinates={clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY},L(_coordinates))})).mouseup((function(e){moveStata=!1,_coordinates={clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY},z(_coordinates),$("#zh_subtitles").unbind("mousemove").unbind("mouseup")}))}));var S,D=0,N=[];function E(e){if(D=e,$(".font").css({background:"transparent"}),$(".font.span"+(D-1)).css({background:"#d2cbcb"}),k(),$("#summtrans-word").show(),D>0){$("#wordsframe").hide();var t=l.currentwords[D-1];T(t),clearTimeout(window.timeoutdo2),window.timeoutdo2=setTimeout((()=>{x(t),w(t)}),500)}}function V(){isPc()?($("#gearframe1").hide(),$("#pcrecommand").text("控制键(a,s,d,space) 翻译键(q,w,e,enter)")):($("#gearframe1").show(),$("#pcrecommand").text("PC端操作更方便")),e.height&&e.width&&$("#video").css("height",parseInt($("#video").css("width").replace("px",""))*(e.height/e.width))}function F(){document.activeElement==$("#word-in")[0]?($("#wordsframe").hide(),T($("#word-in").val()),$("#word-in").val()||($("#summtrans").hide(),$("#wordsframe").hide(),$("#video").css("top",0))):($("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").focus(),$("#word-in").trigger("input"),$("#video").css("top","-1000px"),k())}function O(e){if(!e)return e;var t=e.match(/(\w*)\s*?(的过去|的现在|的复数|的第三|的ing)/);return t?e=e.replace(t[1],`<span class="lightkeytrans" style="text-decoration: underline;cursor:pointer;">${t[1]}</span>`):e}document.onkeydown=function(e){var t=e||window.e,n=t.keyCode||t.which,i=(N=[]).pop();switch(null!=i&&null!=i&&N.push(i),n!=i&&N.push(n),N.join()){case"27":$("#summtrans").hide(),$("#summtrans-word").text(""),$("#summtrans-phonetic").text("").hide(),$("#summtrans-speak").attr("play-url","").hide(),$("#summtrans-value").hide(),$("#summtrans-vv").text(""),$("#wordsframe").hide(),$("#word-in").val(""),$("#words .word").remove(),$("#video").css("top",0);break;case"32":if(document.activeElement==$("#word-in")[0])return;$("#video")[0].paused?(_(),y()):k();break;case"13":F();break;case"97":case"65":if(document.activeElement==$("#word-in")[0])return;g();break;case"115":case"83":if(document.activeElement==$("#word-in")[0])return;b();break;case"119":case"87":if(document.activeElement==$("#word-in")[0])return;$(".chDialog").is(":hidden")?I():_();break;case"100":case"68":if(document.activeElement==$("#word-in")[0])return;v();break;case"113":case"81":if(document.activeElement==$("#word-in")[0])return;D<=1?D=l.currentwords.length:D--,E(D);break;case"101":case"69":if(document.activeElement==$("#word-in")[0])return;++D>l.currentwords.length&&(D=1),E(D);break}},document.onkeyup=function(e){N.pop()},document.onfocus=function(){N=[]},window.onbeforeunload=function(){navigator.sendBeacon("/mumu/page-out")},document.addEventListener("tou  chend",(function(e){var t=(new Date).getTime();t-S<=300&&e.preventDefault(),S=t}),!1),V(),$(document.body).bind("resize",(function(){V()})),$.get("/mumu/wxjsapiticket",(e=>{$.get("/mumu/wxsign",{ticket:e.data.ticket,url:location.href},(e=>{wx.config({debug:!1,appId:e.data.appid,timestamp:e.data.timestamp,nonceStr:e.data.nonceStr,signature:e.data.signature,jsApiList:["updateAppMessageShareData","updateTimelineShareData"]})}))})),wx.ready((function(){wx.updateAppMessageShareData({title:e.name,desc:"renx.cc",link:location.href,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}}),wx.updateTimelineShareData({title:e.name,link:location.href,imgUrl:location.origin+"/mumu/favicon.ico",success:function(){}})})),$("#video").bind("play",(function(){$(".dialog").hide(),$("#summtrans").hide(),$("#summtrans-word").text(""),$("#wordsframe").hide(),$("#word-in").val(""),$("#summtrans-value").hide(),$("#summtrans-vv").text(""),$("#summtrans-phonetic").text("").hide(""),$("#summtrans-speak").attr("play-src","").hide(""),$("#video").css("top","0px"),clearInterval(l.monitor),l.monitor=setInterval((function(){h(1e3*d.currentTime)}),10),D=0,"",$("#zh_subtitles span").css({background:"transparent",color:"black"}),$(".startFn").css({display:"none"}),$(".stopFn").css({display:"inline"}),$(".dialog").css({display:"none"}),$(".dialogTitle #kw").html(""),$(".searchClass").val(""),$(".yibiao").html(""),$(".fanyi").html("")})).bind("pause",(function(){clearInterval(l.monitor),$(".stopFn").css({display:"none"}),$(".startFn").css({display:"inline"})})).bind("mouseover",(function(){$("#video").attr("controls",!0)})).bind("mouseout",(function(){$("#video").attr("controls",!1)})).bind("canplay",(function(){p()})).bind("durationchange",(function(){})).bind("loadeddata",(function(){})).bind("loadstart",(function(){})).bind("playing",(function(){})).bind("progress",(function(){})).bind("readystatechange",(function(){})).bind("suspend",(function(){})).bind("timeupdate",(function(){m()})).bind("waiting",(function(){})).bind("click",(function(){$("#video").attr("controls",!0)})).bind("loadedmetadata",(function(){})).bind("touchend",(function(){$("#video").attr("controls",!0)})).bind("focus",(function(){$("#video").attr("controls",!0)})).bind("blur",(function(){$("#video").attr("controls",!1)})),$("#summtrans-word").bind("click",(function(){$("#summtrans").hide(),$("#wordsframe").show(),$("#word-in").val(this.innerText).focus(),$("#word-in").trigger("input")})),$("#summtrans-speak").bind("click",(function(){this.audio||(this.audio=new Audio),this.audio.src=$(this).attr("play-url"),this.audio.play()})),$("#wordtempl").bind("click",(function(){$("#wordsframe").hide(),$("#word-in").val(""),$("#words .word").remove(),T(this.item.q),x(this.item.q),w(this.item.q)})),$("#word-in").bind("input",(function(){var t=this,n=this.value;n?$.ajax({url:"/mumu/words",method:"get",data:{kw:n,start:1,pageSize:10,from:e.language,to:2},success:function(e){if(t.value==n){$("#words .word").remove();var i=e.data.words;$(i).each(((e,t)=>{var n=$("#wordtempl").clone(!0);n[0].item=t,n.attr("id","word"+(e+1)),n.addClass("word"),n.html(t.q+"&nbsp;&nbsp;"+(t.phonetic?"/"+t.phonetic+"/":"")+"&nbsp;&nbsp;"+(t.explain1||"")+(t.explain2?" | ":"")+(t.explain2||"")+(t.explain3?" | ":"")+(t.explain3||"")+(t.explain4?" | ":"")+(t.explain4||"")+(t.explain5?" | ":"")+(t.explain5||"")),$("#words").append(n),n.show()}))}}}):$("#words .word").remove()})),$("#zh_subtitles").bind("touchstart",(function(e){var t;t=e,_coordinates={clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY,pageX:t.changedTouches[0].pageX,pageY:t.changedTouches[0].pageY},Y(_coordinates),e.preventDefault()})).bind("touchmove",(function(e){var t;t=e,_coordinates={clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY,pageX:t.changedTouches[0].pageX,pageY:t.changedTouches[0].pageY},L(_coordinates),e.preventDefault()})).bind("touchend",(function(e){var t;t=e,_coordinates={clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY,pageX:t.changedTouches[0].pageX,pageY:t.changedTouches[0].pageY},z(_coordinates),e.preventDefault()})),$("#startFn").bind("click",(function(){y(),$("#video").attr("controls",!1)})),$("#stopFn").bind("click",(function(){k(),$("#video").attr("controls",!1)})),$("#prevline").bind("click",(function(){g()})),$("#currline").bind("click",(function(){b()})),$("#nextline").bind("click",(function(){v()})),$("#gear").bind("touchstart",(function(e){var t=e.targetTouches[0];this.startX=t.pageX,this.startY=t.pageY,k()})).bind("touchmove",(function(e){var t=e.targetTouches[0];this.endX=t.pageX,this.endY=t.pageY;var n=this.endX-this.startX;this.endY,this.startY;null!=this.lastDist&&null!=this.lastDist||(this.lastDist=n);var i=n-this.lastDist;this.lastDist=n;var s=parseInt(this.style.left.replace("px"))+i;s<=0&&s>=-4900&&(this.style.left=s+"px"),this.xx||(this.xx=0),this.xx=this.xx+i;var a=null;this.xx>30?(a=D,a++):this.xx<-30&&(a=D,a--),null!=a&&(a<1&&(a=l.currentwords.length),a>l.currentwords.length&&(a=1),E(a),this.xx=0),e.preventDefault()})).bind("touchend",(function(e){this.lastDist=null,this.xx=0})),$("#replay").bind("click",(function(e){$("#video")[0].currentTime=0,l.currentIndex=0,l.current=l.subtitlesList[0],b(),y()})),$("#hideBtn").bind("click",(function(e){1==$("#zh_subtitles").css("opacity")?($("#zh_subtitles").css("opacity",0),$("#hideBtn").text("SHOW")):($("#zh_subtitles").css("opacity",1),$("#hideBtn").text("HIDE"))})),$("#wholebtn").bind("click",(function(e){I()})),$("#searchbtn").bind("click",(function(e){F()})),$("#chDialog").bind("click",(function(e){_()}))}();